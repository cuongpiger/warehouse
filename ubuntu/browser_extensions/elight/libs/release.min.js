"use strict";Raven.config(window.ENV.sentry.dns,{shouldSendCallback:()=>window.ENV.sentry.enable}).install();var app=angular.module("main",["ngRaven","app.controller","app.service","focus.directive","tooltip.directive","dailyTask.service","wordMemo.service","popoverAutoclose.directive","scrollLazyload.directive","interpolate.filter","login.service","profile.service","challenge.service","challenge.service.io","challenge.items","preload.service","streak.service","mainScreen","mainScreen.end-game","user","header.navigator","header.searchBox","lesson.quote","lesson.word","lesson.elightube","lesson.challenge_new","lesson.topic","footer.setting","footer.video","offline","ngAudio","ngStorage","pr.longpress","oc.lazyLoad","login","notebook","ngAnimate","experience.service","firebase.service","angular-svg-round-progressbar","welcome","profile","inviteFriend","ngFileUpload","ngImgCrop","timer","aki.mission","aki.progressbar"]);function mainController(e,t,n,o,a,i,r,s){if(this.bonusStat=r.getBonusStat(),chrome.runtime.onInstalled.addListener(e=>{let t=Object.keys(localStorage);t.splice(t.indexOf("_start"),1),t.splice(t.indexOf("ee_update_version"),1),t.map(e=>{try{JSON.parse(localStorage.getItem(e))}catch(t){_gaq.push(["_trackEvent","Error extesion",e,a.auth&&a.auth.id?a.auth.id:a.guest_id||0]),localStorage.removeItem(e)}})}),a.language=a.language?a.language:"vn",n.language=a.language,n.backgroundMusic="",n.version=ee_update_version,a.cacheCleared||(a.$reset(),localStorage.clear(),a.cacheCleared=!0),a.auth)var l={email:a.auth.email,username:a.auth.display_name,userId:a.auth.id,avatar:a.auth.avatar,guestId:a.guest_id,school:a.auth.school};else l={guestId:a.guest_id};function c(){i.subcribeUser(l.email,l.username,l.userId,l.guestId,l.avatar,l.school).then(e=>{1==e.status&&(e.new_token&&(a.token_guest_id=e.new_token),a.auth&&(a.auth.school=e.school,localStorage.setItem("user",JSON.stringify(a.auth)),s.fetch()))}).catch(e=>{console.log("useSubcribeUser",e)})}n.io.on("connect",function(){a.guest_id?a.token_guest_id?c():i.getTokenGuestId(a.guest_id).then(function(e){a.token_guest_id=e.data,c()}).catch(function(e){console.log(e)}):t.getGuestId(function(e){a.guest_id=e.data;a.guest_id;i.getTokenGuestId(e.data).then(function(e){a.token_guest_id=e.data,c()}).catch(function(e){console.log(e)})})}),e.changeLanguage=function(e){n.language=e},e.invite=function(){i.inviteUserByUserId()},a.currentVersion?a.currentVersion!==ee_update_version&&("4.0.0"===a.currentVersion&&(delete a.schoolmateRank,delete a.allRank,delete a.schoolRank),a.currentVersion=ee_update_version,a.quotes=[],localStorage.removeItem("_qd"),_gaq.push(["_trackEvent","Extension Installation","Install",ee_update_version])):(a.currentVersion=ee_update_version,_gaq.push(["_trackEvent","Extension Installation","Install",ee_update_version])),n.network=navigator.onLine,window.addEventListener("online",function(t){n.network=navigator.onLine,n.$broadcast("reInit",{}),applyScope(e)}),window.addEventListener("offline",function(t){$(".enjoyhint_close_btn").click(),n.$broadcast("hide-tutorial",{}),n.network=navigator.onLine,applyScope(e)});let u=[{id:1,image:"../assets/images/background/elight-extension1.jpg"},{id:2,image:"../assets/images/background/elight-extension2.jpg"},{id:3,image:"../assets/images/background/elight-extension3.jpg"},{id:4,image:"https://s3-ap-northeast-1.amazonaws.com/elifile/public/images/extension/morning/elight-extension4.jpg"},{id:5,image:"https://s3-ap-northeast-1.amazonaws.com/elifile/public/images/extension/morning/elight-extension5.jpg"},{id:6,image:"https://s3-ap-northeast-1.amazonaws.com/elifile/public/images/extension/morning/elight-extension6.jpg"},{id:7,image:"https://s3-ap-northeast-1.amazonaws.com/elifile/public/images/extension/morning/elight-extension7.jpg"},{id:8,image:"https://s3-ap-northeast-1.amazonaws.com/elifile/public/images/extension/morning/elight-extension8.jpg"},{id:9,image:"https://s3-ap-northeast-1.amazonaws.com/elifile/public/images/extension/morning/elight-extension9.jpg"},{id:10,image:"../assets/images/background/elight-extension10.jpg"}],d=[{id:1,image:"../assets/images/background/elight-extension1.jpg"},{id:2,image:"../assets/images/background/elight-extension2.jpg"},{id:3,image:"../assets/images/background/elight-extension3.jpg"},{id:10,image:"../assets/images/background/elight-extension10.jpg"}],g=[{id:1,image:"../assets/images/background/elight-ex-afternoon1.jpg"},{id:2,image:"../assets/images/background/elight-ex-afternoon2.jpg"},{id:3,image:"../assets/images/background/elight-ex-afternoon3.jpg"},{id:4,image:"../assets/images/background/elight-ex-afternoon4.jpg"},{id:5,image:"https://s3-ap-northeast-1.amazonaws.com/elifile/public/images/extension/afternoon/elight-ex-afternoon5.jpg"},{id:6,image:"../assets/images/background/elight-ex-afternoon6.jpg"},{id:7,image:"https://s3-ap-northeast-1.amazonaws.com/elifile/public/images/extension/afternoon/elight-ex-afternoon7.jpg"},{id:8,image:"https://s3-ap-northeast-1.amazonaws.com/elifile/public/images/extension/afternoon/elight-ex-afternoon8.jpg"},{id:9,image:"https://s3-ap-northeast-1.amazonaws.com/elifile/public/images/extension/afternoon/elight-ex-afternoon9.jpg"},{id:10,image:"https://s3-ap-northeast-1.amazonaws.com/elifile/public/images/extension/afternoon/elight-ex-afternoon10.jpg"}],p=[{id:1,image:"../assets/images/background/elight-ex-afternoon1.jpg"},{id:2,image:"../assets/images/background/elight-ex-afternoon2.jpg"},{id:3,image:"../assets/images/background/elight-ex-afternoon3.jpg"},{id:4,image:"../assets/images/background/elight-ex-afternoon4.jpg"},{id:6,image:"../assets/images/background/elight-ex-afternoon6.jpg"}],h=[{id:1,image:"../assets/images/background/elight-ex-night1.jpg"},{id:2,image:"../assets/images/background/elight-ex-night2.jpg"},{id:3,image:"../assets/images/background/elight-ex-night3.jpg"},{id:4,image:"../assets/images/background/elight-ex-night4.jpg"}],m=[{id:1,image:"../assets/images/background/elight-ex-night1.jpg"},{id:2,image:"../assets/images/background/elight-ex-night2.jpg"},{id:3,image:"../assets/images/background/elight-ex-night3.jpg"},{id:4,image:"../assets/images/background/elight-ex-night4.jpg"}];!function(){var e,t=(new Date).getHours(),n=(new Date).getDate();e=t>0&&t<=11?"morning":t>11&&t<=19?"afternoon":"evening";a.currentTime&&a.currentTime===e&&a.background&&a.oldDate&&a.oldDate===n?y(e):(a.oldDate=n,a.currentTime=e,function(e){(function(e){"morning"===e?(!a.bg_morning||a.bg_morning&&(!a.bg_morning.images||a.bg_morning.images.length<=0))&&(a.bg_morning={images:u,preload:""},(!a.bg_morning.local||a.bg_morning.local.length<=0)&&(a.bg_morning.local=d)):"afternoon"===e?(!a.bg_afternoon||a.bg_afternoon&&(!a.bg_afternoon.images||a.bg_afternoon.images.length<=0))&&(a.bg_afternoon={images:g,preload:""},(!a.bg_afternoon.local||a.bg_afternoon.local.length<=0)&&(a.bg_afternoon.local=p)):"evening"===e&&(!a.bg_evening||a.bg_evening&&(!a.bg_evening.images||a.bg_evening.images.length<=0))&&(a.bg_evening={images:h,preload:""},(!a.bg_evening.local||a.bg_evening.local.length<=0)&&(a.bg_evening.local=m))})(e),"morning"===e&&(a.background=a.bg_morning.preload,a.bg_morning.preload="",a.bg_morning.currentLocalImage="",S(e),b(e));"afternoon"===e&&(a.background=a.bg_afternoon.preload,a.bg_afternoon.preload="",a.bg_afternoon.currentLocalImage="",S(e),b(e));"evening"===e&&(a.background=a.bg_evening.preload,a.bg_evening.preload="",a.bg_evening.currentLocalImage="",S(e),b(e))}(e),y(e))}();var f=!1,v=o(function(){e.background=e.localBackground?e.localBackground.image:"../assets/images/default.jpg",f=!0;var t=new Image;t.src=e.background,t.onload=function(){$(".placeholder-background").css("background-image","url("+e.background+")").addClass("background-fade")},applyScope(e)},1500);function w(e){if(e&&0!==e.length){var t=Math.floor(Math.random*e.length);return e.splice(t,1)[0]}return 0}function S(e){if("morning"===e){if(a.bg_morning.preload)return;a.bg_morning.preload=w(a.bg_morning.images)}else if("afternoon"===e){if(a.bg_afternoon.preload)return;a.bg_afternoon.preload=w(a.bg_afternoon.images)}else{if("evening"!==e)return;if(a.bg_evening.preload)return;a.bg_evening.preload=w(a.bg_evening.images)}}function b(e){if("morning"===e){if(a.bg_morning.currentLocalImage)return;a.bg_morning.currentLocalImage=w(a.bg_morning.local)}else if("afternoon"===e){if(a.bg_afternoon.currentLocalImage)return;a.bg_afternoon.currentLocalImage=w(a.bg_afternoon.local)}else{if("evening"!==e)return;if(a.bg_evening.currentLocalImage)return;a.bg_evening.currentLocalImage=w(a.bg_evening.local)}}function y(t){switch(e.background=navigator.onLine?a.background.image:"assets/images/default.jpg",t){case"morning":e.preload=a.bg_morning.preload.image,e.localBackground=a.bg_morning.currentLocalImage;break;case"afternoon":e.preload=a.bg_afternoon.preload.image,e.localBackground=a.bg_afternoon.currentLocalImage;break;case"evening":e.preload=a.bg_evening.preload.image,e.localBackground=a.bg_evening.currentLocalImage;break;default:e.preload=""}applyScope(e)}window.onload=function(){if(o.cancel(v),n.slowNetwork=!1,n.network=navigator.onLine,!f){var t=document.querySelector(".backgroundp-ex"),i=new Image;i.src=t.dataset.large,i.onload=function(){a.welcome?$(".placeholder-background").css("background-image","url("+t.dataset.large+")").addClass("background-fade"):$(".placeholder-background").css("background-image","url("+e.background+")").addClass("background-fade")},i.onerror=function(){$(".placeholder-background").css("background-image","url(../assets/images/default.jpg)").addClass("background-fade")}}},e.version=ee_update_version,void 0===a.volume?(a.volume=1,n.volume=1):n.volume=a.volume;new Date;if(a.randomScreen&&0!==a.randomScreen.length||(a.randomScreen=[1,2]),"vn"===n.language){let e=_.sample([1,2,3]);1===e?(n.random=1,n.isLearn_word=!0,n.isQuote=!1,n.elightube=!1,n.topic=!1):2===e?(n.random=1,n.isLearn_word=!1,n.isQuote=!0,n.elightube=!1,n.topic=!1):3===e?(n.random=1,_.isEmpty(a.videos)?(n.isLearn_word=!1,n.isQuote=!0,n.elightube=!1,n.topic=!1):(n.isLearn_word=!1,n.isQuote=!1,n.elightube=!0,n.topic=!1)):(n.random=1,n.isLearn_word=!1,n.isQuote=!1,n.elightube=!1,n.topic=!0)}else n.random=1,n.isLearn_word=!0,n.isQuote=!1,n.elightube=!1,n.topic=!1;n.random=1,n.challengeScreen=0,t.getShareNumber(function(e,t){n.shareNumber=e?t:""});let k=localStorage.getItem("ee_update_version");k?k!==ee_update_version&&(localStorage.ee_update_version=ee_update_version,_gaq.push(["_trackEvent","Upgrade Extension","Upgrade",ee_update_version])):(localStorage.ee_update_version=ee_update_version,_gaq.push(["_trackEvent","Upgrade Extension","Upgrade",ee_update_version])),chrome.runtime.onUpdateAvailable.addListener(function(e){chrome.runtime.reload()}),chrome.runtime.requestUpdateCheck(function(t){"update_available"===t?(e.is_update=!0,localStorage._wupdate=!1):"no_update"===t?(e.is_update=!1,localStorage._wupdate=!1):"throttled"===t&&(e.is_update=!1,localStorage._wupdate=!1)})}function mainService(e){var t={};function n(){return fetch("https://api.elight.edu.vn/v3/list-video-library?skip=0&take=7&user_token=").then(e=>e.json()).then(e=>{let t=[];for(var n=0;n<e.data.newest_videos.length;n++){let a={title:e.data.newest_videos[n].title,description:e.data.newest_videos[n].description,poster:"https://api.elight.edu.vn/public/images/video/"+e.data.newest_videos[n].poster,url:`https://elight.edu.vn/hoc-tieng-anh-qua-video/${o(e.data.newest_videos[n].title)}/${e.data.newest_videos[n].id}`};t.push(a)}return localStorage.setItem("videoList",JSON.stringify(t)),t}).catch(e=>{console.log(e)})}function o(e){return e=(e=(e=(e=(e=(e=(e=(e=(e=(e=(e=e.toLowerCase()).replace(/à|á|ạ|ả|ã|â|ầ|ấ|ậ|ẩ|ẫ|ă|ằ|ắ|ặ|ẳ|ẵ/g,"a")).replace(/è|é|ẹ|ẻ|ẽ|ê|ề|ế|ệ|ể|ễ/g,"e")).replace(/ì|í|ị|ỉ|ĩ/g,"i")).replace(/ò|ó|ọ|ỏ|õ|ô|ồ|ố|ộ|ổ|ỗ|ơ|ờ|ớ|ợ|ở|ỡ/g,"o")).replace(/ù|ú|ụ|ủ|ũ|ư|ừ|ứ|ự|ử|ữ/g,"u")).replace(/ỳ|ý|ỵ|ỷ|ỹ/g,"y")).replace(/đ/g,"d")).replace(/!|@|%|\^|\*|\(|\)|\+|\=|\<|\>|\?|\/|,|\.|\:|\;|\'| |\"|\&|\#|\[|\]|~|$|_/g,"-")).replace(/-+-/g,"-")).replace(/^\-+|\-+$/g,"")}return t.search=function(t,n){""==t?n({status:400}):e({method:"GET",url:"https://www.google.com/complete/search",params:{client:"firefox",ie:"utf-8",oe:"utf-8",hl:"en-US",gl:"",q:""==t?"":t}}).then(function(e){n(e)},function(e){n(e)})},t.getWeather=function(t,n){var o="select item.condition from weather.forecast where woeid in (select woeid from geo.places(1) where text='"+t.address+","+t.city+"') and u='c'";e({method:"GET",url:"https://query.yahooapis.com/v1/public/yql",params:{q:o,format:"json"}}).then(function(e){n(e)},function(e){n(e)})},t.getCityFromLatlong=function(t,n,o){e({method:"GET",url:"https://maps.google.com/maps/api/geocode/json",params:{latlng:t+","+n,sensor:!0}}).then(function(e){o(e.data)},function(e){o(e.data)})},t.getStudent=function(t,n){e({method:"GET",url:"https://api.elight.edu.vn/v3/extension/check",params:{code:t}}).then(function(e){n(e.data)},function(e){n(e.data)})},t.getUserId=function(t){e({method:"GET",url:"https://elight.edu.vn/test-extension",params:{}}).then(function(e){t(e.data)},function(e){t(e.data)})},t.queryFirebase=function(t,n){e({method:"GET",url:"https://akira-extension.firebaseio.com/"+t+".json"}).then(function(e){n(e)},function(e){n(e)})},t.queryGoogleTranslate=function(e){return getFullTranslate(e)},t.videoLibraryDictionary=function(t,n){e({method:"GET",url:"https://api.elight.edu.vn/v3/translate?content="+t}).then(function(e){n(e)},function(e){n(e)})},t.getPopupTime=function(t){e({method:"GET",url:"https://elight.edu.vn/extension-popup"}).then(function(e){t(e)},function(e){t(e)})},t.getShareNumber=(e=>{e(!1,"0")}),t.contribute=function(){_gaq.push(["_trackEvent","EE Features","Contribution","open link"]),window.open("https://docs.google.com/forms/d/e/1FAIpQLSctUEPkJtK351xR3QSUMMdMsFrqE8AZayhoWvhmjFIZQE_AUg/viewform?usp=sf_link")},t.getVideoList=(()=>{let e=JSON.parse(localStorage.getItem("videoList"));return void 0==e||null==e||e==[]?n().then(e=>e):(setTimeout(function(){n()}),Promise.resolve(e))}),t.getQuotes=function(t){e({method:"GET",url:"http://elight.edu.vn/quotations/"}).then(function(e){t(e)},function(e){t(e)})},t.getNewsline=function(t){e({method:"GET",url:"https://api.elight.edu.vn/v3/news/get"}).then(function(e){t(e)},function(e){t(e)})},t.getGuestId=function(t){e({method:"GET",url:"http://elight.edu.vn/test-extension/"}).then(function(e){t(e)},function(e){t(e)})},t.syncGuestAndUserId=function(t,n,o){e({method:"POST",url:"https://api.elight.edu.vn/v3/extension/sync?user_token="+n+"&guest_id="+t}).then(function(e){o(e)},function(e){o(e)})},t}function MissionService(e,t,n){var o={getMissions:function(o,a){var i=t.defer(),r={url:n+"user/course/task",method:"GET"};return e({method:r.method,url:r.url,params:{user_token:o,course_id:a}}).then(function(e){i.resolve(e.data)},function(e){i.reject(e)}),i.promise},getScoreLesson:function(o,a){var i=t.defer(),r={url:n+"user/lesson/score",method:"GET"};return e({method:r.method,url:r.url,params:{user_token:o,lesson_id:a}}).then(function(e){i.resolve(e.data)},function(e){i.reject(e)}),i.promise},finishTaskNew:function(o,a){var i=t.defer(),r={url:n+"user/course/task/finish",method:"POST"};return e({method:r.method,url:r.url,params:{user_token:o,task_id:a}}).then(function(e){i.resolve(e)},function(e){i.reject(e)}),i.promise}};return o}function progressLineService(e,t,n,o){var a={},i=o.auth?o.auth.user_token:0;return a.getAllStar=function(o,a,r){var s=n.defer(),l={url:t+"user/total-score",method:"GET"};return e({method:l.method,url:l.url,params:{user_token:i,lesson_id:o}}).then(function(e){s.resolve(e)},function(e){s.reject(e)}),s.promise},a.getBadgeLevel=function(){var e=n.defer();return e.resolve(badge_level),e.promise},a.updateScore=function(o){var a=n.defer(),r={url:t+"extension/score/update",method:"POST"};return e({method:r.method,url:r.url,params:{user_token:i,score:o}}).then(function(e){a.resolve(e)},function(e){a.reject(e)}),a.promise},a}function challengeItemService(e,t,n){const o="freeze",a="unfreeze",i="bomb",r="health";let s={};return s[o]=0,s[a]=0,s[i]=0,s[r]=0,{_items:s,_bonusStat:{gold_chest:0,silver_chest:null,invite:!1},get:function(){return this._items},fetch:function(){return t.ability&&!angular.equals({},t.ability)?this.sync():n.fetchItems({guest_id:t.guest_id}).then(e=>{"success"==e.status&&(this._items=e.items)})},sync:function(){let e=t.ability,o=(t.auth,t.guest_id);return n.syncLocalItems({guest_id:o,items:e}).then(e=>{"success"==(e=e||{}).status&&(delete t.ability,this._items=e.items)})},canUse:function(e){return this._items[e]&&this._items[e]>0},useFreeze:function(e){return this._items[o]=Math.max(0,this._items[o]-1),n.useItem(o,e,t.guest_id)},useUnfreeze:function(e){return this._items[a]=Math.max(0,this._items[a]-1),n.useItem(a,e,t.guest_id)},useBomb:function(e){return this._items[i]=Math.max(0,this._items[i]-1),n.useItem(i,e,t.guest_id)},useHealth:function(e){return this._items[r]=Math.max(0,this._items[r]-1),n.useItem(r,e,t.guest_id)},getBonusStat:function(){return this._bonusStat},fetchBonusStat:function(){return n.fetchBonusStat(t.guest_id).then(e=>{"success"==e.status&&(this._bonusStat=e.bonus_stat,this._bonusStat.gold_chest=Math.min(3,this._bonusStat.gold_chest))})},openGoldChest:function(){return n.openGoldChest(t.guest_id).then(e=>{if("success"==e.status)return this._bonusStat.gold_chest=0,e.data})},openSilverChest:function(){return n.openSilverChest(t.guest_id).then(e=>{if("success"==e.status)return this._bonusStat.silver_chest=e.data.time,e.data.bonus})},openWinChest:function(){return n.openWinChest(t.guest_id).then(e=>{if("success"==e.status)return e.data})},onOpenBonus:function(e,t){void 0!==this._items[e]&&(this._items[e]+=t)}}}function appRequestService(e,t){return{send:function(n,o,a){let i={method:n=n.toUpperCase(),url:o,headers:{"Content-Type":"application/json"}};"POST"==n||"PUT"==methos?i.data=a:i.params=a;return e(i).then(e=>e.data,e=>t.reject(e))}}}function userService(e,t){return{_user:{email:"",username:"",avatar:"",school:{}},get:function(){return this._user},fetch:function(){if(t.auth&&!angular.equals({},t.auth)){let e=t.auth||{};return this._user={email:e.email,username:e.display_name,avatar:e.avatar,school:e.school}}}}}function wordSuperMemoService(e,t,n){let o={};return o.storeWord=function(n){let a=t.defer(),i=[];return _.each(n,function(t){let n=t.word,a=t.translate,r=t.image,s=t.audio,l=t.phonetic,c=t.unitId,u=Date.now(),d={word:n,meaning:a,reviewDate:Date.now()+216e6,image:r,audio:s,phonetic:l,updated_at:u,EF:2.5,Q:50,I:1,unitId:c};o.existWordReview();let g,p=e.wordReview,h=_.find(p,function(e){return e.word===n});if(h){let e;e=h.updated_at?(Date.now()-h.updated_at)/1e3/60/60/24:.5,h.EF+=.02;let t=h.Q+e*(h.Q/20);h.Q=t,h.I=o.getIForSuperMemo(t),h.reviewDate=Date.now()+h.EF*h.I*864e5,h.updated_at=Date.now(),g=h}else e.wordReview.push(d),g=d;i.push(g)}),a.resolve(i),a.promise},o.existWordReview=function(){let t=e.wordReview;null!==t&&void 0!==t||(e.wordReview=[])},o.getIForSuperMemo=function(e){let t;return t=0<=e&&e<60?1:60<=e&&e<70?2:70<=e&&e<80?3:80<=e&&e<90?4:5},o.syncWords=function(e,o){let a=t.defer();return n({method:apis.storeWordByUser.method,url:apis.storeWordByUser.url,data:{user_token:e,words:o}}).then(function(e){return e.data}).then(function(e){a.resolve(e)}).catch(function(e){a.reject(e)}),a.promise},o.getWordByUser=function(e){let o=t.defer();return n({method:apis.getWordByUser.method,url:apis.getWordByUser.url,params:{user_token:e}}).then(function(e){return e.data}).then(function(e){o.resolve(e)}).catch(function(e){o.reject(e)}),o.promise},o}function streakController(e,t,n,o,a){var i=this,r=[];i.streak=n.streak,i.streak=o.getStreak(),i.streak_text=i.streak.day,i.streak_text>=2&&!n.streak.status&&(n.streak.status=!0,sendGa(n.auth,"Streak day","Use","_Streakday")),i.streakData=o.getStreakData(i.streak.day),i.animationDuration=800,i.todayStreak=!(!n.streak||Date.now()-n.streak.update>=864e5),i.auth=n.auth,e.$on("today_streak_completed--start",function(n){let s=t.$on("today_streak_completed--new_tree--start",function(t){i.animationDuration=0,i.streak.day=0,$(".word_tree_image").fadeOut(100),a(function(){i.streakData={}},100);let n=e.$on("today_streak_completed--new_tree--end",function(e){i.animationDuration=800,i.todayStreak=!0,a(()=>{i.streak=o.getStreak(),i.streak_text=i.streak.day,i.streakData=o.getStreakData(i.streak.day),$(".word_tree_image").fadeIn(500)},100)});r.push(n)});r.push(s)}),i.$onDestroy=function(){r.map(function(e){e()})},i.toLearningWord=function(){e.random=1,e.isLearn_word=!0,e.isQuote=!1,e.elightube=!1,e.topic=!1},e.$on("today_streak_completed--old_tree",function(e){i.streak=o.getStreak(),i.todayStreak=!0,i.streak_text=i.streak.day,i.streakData=o.getStreakData(i.streak.day)});let s=0;!function e(){const t=document.getElementsByClassName("streak-slide");for(let e=0;e<t.length;e++)t[e].style.display="none";++s>t.length&&(s=1),t[s-1].style.display="block",setTimeout(e,1e4)}()}function wordController(e,t,n,o,a,i,r){let s=this;s.localesMessage=wordLocales;let l=n.unitSettingSelected?n.unitSettingSelected:n.unit&&n.unit.length>0?n.unit:[0],c=[],u=(n.wordReview,""),d=7,g=1e3;e.timesCorrect=0;let p=new Date;s.endingWords=n.learnedWord,t.disabledSend=!0,t.survey=!0,e.correctAnswer=0;let h=[];function m(){!n.wordReview&&localStorage.wordReview&&(n.wordReview=angular.copy(JSON.parse(localStorage.wordReview))),function(){let t=[],o="vn"===e.language?units.concat(toeicUnits).concat(grammarUnits).concat(communicationUnit):units;_.map(o,function(e){_.map(e.words,function(n){n.unitId=e.id,t.push({unitId:e.id,word:n.word})})}),_.map(n.wordReview,function(e){let n=_.find(t,function(t){return e.word===t.word});if(n)return e.unitId=n.unitId})}()}function f(){n.usedDate&&n.usedDate!==p.getDate()&&(n.learnedWord=[]),n.volume>=0?e.volume=n.volume:(n.volume=1,e.volume=1),$("#background_music").animate({volume:n.volume},1e3)}function v(){let t=localStorage.getItem("count");const o=_.isEmpty(t)?[91]:l;localStorage.setItem("count",JSON.stringify([1])),s.unitId=_.sample(o);let a="vn"===e.language?units.concat(toeicUnits).concat(grammarUnits).concat(communicationUnit):units,i=_.find(a,function(e){return e.id===s.unitId});c=i?i.words:[],u=i?i.title:"";let r=n.wordReview,d=_.filter(r,function(e){return e.unitId===s.unitId});if((d=_.sortBy(d,function(e){return new Date(e.reviewDate)})).length>=20){(function(e){let t,o=n.currentDate;if(o){let a=_.find(o.data,function(t){return t.unit===e});if(a){let n=new Date((new Date).toISOString().slice(0,10))-new Date(a.date),o=n/1e3/60/60/24;o>=1?a={date:(new Date).toISOString().slice(0,10),num:0,unit:e}:a.num++,t=a}else t={date:(new Date).toISOString().slice(0,10),num:0,unit:e},n.currentDate.data.push(t)}else n.currentDate={data:[],version:1},t={date:(new Date).toISOString().slice(0,10),num:0,unit:e},n.currentDate.data.push(t);return t.num})(i.id)>5?w(0,3,d):w(1,2,d)}else w(3,0,d)}function w(t,o,a){s.game=!0,s.ending=!1,s.topic_show=0,s.main_box=!0,e.checkLogin=!1;let i=[],r=_.pluck(c,"word").map(e=>e.toLowerCase()),l=_.pluck(a,"word").map(e=>e.toLowerCase()),d=_.difference(r,l),g=_.sample(d,t);_.map(g,function(e){let t=_.find(c,function(t){return t.word.toLowerCase()===e.toLowerCase()});t&&(t.old=!1,i.push(t))}),0===g.length?o+=t:g.length<3&&(o=3-g.length);let p=l.slice(0,10);if(p=_.sample(p,o),_.map(p,function(e){let t=_.find(c,function(t){return t.word.toLowerCase()===e.toLowerCase()});t&&(t.old=!0,i.push(t))}),n.preloadWords&&3===n.preloadWords.length){n.learnedWord=n.preloadWords,S(t,o,a,_.pluck(n.preloadWords,"word").map(e=>e.toLowerCase()))}else{n.learnedWord=_.shuffle(i),S(t,o,a,_.pluck(i,"word").map(e=>e.toLowerCase()))}let h=_.pluck(n.learnedWord,"word").map(e=>e.toLowerCase()),m=_.difference(h,l);n.selectedUnit={total:c.length,image:c[0].image,new_learn:m.length,title:u,newWord:d.length}}function S(e,t,o,a){let i=[],s=_.pluck(c,"word").map(e=>e.toLowerCase());s=_.difference(s,a);let l=_.pluck(o,"word").map(e=>e.toLowerCase());l=_.difference(l,a);let u=_.difference(s,l),d=_.sample(u,e);_.map(d,function(e){let t=_.find(c,function(t){return t.word.toLowerCase()===e.toLowerCase()});t&&(t.old=!1,i.push(t))}),0===d.length&&(t+=e);let g=l.slice(0,10);g=_.sample(g,t),_.map(g,function(e){let t=_.find(c,function(t){return t.word.toLowerCase()===e.toLowerCase()});t&&(t.old=!0,i.push(t))});let p=_.pluck(i,"image");r.preloadImages(p);let h=_.pluck(i,"audio");r.preloadAudios(h),n.preloadWords=_.shuffle(i)}function b(e){let t=n.auth;if(t&&t.user_token){let n=[];_.map(e,function(e){n.push({w:e.word,e:e.EF,i:e.I,a:e.Q,rd:e.reviewDate})}),o.syncWords(t.user_token,n)}}function y(){f(),v(),h=[{template:"app/components/lesson/words/game/views/flashcard.html",data:[n.learnedWord[0]]},{template:"app/components/lesson/words/game/views/flashcard.html",data:[n.learnedWord[1]]},{template:"app/components/lesson/words/game/views/choose_word.html",data:[n.learnedWord[0],n.learnedWord[1]],answer:n.learnedWord[0]},{template:"app/components/lesson/words/game/views/choose_picture_3.html",data:n.learnedWord,answer:n.learnedWord[1]},{template:"app/components/lesson/words/game/views/flashcard.html",data:[n.learnedWord[2]]},{template:"app/components/lesson/words/game/views/choose_picture_3.html",data:n.learnedWord,answer:n.learnedWord[0]},{template:"app/components/lesson/words/game/views/choose_word.html",data:[n.learnedWord[1],2==Math.floor(2*Math.random()+1)?n.learnedWord[0]:n.learnedWord[2]],answer:n.learnedWord[1]},{template:"app/components/lesson/words/game/views/choose_picture_3.html",data:n.learnedWord,answer:n.learnedWord[2]}],s.startGame()}sendGa(n.auth,"Learn word","Display","Learn_display"),e.$on("timesCount",function(){e.timesCorrect++}),e.$on("updateLearnWord",function(e){n.preloadWords=void 0;let t=n.learnedWord;n.learnedWord=void 0,f(),v(),n.learnedWord=t}),e.$on("reinit",function(){n.preloadWords=[],n.selectedUnits={},l=n.unitSettingSelected?n.unitSettingSelected:n.unit&&n.unit.length>0?n.unit:[0],m(),b(n.wordReview),y()}),t.nextStep=function(){t.survey=!0,t.disabledSend=!0,_gaq.push(["_trackEvent","EE Features","Topics","Step"]),e.progress++,e.progress>d?s.finishGame():(s.data=h[e.progress].data,s.answer=h[e.progress].answer,e.template=h[e.progress].template,_.each(s.data,function(e,t){e.checked&&(s.data[t].checked=!1)}))},t.nextGame=function(){e.backgroundMusic&&!e.checkLogin&&$("#background_music").animate({volume:n.volume},g),$(".arrow_box").hide(200),e.progress=0,e.correctAnswer=0,$(".ui_input").attr("checked",!1),t.survey=!0,t.disabledSend=!0,y()},s.finishGame=function(){sendGa(n.auth,"Learn word","Completed","Learn_completed game"),$(".class-word").hide(),o.storeWord(n.learnedWord).then(function(e){b(e)}).catch(function(e){console.log(e)}),n.syncWord||(b(n.wordReview),n.syncWord=!0),n.learned=!0,s.endingWords=n.learnedWord,n.learnedWord=[],n.updatedWord=[],e.backgroundMusic&&1==n.volume&&$("#background_music").animate({volume:.4},g),e.showChallengeNoti||a(e.checkConditionPushChallengeNoti,1e3),s.game=!1,s.ending=!0},s.startGame=function(){e.progress=0,s.data=h[e.progress].data,e.template=h[e.progress].template},$(document).mouseup(function(e){let t=$(".arrow_box");t.is(e.target)||0!==t.has(e.target).length||$(".feedback_icon").is(e.target)||t.hide()}),s.showFeedbackDiv=function(){$(".arrow_box").toggle(300)},s.checkDisable=function(){let e=$("#survey_form input:checkbox:checked").length;setTimeout(function(){e.length>0?t.disabledSend=!1:t.disabledSend=!0},300)},s.calculatePercent=function(e,t){return Math.floor(e/t*100)+"%"},s.toggleVolume=function(){void 0===n.volume?(n.volume=1,e.volume=1,$("#background_music").animate({volume:n.volume},500)):(n.volume=0==n.volume?1:0,e.volume=n.volume,$("#background_music").animate({volume:n.volume},500))},t.sendReport=function(){$(".survey_div").fadeOut(500,function(){t.survey=!1,$(".elight_thank_you").fadeIn(500)});let e=$("#content_error").prop("checked")?"Yes":"No",n=$("#image").prop("checked")?"Yes":"No",o={"entry.23121512":s.data[0]?s.data[0].word:0,"entry.1328524160":e,"entry.1765249265":n};$.ajax({method:"POST",url:"https://docs.google.com/forms/d/1kMxdmoIBoXhONiaSafDHGGNB-k8I5owZ63lpOaTfhYU/formResponse",data:o})},m(),y()}function endGameController(e,t,n,o,a,i,r,s){n.unlock=!0;let l=this;l.userBannerType=i.guest_id%2;let c=[];i.rating||(i.rating=0),i.auth&&(i.auth.actived_code.count_use_code>0||i.auth.actived_code.count_user_courses>0)&&(l.isClose=!0),l.auth=i.auth,a.auth=i.auth,o.timesCorrect=a.timesCorrect,o.showTitle=!1,o.showProgress=!1,o.showScore=!1,o.showNextTitle="",o.titleEnd="Bạn vừa đạt được",o.badge=a.badge||i.badge;let u=i.selectedUnit;o.unit=u,c.push(e(function(){let e=t.load("assets/audio/woosh.mp3");e.setVolume(.2),e.play()},600)),c.push(e(function(){let e=t.load("assets/audio/correct_trimmed.mp3");e.setVolume(.1),e.play()},3e3)),c.push(e(function(){let e=u.new_learn,t=u.total-u.newWord,n=u.newWord-e;AmCharts.makeChart("process_unit",{type:"pie",theme:"light",dataProvider:[{title:"vn"===a.language?"Đã học":"Aprendido",value:t,color:"#c0c0c0",colorTitle:"#ffffff"},{title:"vn"===a.language?"Luyện tập":"Prática",value:3-e,color:"#fff3a6",colorTitle:"#ffffff"},{title:"vn"===a.language?"Mới học":"Novo estudo",value:e,color:"#f59000",colorTitle:"#ffffff"},{title:"vn"===a.language?"Chưa học":"Ainda não aprendeu",value:n,color:"#E5E6E5",colorTitle:"#ffffff"}],titleField:"title",valueField:"value",labelRadius:10,radius:"22%",colorField:"color",innerRadius:"80%",labelText:"[[title]]: [[value]] ",startDuration:0})},3500)),a.auth&&(a.auth.actived_code.count_user_courses>0||a.auth.actived_code.count_use_code>0)&&c.push(e((...e)=>e,3e3,!0).then(function(t){return $(".contain_progress").fadeOut(2e3),e((...e)=>e,2e3,!0,t)}).then(function(t){return o.showScore=!0,e((...e)=>e,1e3,!0,t)}).then(function(t){return o.showProgress=!0,e((...e)=>e,1e3,!0,t)}).then(function(e){a.auth.total_score=parseInt(a.auth.total_score?a.auth.total_score:0)+parseInt(o.timesCorrect);var t=_.find(score_level,function(e){return a.auth.total_score>=e.min_star&&a.auth.total_score<=e.max_star});return i.badge&&i.badge.grade!==t.grade&&(o.nextGrade=!0),o.grade_levels=_.where(score_level,{grade:a.badge.grade}),o.grade=badge_level[a.badge.grade-1],a.badge=t,s.updateScore(a.timesCorrect)}).then(function(t){if(o.nextGrade)return $(".progress-wrapper").removeClass("zoomIn").fadeOut(),$(".header-score").removeClass("bounceIn").fadeOut(),$(".progress_detail").removeClass("zoomIn").fadeOut(),e((...e)=>e,1e3,!0,t)}).then(function(e){o.nextGrade&&($(".header-score").fadeIn(1e3),o.showScore=!1,o.showNextTitle=o.grade,o.titleEnd='Bạn đã thăng cấp lên "'+badge.content.split(":")[1].trim()+'"')}));let d=r.increaseStreak();if(i.auth&&d){o.$emit("today_streak_completed--start");let n=r.getStreakData(d.old),i=r.getStreakData(d.new);l.streak=d.old,n.image!==i.image?(l.streakData=n,c.push(e(function(){let e=t.load("assets/audio/CHIMES.WAV");e.setVolume(.1),e.play()},7e3)),e((...e)=>e,9500,!0,i).then(function(t){return a.$broadcast("today_streak_completed--new_tree--start"),e((...e)=>e,1e3,!0,t)}).then(function(e){l.streak=_.flatten(e)[0].day}).then(function(t){return e((...e)=>e,500,!0,t)}).then(function(t){return l.streakData=_.flatten(t)[0],e((...e)=>e,500,!0)}).then(function(){a.$broadcast("today_streak_completed--new_tree--end"),$(".learn-continue").fadeIn(500)})):(l.streakData=i,c.push(e(function(){c.push(e(()=>{a.$broadcast("today_streak_completed--old_tree"),l.streak++;let e=l.streak;_gaq.push(["_trackEvent","Streak Day",e.toString(),""]),$(".learn-continue").fadeIn(500)},1e3))},9500)))}else e(function(){(!i.auth||i.auth&&i.auth.actived_code.count_use_code>0||i.auth.actived_code.count_user_courses>0||i.auth.actived_code.new_code>0)&&(l.freeUser=_.sample(linkFreeUser)),$(".learn-continue, .link_FreeUser").fadeIn(500)},3500);function g(e,t){_gaq.push(["_trackEvent","Word practice","Practice","Completed a word practice"]),_.map(e,function(e){let n=t?t+"_"+e.word:"";_gaq.push(["_trackEvent","Word notebook","Add",n])})}l.$onDestroy=function(){c.map(t=>e.cancel(t))},l.trackingFreeUser=function(e,t){_gaq.push(["_trackEvent","Ending Game Call to action",e,t]),chrome.tabs.create({url:e})},o.nextGame=function(){let e=localStorage.user;if(e){let t=JSON.parse(e);o.$parent.nextGame(),g(l.words,t.id),i.unit.length<2&&(a.showWelcome="topic2")}else g(l.words),a.checkLogin=!0,o.$parent.nextGame(),$("#background_music").animate({volume:0},1e3),a.showWelcome="recommend";i.rating<3&&i.rating++,2===i.rating&&swal({title:"vn"===a.language?"Bạn có thích tiện ích học từ vựng của Elight không?":"Do you like Learning English With Elight?",imageUrl:"assets/images/heart.png",showCancelButton:!0,customClass:"customRating",cancelButtonText:"vn"===a.language?"Không thích":"Dislike",confirmButtonColor:"#DD6B55",confirmButtonText:"vn"===a.language?"Rất thích":"Like",closeOnConfirm:!1},function(e){e?swal({title:"vn"===a.language?"Hãy tặng Elight 5 sao để cổ vũ chúng mình nhé":"Give us 5 stars will you?",imageUrl:"assets/images/star.png",confirmButtonColor:"#DD6B55",customClass:"customRating",confirmButtonText:"vn"===a.language?"Tặng ngay":"Okay",allowOutsideClick:!0,closeOnConfirm:!0},function(e){e&&chrome.tabs.create({url:"https://chrome.google.com/webstore/detail/"+chrome.runtime.id+"/reviews"})}):chrome.tabs.create({url:"https://docs.google.com/forms/d/e/1FAIpQLSd8_NNRWAE5y25WlBr__SHvIZtu43gfuenykhGZcjk8Lj5rPw/viewform?c=0&w=1"})}),a.timesCorrect=0},l.trackingBanner=function(e){var t=e.toString();_gaq.push(["_trackEvent","Game BN","Go To LP",t])},l.closeBanner=function(){l.isClose=!0}}function gameDirective(){return{scope:{template:"=",data:"=",index:"=",answer:"="},restrict:"E",template:"<div ng-include='template' id='game_main_div' class=''></div>",link:function(e,t,n){},controller:["$scope","$attrs","$timeout",function(e,t,n){var o=new Audio("assets/audio/learn_word/next_question.mp3");o.volume=.4,e.nextStep=function(){e.$parent.nextStep(),applyScope(e),AkiraAnimation("#main_flow_box","zoomOut"),n(function(){AkiraAnimation("#main_flow_box","zoomIn")},100),o.play()}}]}}function loginSuccess(){return{scope:{},restrict:"E",templateUrl:"app/components/login/login-success.template.html",controller:["$scope","$rootScope","$localStorage",function(e,t,n){e.chooseTopic=function(){$("#logedin_success_modal").modal("hide"),$("#profile_modal").modal("hide"),$(".modal-backdrop.in").hide(),t.showWelcome="topic2",delete t.freeUser,delete t.openLoginFromOutside},e.learn=function(){$("#logedin_success_modal").modal("hide"),$("#profile_modal").modal("hide"),$(".modal-backdrop.in").hide(),t.welcome=!0,n.welcome=!0,t.showWelcome="",delete t.freeUser,delete t.openLoginFromOutside},e.localesMessage=loginLocales}]}}function MissionController(e,t,n,o){e.completed=!1,e.minimum=!!o.minimumClap&&o.minimumClap,e.hide=!0;let a=o.auth?o.auth.user_token:"";e.hideMission=function(t){e.minimum=!t,o.minimumClap=!t},a&&(o.auth.actived_code.count_use_code>0||o.auth.actived_code.count_user_courses>0)?t.getMissions(a,37).then(function(t){2===t.status?e.completed=!0:e.tasks=t.data,e.hide=!1}).catch(function(t){e.hide=!0}):e.hide=!0}function MissionControllerDetail(e){e.$on("mission_update",function(){e.mission=localDB.getCollection("mission").data})}function akiMission(){return{scope:{old:"="},restrict:"E",templateUrl:"app/components/mission/index.html",link:function(e,t,n){},controller:"MissionController"}}function akiMissionDetail(){return{scope:{mission:"="},restrict:"E",replace:!0,transclude:!0,templateUrl:"app/components/mission/list.html",link:function(e,t,n){},controller:"MissionControllerDetail"}}function akiMissionItem(e,t,n){return{scope:{current:"@",total:"@",title:"@",description:"@",day:"@",type:"@",data:"="},restrict:"E",templateUrl:"app/components/mission/item.html",link:function(e,o,a){e.dateMission=new Date;let i=t.auth.user_token;if(e.toDoMission=function(o){switch(parseInt(o)){case 1:t.auth.current_lesson=e.data.title.split("Hoàn thành")[1].trim(),location.href="https://elight.edu.vn/tieng-anh-online/dashboard/game/"+e.data.link;break;case 2:t.auth.current_lesson=e.data.title.split("Ôn tập")[1].trim(),location.href="https://elight.edu.vn/tieng-anh-online/dashboard/game/"+e.data.link;break;case 3:location.href="https://elight.edu.vn/tieng-anh-online";break;case 4:0===e.total.status&&(n.finishTaskNew(i,e.data.id),e.fullStar={current:1,total:1});break;case 5:case 6:location.href="https://elight.edu.vn/tieng-anh-online"}},1===parseInt(e.type)&&0===e.data.status){let o=t.auth.user_token,a=e.data.asset;n.getScoreLesson(o,parseInt(a)).then(function(t){t.total_score/t.number_of_question>=.8?(n.finishTaskNew(o,e.data.id),e.fullStar={current:1,total:1}):e.fullStar={current:t.total_score,total:t.number_of_question}}).catch(function(e){console.log(response)})}4===parseInt(e.type)&&0===e.total.status&&(n.finishTaskNew(i,e.data.id),e.fullStar={current:1,total:1})}}}function progressLineController(e,t,n,o){e.error=!1,e.auth=t.auth,e.auth&&(e.auth.actived_code.count_use_code>0||e.auth.actived_code.count_user_courses>0)?n.getAllStar(326).then(function(e){if(1===e.data.code){t.auth.total_score=e.data.total_score;var n=_.find(score_level,function(e){return t.auth.total_score>=e.min_star&&t.auth.total_score<=e.max_star});n||(n=score_level[29]),t.badge=n,o.badge=n}}).catch(function(t){console.log(t),e.error=!0}):e.error=!0,n.getBadgeLevel().then(function(t){e.all_score_badges=t})}function progressLine(e){return{link:function(e,t,n){},restrict:"E",scope:{},templateUrl:"app/components/progressLine/index.html",controller:"progressLineController"}}app.config(["$compileProvider","$httpProvider",function(e,t){e.imgSrcSanitizationWhitelist(/^\s*((https?|ftp|file|blob|chrome-extension):|data:image\/)/),t.defaults.useXDomain=!0,t.defaults.headers.post["Access-Control-Allow-Origin"]="*",t.defaults.headers.post["Access-Control-Allow-Headers"]="Content-Type, Access-Control-Allow-Headers, Authorization, X-Requested-With,Access-Control-Allow-Origin",t.useApplyAsync(!0)}]),app.constant("API_URL","https://api.elight.edu.vn/v3/"),app.run(["$rootScope",function(e){function t(t){if($(".modal.in").length<=1){if(13===t.keyCode)try{e.$broadcast("checkEnter",{key:t.keyCode})}catch(e){console.log("error ENTER PRESS")}"1"!==t.key&&"2"!==t.key&&"3"!==t.key||e.$broadcast("chooseAnswer",{key:t.key}),32===t.keyCode&&e.$broadcast("flipCard",{key:t.keyCode})}}e.io=io.sails.connect(),$(document).ready(function(){$(document).keypress(t)})}]),app.filter("dateFormat",function(){return function(e){return e.getDate()+"/"+(e.getMonth()+1)+"/"+e.getFullYear()}}),app.filter("validateEmailDomain",function(){return function(e){if(e){var t=e.split("@");if(2===t.length){var n=t[1].split(".");if(""!==n[length-1]&&""!==n[0])return!0}}return!1}}),app.directive("onError",function(){return{restrict:"A",scope:{classLoading:"@"},link:function(e,t,n){e.classLoading&&$(".loading-"+e.classLoading).show();let o="imageError.png";(angular.isUndefined(n.ngSrc)||""===n.ngSrc)&&n.$set("src","assets/images/"+o),t.bind("load",function(){e.classLoading&&$(".loading-"+e.classLoading).hide()}),t.bind("error",function(){n.src!==n.errSrc&&n.$set("src","assets/images/"+o)})}}}),app.directive("focusMe",["$timeout","$parse",function(e,t){return{link:function(n,o,a){var i=t(a.focusMe);n.$watch(i,function(t){!0===t&&e(function(){o[0].focus()})}),o.bind("blur",function(){"function"==typeof i.assign&&n.$apply(i.assign(n,!1))})}}}]),app.directive("onErrorAvatar",["$localStorage",function(e){return{restrict:"A",link:function(e,t,n){var o="assets/images/avatar/ava"+Math.round(n.alt?n.alt.length%19+1:1)+".png";(angular.isUndefined(n.ngSrc)||""===n.ngSrc)&&n.$set("src",o),t.bind("error",function(){n.src!=n.errSrc&&n.$set("src",o)})}}}]),window.fbAsyncInit=function(){FB.init({appId:"223689894808165",xfbml:!0,version:"v2.9"}),FB.AppEvents.logPageView()},angular.module("app.controller",["ui.bootstrap"]).controller("mainController",mainController),mainController.$inject=["$scope","mainService","$rootScope","$timeout","$localStorage","challenge.io.service","challenge.items.service","user.service"],angular.module("focus.directive",[]).directive("focusMe",["$timeout","$parse",function(e,t){return{link:function(n,o,a){var i=t(a.focusMe);n.$watch(i,function(t){!0===t&&e(function(){o[0].focus()})}),o.bind("blur",function(){"function"==typeof i.assign&&n.$apply(i.assign(n,!1))})}}}]),angular.module("popoverAutoclose.directive",[]).directive("popoverAutoclose",["$timeout",function(e){return{restrict:"A",link:function(t,n,o){n.on("click",function(t){t.stopImmediatePropagation(),e(function(){n.next().hasClass("popover")&&n.trigger("click")},o.popoverAutoclose)})}}}]),angular.module("scrollLazyload.directive",[]).directive("scrollLazyload",[function(){return{restrict:"A",scope:{scrollLazyload:"<"},link:function(e,t,n){t.on("wheel",function(n){t[0].scrollHeight-t[0].scrollTop-t[0].clientHeight<=80&&e.scrollLazyload()}),t.on("$destroy",function(e){t.off("wheel")})}}}]),angular.module("tooltip.directive",[]).directive("bsTooltip",function(){return{restrict:"A",link:function(e,t,n){$(t).hover(function(){$(t).tooltip("show")},function(){$(t).tooltip("hide")})}}}),angular.module("footer.setting",[]),angular.module("footer.video",[]),angular.module("header.navigator",[]),angular.module("header.searchBox",[]),angular.module("lesson.challenge_new",[]),angular.module("lesson.elightube",[]),angular.module("lesson.quote",[]),angular.module("lesson.topic",[]),angular.module("lesson.word",["ui.bootstrap"]),angular.module("mainScreen.end-game",[]),angular.module("basic-guideline",[]),angular.module("inviteFriend",[]),angular.module("login",[]),angular.module("mainScreen",[]),angular.module("aki.mission",[]),angular.module("notebook",["ui.bootstrap"]),angular.module("offline",[]),angular.module("profile",[]),angular.module("aki.progressbar",[]),angular.module("welcome",[]),angular.module("app.service",[]).service("mainService",mainService),mainService.$inject=["$http"],angular.module("inviteFriend",[]).service("inviteFriendService",["$http",function(e){let t={getInviteByUserId:function(t){return e({method:apis.getInviteByUserId.method,url:apis.getInviteByUserId.url,params:{guest_id:t.guest_id}}).then(function(e){return e.data}).catch(function(e){console.log(e)})},invite:function(t){return e({method:apis.invite.method,url:apis.invite.url,data:{guest_id:t.guest_id}}).then(function(e){return e.data}).catch(function(e){console.log(e)})},updateUserInvitation:function(t){return e({method:apis.updateInvitation.method,url:apis.updateInvitation.url,data:t}).then(function(e){return e.data}).catch(function(e){console.log(e)})}};return t}]),angular.module("aki.mission").factory("MissionService",MissionService),MissionService.$inject=["$http","$q","API_URL"],angular.module("profile.service",[]).service("ProfileService",["$http","$q","API_URL",function(e,t,n){var o={updateAvatar:function(o,a){var i={url:o,user_token:a},r=t.defer();return e({method:"POST",url:n+"change-avatar-user",data:i}).then(function(e){r.resolve(e)},function(e){r.reject(e)}),r.promise},updateProfile:function(n,o,a){var i={display_name:n,school:o,user_token:a},r=t.defer();return e({method:apis.profileUpdate.method,url:apis.profileUpdate.url,params:i}).then(function(e){r.resolve(e)},function(e){r.reject(e)}),r.promise},updateUserInfo:function(n,o,a,i,r){var s={guestId:n,username:o,avatar:a,schoolId:i,schoolName:r},l=t.defer();return e({method:apis.updateUserInfo.method,url:apis.updateUserInfo.url,params:s}).then(function(e){l.resolve(e.data)},function(e){l.reject(e)}),l.promise}};return o}]),angular.module("aki.progressbar").factory("progressLineService",progressLineService),progressLineService.$inject=["$http","API_URL","$q","$localStorage"],angular.module("challenge.service.io",[]).service("challenge.io.service",["$localStorage","$rootScope",function(e,t){let n={},o=t.io,a=apis;return n.isConnected=function(){return o.isConnected()},n.subcribeUser=function(e,t,n,o,r,s,l){let c={username:t,userId:n,guestId:o,email:e,avatar:r,school:s};return i({method:a.subcribeUser.method,url:a.subcribeUser.url,data:c})},n.onSubcribeUser=function(e){o.on(a.onSubcribeUser.url,function(t){e(t)})},n.onUpdateUserStatusInGame=function(e){o.on(a.onUpdateUserStatusInGame.url,function(t){e(t)})},n.onUpdateUserStatusLeaveGame=function(e){o.on(a.onUpdateUserStatusLeaveGame.url,function(t){e(t)})},n.getUserList=function(e){return i({method:a.getUser.method,url:a.getUser.url,data:{userIgnore:e}})},n.updateUserList=function(e){o.on(a.updateUser.url,function(t){e(t)})},n.onDisconnect=function(e){o.on(a.onDisconnect.url,function(t){e(t)})},n.getQuestionData=(()=>{return i({method:a.getQuestionData.method,url:a.getQuestionData.url,data:{roomName:roomName}})}),n.checkCountDownReady=(e=>{return i({method:a.checkCountDownReady.method,url:a.checkCountDownReady.url,data:{roomName:e}})}),n.updateOpponentLoadDataProgress=((e,t)=>{let n={roomName:e,opponentProgress:t};return i({method:a.updateOpponentLoadDataProgress.method,url:a.updateOpponentLoadDataProgress.url,data:n})}),n.finishPreload=(()=>{let e={roomName:roomName};return i({method:a.finishPreload.method,url:a.finishPreload.url,data:e})}),n.answer=((e,t,n)=>{let o={answer:e,currentQuestionIndex:t,roomName:n};return i({method:a.answer.method,url:a.answer.url,data:o})}),n.useSkill=((e,t,n)=>{let o={skill:e,roomName:t,guestId:n};return i({method:a.useSkill.method,url:a.useSkill.url,data:o})}),n.onQuestionDataRes=(e=>{o.on("sendQuestionData",e)}),n.onMatchStart=(e=>{o.on("matchStart",e)}),n.onPlayerAnswer=(e=>{o.on("playerAnswer",function(t){e(t)})}),n.onPlayerAnswerResult=(e=>{o.on("playerAnswerResult",function(t){e(t)})}),n.onPlayerUseSkill=(e=>{o.on("playerUseSkill",function(t){e(t)})}),n.onMatchEnd=(e=>{o.on("matchEnd",e)}),n.onOpponetLoadData=(e=>{o.on(a.onOpponetLoadData.url,function(t){e(t)})}),n.onReadyToCountDown=(e=>{o.on(a.onReadyToCountDown.url,e)}),n.inviteUserByUserId=function(t,n){let o={username:t.display_name,userId:t.id,hostGuestId:e.guest_id,opponentGuestId:n,avatar:t.avatar,school:t.school};return i({method:a.inviteByUserId.method,url:a.inviteByUserId.url,data:o})},n.onInviteUser=function(e){o.on(a.onInviteUser.url,function(t){e(t)})},n.updateUserStatus=function(e,t){let n={guestId:e,status:t};return i({method:a.updateUserStatus.method,url:a.updateUserStatus.url,data:n})},n.getUserStatus=function(e){let t={guestId:e};return i({method:a.getUserStatus.method,url:a.getUserStatus.url,data:t})},n.disconnect=function(e){let t={guestId:e};return i({method:a.disconnect.method,url:a.disconnect.url,data:t})},n.getRecentOpponents=function(e,t){let n={guestId:e};return i({method:a.getRecentOpponents.method,url:a.getRecentOpponents.url,data:n})},n.leaveRoom=function(e){let t={roomName:e};return i({method:a.leaveRoom.method,url:a.leaveRoom.url,data:t})},n.onLeaveRoom=function(e){o.on("opponent-leave-room",function(t){e(t)})},n.denyInvite=function(e,t){let n={roomName:e,hostSocketId:t};return i({method:a.denyInvite.method,url:a.denyInvite.url,data:n})},n.onDenyInvite=function(e){o.on(a.onDenyInvite.url,function(t){e(t)})},n.acceptInvite=function(e,t,n){let o={roomName:e,player1:t,player2:n};return i({method:a.acceptInvite.method,url:a.acceptInvite.url,data:o})},n.onAcceptInvite=function(e){o.on(a.onAcceptInvite.url,function(t){e(t)})},n.onReadyBeforeLoadGame=function(e){o.on("readyBeforeLoadGame",function(t){e(t)})},n.oneMessage=function(e){o.on("message",function(t){e(t)})},n.sendFinishStatus=function(e,t,n){let o={roomName:e,guestId:t,is_bot:n};return i({method:a.finish.method,url:a.finish.url,data:o})},n.onFinish=function(e){o.on("match-finish",function(t){e(t)})},n.sendRematchRequest=function(e){let t={roomName:e};return i({method:a.playAgain.method,url:a.playAgain.url,data:t})},n.acceptRematchRequest=function(e,t,n){let o={roomName:e,player1:t,player2:n};return i({method:a.acceptPlayAgain.method,url:a.acceptPlayAgain.url,data:o})},n.rejectRematchRequest=function(e){let t={roomName:e};return i({method:a.rejectPlayAgain.method,url:a.rejectPlayAgain.url,data:t})},n.onReceiveRematchRequest=function(e){o.on("request-play-again",function(t){e(t)})},n.onRejectRematchRequest=function(e){o.on("play-again-request-rejected",function(t){e(t)})},n.onAcceptRematchRequest=function(e){o.on("play-again-request-accepted",function(t){e(t)})},n.onOpponentDisconnected=function(e){o.on("opponent-disconnect",function(t){e(t)})},n.onPlayerDisconnected=function(e){o.on("opponent-disconnect",function(t){e(t)})},n.onOpponentRequestFinish=function(e){o.on("request-finish",function(t){e(t)})},n.onOpponentDoneRequestFinish=function(e){o.on("done-request-finish",function(t){e(t)})},n.onOpponentDisconnect=function(e){o.on("opponent-disconnect",function(t){e(t)})},n.syncLocalItems=(e=>{return i({method:a.syncLocalItems.method,url:a.syncLocalItems.url,data:e}).then(e=>e)}),n.fetchItems=(e=>{return i({method:a.fetchItems.method,url:a.fetchItems.url,data:{guest_id:e.guest_id}}).then(e=>e)}),n.useItem=((e,t,n)=>{return i({method:a.useItem.method,url:a.useItem.url,data:{item:e,roomName:t,guestId:n}}).then(e=>e)}),n.fetchBonusStat=(()=>{return i({method:a.fetchBonusStat.method,url:a.fetchBonusStat.url}).then(e=>e)}),n.openGoldChest=(()=>{return i({method:a.openGoldChest.method,url:a.openGoldChest.url}).then(e=>e)}),n.openSilverChest=(()=>{return i({method:a.openSilverChest.method,url:a.openSilverChest.url}).then(e=>e)}),n.openWinChest=(()=>{return i({method:a.openWinChest.method,url:a.openWinChest.url}).then(e=>e)}),n.receiveInviteItems=(()=>{return i({method:a.receiveInviteItems.method,url:a.receiveInviteItems.url}).then(e=>e)}),n.openInviteChest=(()=>{return i({method:a.openInviteChest.method,url:a.openInviteChest.url}).then(e=>e)}),n.getTokenGuestId=(e=>{return i({method:a.getTokenGuestId.method,url:a.getTokenGuestId.url,data:{guest_id:e}})}),n.getBotInfo=(e=>{let t=a.getBotInfo.url;return e&&(t=`${t}?guest_id=${e}`),i({method:a.getBotInfo.method,url:t})}),n;function i(t){let n=e.auth||{},a=e.token_guest_id||"";return(t=t||{}).headers={authorization:`Bearer ${n.user_token}`,tokens:a},new Promise((e,n)=>{o.request(t,(t,n)=>e(t))})}}]),angular.module("challenge.items",[]).service("challenge.items.service",challengeItemService),challengeItemService.$inject=["$http","$localStorage","challenge.io.service"],angular.module("challenge.service",[]).service("challengeService",["$http","$localStorage","$q",function(e,t,n){let o={};var a=JSON.parse(localStorage.getItem("user"));if(a&&a.user_token)a.user_token;else;function i(){let n=t.warPlayerState;if(null!=n||void 0!=n)return e({method:apis.warUpdate.method,url:apis.warUpdate.url,params:{user_token:t.auth&&t.auth.user_token?t.auth.user_token:"",win_number:n.win_number,lose_number:n.lose_number,total_score:n.total_score}}).then(function(e){return localStorage.removeItem("war-updating"),e}).catch(function(e){console.log(e)})}function r(){return e({method:apis.getPlayerStat.method,url:apis.getPlayerStat.url,headers:{tokens:t.token_guest_id||""}}).then(function(e){if(e.data.data){var t=e.data.data;t.win_number=t.score,t.win_rate=(n=t.score,o=t.lose_number,n?100*(n/(n+o)).toFixed(2):0)}else;var n,o;return t}).catch(function(e){console.log(e)})}return localStorage.getItem("war-updating")&&i(),o.createSchool=function(t){return e({method:apis.createSchool.method,url:apis.createSchool.url,data:{schoolName:t}}).then(function(e){return e.data}).catch(function(e){console.log(e)})},o.getPlayerStat=function(){let e=t.warPlayerState;if(null===e||void 0===e)return r().then(function(e){return null===e?t.warPlayerState=[]:(t.warPlayerState=e,t.lastTimeGetPlayerStat=(new Date).getTime()),e});var n=((new Date).getTime()-t.lastTimeGetPlayerStat)/864e5;return!t.lastTimeGetPlayerStat||n>=1?(r().then(function(n){t.lastTimeGetPlayerStat=(new Date).getTime(),_.isEqual(n,e)||localStorage.getItem("war-updating")||(t.warPlayerState=n)}),Promise.resolve(e)):Promise.resolve(e)},o.updatePlayerStat=function(e,n){t.warPlayerState=function(e,n){let o=t.warPlayerState;return null==o||void 0==o?o={total_score:n,win_number:"win"==e?1:0,lose_number:"win"==e?0:1,winrate:"win"==e?100:0}:("win"==e?o.win_number++:o.lose_number++,o.total_score+=n,t.warPlayerState=o,o)}(e,n),"win"===e&&t.auth&&t.auth.school&&(t.auth.school.score+=1)},o.updateUserScoreAfterLogin=function(n,o,a,r){return e({method:apis.warUpdate.method,url:apis.warUpdate.url,params:{user_token:t.auth&&t.auth.user_token?t.auth.user_token:"",win_number:n,lose_number:o,total_score:a}}).then(function(e){return localStorage.removeItem("war-updating"),delete t.warGuestState,e}).then(function(e){console.log(e)}).catch(function(e){i(),console.log(e)})},o.feedbackContent=function(t){return e({method:apis.feedbackContent.method,url:apis.feedbackContent.url,data:t}).then(function(e){return e.data}).catch(function(e){console.log(e)})},o.findCurrentSeason=function(t){return e({method:apis.currentSeason.method,url:apis.currentSeason.url}).then(function(e){t(e.data)}).catch(function(e){t(null,e)})},o.getTopUsers=function(t,n){return e({method:apis.getTopUsers.method,url:apis.getTopUsers.url,params:{limit:t}}).then(function(e){n(e.data)}).catch(function(e){n(null,e)})},o.getTopUserBySchool=function(t,n,o){return e({method:apis.getTopUserBySchool.method,url:apis.getTopUserBySchool.url,params:{limit:t,school:n}}).then(function(e){o(e.data)}).catch(function(e){o(null,e)})},o.getTopSchools=function(t,n){return e({method:apis.getTopSchools.method,url:apis.getTopSchools.url,params:{limit:t}}).then(function(e){n(e.data)}).catch(function(e){n(null,e)})},o.getTopSchoolByTotalStudent=function(t){return e({method:apis.getTopSchoolByTotalStudent.method,url:apis.getTopSchoolByTotalStudent.url}).then(function(e){t(e.data)}).catch(function(e){t(null,e)})},o.getUserRank=function(t,n,o){return e({method:apis.getUserRank.method,url:apis.getUserRank.url,params:{guestId:t,schoolId:n}}).then(function(e){o(e.data)}).catch(function(e){o(null,e)})},o.getSchoolRank=function(t,n){return e({method:apis.getSchoolRank.method,url:apis.getSchoolRank.url,params:{schoolId:t}}).then(function(e){n(e.data)}).catch(function(e){n(null,e)})},o.sendInfoToReceiveGift=function(t,n,o,a,i,r){return e({method:apis.newUserReceiveGift.method,url:apis.newUserReceiveGift.url,data:{guestId:t,name:n,phoneNum:o,email:a,address:i}}).then(function(e){r&&r(e.data)}).catch(function(e){r&&r(null,e)})},o}]),angular.module("dailyTask.service",[]).service("dailyTaskService",["$rootScope","$injector",function(e,t){let n={},o=JSON.parse(localStorage.getItem("dailyTask"));return n.generateTask=function(){let e=localStorage.getItem("genDate");null!=e&&void 0!=e||(e=0);let n=new Date;if(n.setHours(0,0,0,0),e<(n=n.getTime())||null==o||void 0==o){let n;o=[],e=Date.now(),localStorage.setItem("genDate",e),n||(n=t.get("wordMemo")),localStorage.setItem("finished",0);let i=n.checkReview(),r=[];r=i.length>0?_.sample(_.range(5),3):_.sample(_.range(1,5),3);for(var a=0;a<r.length;a++){let e=angular.copy(dailyTasks[r[a]]);e.current=0,e.id=a,"practice"===e.type?e.target=i.length:"newWord"===e.type?e.target=Math.floor(8*Math.random()+3):"challenge"===e.type?e.target=Math.floor(3*Math.random()+1):"like"===e.type?(e.target=Math.floor(3*Math.random()+1),1===e.target?(e.targetType=_.sample(["collocation","quote","idiom"]),e.type=e.type+"_"+e.targetType):(e.targetType=_.sample(["collocations","quotes","idioms"]),e.type=e.type+"_"+e.targetType,e.type=e.type.slice(0,-1))):"save"===e.type&&(e.target=Math.floor(5*Math.random()+3)),o.push(e)}}return o},n.updateTask=function(t){if(null!=o&&void 0!=o){let n=_.findWhere(o,{type:t});if(null==n||void 0==n)return;if(n.current<n.target&&(n.current++,n.current===n.target)){let t=localStorage.getItem("finished");if(t++,localStorage.setItem("finished",t),o.indexOf(n)<o.length-t){let e=o[o.indexOf(n)].id;o[o.indexOf(n)].id=o[o.length-t].id,o[o.length-t].id=e,e=o[o.indexOf(n)],o[o.indexOf(n)]=o[o.length-t],o[o.length-t]=e}e.$broadcast("taskFinished",n.type,t)}}},n.checkDone=function(){if(null==o||void 0==o)return!1;return _.every(o,function(e){return e.current===e.target})},window.onbeforeunload=function(){localStorage.setItem("dailyTask",JSON.stringify(o))},n}]),angular.module("experience.service",[]).service("levelExpService",[function(){let e={initializing:function(){localStorage.setItem("exp",0),localStorage.setItem("lvl",1)},getRequireExp:function(e){return Math.round(1.5*Math.max(50*Math.log(e)/Math.log(15),Math.sqrt(Math.max(0,e-2))/(.048*Math.sqrt(2)),Math.sqrt(Math.max(0,e-5)/.004)))},getCurrentExp:function(){return localStorage.getItem("exp")},getCurrentLevel:function(){return localStorage.getItem("lvl")},gainExp:function(t,n,o){"newWord-save"===t&&"newWord-next"===t&&"notebook-search"===t&&"notebook-save"===t&&"like"===t?localStorage.setItem("exp",localStorage.getItem("exp")+1):"flashcard"===t?localStorage.setItem("exp",localStorage.getItem("exp")+2):"practice"===t&&"recording"===t?localStorage.setItem("exp",localStorage.getItem("exp")+n):"war"===t&&localStorage.setItem("exp",localStorage.getItem("exp")+n+(15-Math.ceil(Math.max(0,o-30)/3))),localStorage.getItem("exp")>=e.getRequireExp(e.getCurrentLevel())&&(localStorage.setItem("exp",0),localStorage.setItem("lvl",e.getCurrentLevel()+1))}};return e}]),angular.module("firebase.service",[]).service("firebaseService",["$http","$q",function(e,t){let n={getNewVideo:function(){return e({method:"GET",url:"https://elightvideonotifications.firebaseio.com/Videos.json"}).then(function(e){return e.data}).then(function(e){if(!t){var t=localStorage.getItem("lastVideoKey");null!=t&&void 0!=t&&""!=t||(t="-KsRG_GXsh0TQL2g74mO")}let n=Object.keys(e),o=n.indexOf(t);return o<n.length-1?(localStorage.getItem("videoClicked")&&(t=n[o+1],localStorage.setItem("videoClicked",!1)),e[t].source=JSON.parse(_.unescape(e[t].source)),localStorage.setItem("lastVideoKey",t),e[t]):null}).catch(function(e){console.log(e)})},getLibraryVideos:function(n,o,a){var i=t.defer();return e({method:"GET",url:"https://api.elight.edu.vn/v3/list-video-library",params:{user_token:n,take:o,skip:a}}).then(function(e){i.resolve(e)},function(e){i.reject(e)}),i.promise}};return n}]),angular.module("login.service",[]).service("loginService",["$http","$rootScope","$localStorage","API_URL",function(e,t,n,o){let a,i={};return JSON.parse(localStorage.getItem("user"))?t.loggedIn=!0:t.loggedIn=!1,i.login=function(i,r){let s={};return s.email=i,s.password=r,s.end_point="404",s.type_of_device="1",e({method:"post",url:o+"signin-email",data:s}).then(function(e){return 1===e.data.code?(a=e.data.user,localStorage.setItem("user",JSON.stringify(a)),t.loggedIn=!0,n.auth=a,e.data):e.data}).catch(function(e){throw console.log(e),e})},i.signUp=function(e){return fetch(o+`register?confirm=${e.re_password}&display_name=${e.username}&email=${e.email}&password=${e.password}&password_confirmation=${e.re_password}`,{method:"POST"}).then(e=>e.json())},i.logOut=function(){n.auth=void 0,localStorage.removeItem("user"),localStorage.removeItem("war-player-stat"),localStorage.removeItem("war-win"),t.loggedIn=!1,location.reload()},i.updateInfo=function(e){if(angular.isUndefined(a)&&(a=JSON.parse(localStorage.getItem("user"))),angular.isUndefined(e))return Promise.resolve(!1);{let t={address:(e=_.extend(e,e.information)).address||a.information.address,company:e.company||a.information.company,display_name:e.display_name||a.display_name,facebook:e.facebook||a.information.facebook,fullname:e.fullname||a.information.fullname,phone:e.phone||a.information.phone,user_token:a.user_token};return fetch(o+"profile/edit",{method:"POST",headers:{Accept:"application/json, text/plain, */*","Content-Type":"application/json"},body:JSON.stringify(t)}).then(e=>e.json()).then(t=>!!(t.code=1)&&(a.information.address=e.address,a.information.company=e.company,a.display_name=e.display_name,a.information.facebook=e.facebook,a.information.fullname=e.fullname,a.information.phone=e.phones,localStorage.setItem("user",JSON.stringify(a)),!0)).catch(e=>(console.log(e),!1))}},i.changePass=function(e){if(angular.isUndefined(a)&&(a=JSON.parse(localStorage.getItem("user"))),angular.isUndefined(e))return Promise.resolve(!1);{let t={password_new:e.password,password_new_confirmation:e.re_password,user_token:a.user_token};return fetch(o+"users/change-password",{method:"POST",headers:{Accept:"application/json, text/plain, */*","Content-Type":"application/json;charset=UTF-8"},body:JSON.stringify(t)}).then(e=>e.json()).then(e=>!!(e.code=1)).catch(e=>(console.log(e),!1))}},i.getUser=function(){return angular.isUndefined(a)&&(a=JSON.parse(localStorage.getItem("user"))),angular.copy(a)},i}]),angular.module("preload.service",[]).service("preloadService",[function(){var e={preloadImages:function(e){var t=[];return e.map(e=>{t.push(new Promise(function(t,n){var o=new Image;o.src=e,o.onload=function(e){t(!0)},o.onerror=function(e){t(!1)}}))}),Promise.all(t)},preloadAudios:function(e){var t=[];return e.map(e=>{t.push(new Promise(function(t,n){var o=new Audio;o.src=e,o.oncanplaythrough=function(e){t(!0)},o.onerror=function(e){t(!1)}}))}),Promise.all(t)}};return e}]),angular.module("app.request",[]).service("app.request.service",appRequestService),appRequestService.$inject=["$http","$q"],angular.module("streak.service",[]).service("streakService",["$localStorage","$rootScope",function(e,t){let n={};var o;function a(){return!e.streak||!(Date.now()-e.streak.update>=864e5)}return n.getStreak=(()=>!e.streak||function(){let t=!1;Date.now()-e.streak.update>=1728e5&&(t=!0);return t}()?(o=new Date,o=o.setHours(-24,0,0,0),e.streak={day:0,update:o},angular.copy(e.streak)):angular.copy(e.streak)),n.getStreakData=(e=>{for(var n=0,o=0;n<=e;)n+=++o;var i=streak_data[t.language].filter(t=>t.day==e)[0];return i.info=a()?i.info_after:i.info_before,i.max=n,angular.copy(i)}),n.increaseStreak=(()=>!a()&&(e.streak.day++,e.streak.update=(new Date).setHours(0,0,0,0),{old:e.streak.day-1,new:e.streak.day,update:e.streak.update})),n}]),angular.module("user",[]).service("user.service",userService),userService.$inject=["$http","$localStorage"],angular.module("wordMemo.service",[]).service("wordMemo",wordSuperMemoService),wordSuperMemoService.$inject=["$localStorage","$q","$http"],angular.module("interpolate.filter",[]).filter("interpolate",["$interpolate",function(e){return function(t,n){return e(t)(n)}}]),angular.module("footer.setting").component("languageSetting",{templateUrl:"app/components/footer/language-setting/language.template.html",controller:["$scope","$localStorage","$rootScope",function(e,t,n){let o=this;$(document).ready(function(){$('[data-toggle="tooltip"]').tooltip()}),o.languageSelected=n.language,o.openLanguageModal=function(){$("#language_modal").modal("show")},o.selectLanguage=function(t){o.languageSelected=t,applyScope(e)},o.confirmSelectLanguage=function(o){t.language=o,n.language=t.language,applyScope(e),window.location.reload()}}]}),angular.module("footer.setting").component("setting",{templateUrl:"app/components/footer/setting/setting.template.html",controller:["$scope","$localStorage","$rootScope","$sce",function(e,t,n,o){let a=this;a.localesMessage=settingLocales,a.showing=a.localesMessage[3][n.language];let i=a.localesMessage[17][n.language],r=a.localesMessage[18][n.language];a.allOpened=!1,a.isToeic=!1,a.isBasic=!0,a.unitType=1,a.isCommunication=!1,a.thankYouCard=!1,a.user=t.auth,a.resetParams=function(){a.unitDetail=!1,a.messagePremium=!1,a.form_support={name:"",email:t.email,phone:"",content:""},a.form_feedback={email:t.email,content:""}},n.$on("loggedin",function(){a.reloadUnit()}),a.resetParams(),a.updateHistory=ee_update_history,a.selectedUnits=t.unit,a.reloadUnit=function(){t.unitSettingSelected||(t.unitSettingSelected=angular.copy(t.unit));let e=t.unit,n=t.auth;if(n&&(n.actived_code.count_use_code>0||n.actived_code.count_user_courses>0)){units.concat(toeicUnits).concat(grammarUnits).concat(communicationUnit).forEach(function(e,n){t.unit[n]=e.id}),e=t.unit}let o=units.concat(toeicUnits).concat(grammarUnits).concat(communicationUnit);_.map(o,function(n){if(e){if(_.contains(e,n.id)){let e=_.contains(t.unitSettingSelected,n.id);n.actived=!!e,n.lock=!1}}}),a.units=o},a.reloadUnit(),a.trustAsHtml=function(e){return o.trustAsHtml(e)},a.toCategory=function(t){a.showing=t,applyScope(e),a.resetParams(),a.thankYouCard=!1},a.changeStatus=function(e,t,n,o,i){a.isBasic=e,a.isToeic=t,a.isGrammar=n,a.isCommunication=o,a.unitType=i},a.toggleSetting=function(){if(_gaq.push(["_trackEvent","SET_","Open","Open"]),e.openSettingModal=!0,applyScope(e),console.log("scope setting",e.openSettingModal),$("#setting_modal").modal("show"),t.auth){t.auth.actived_code;a.allOpened=!0}a.reloadUnit()},a.index_topic=n.selectedUnit,a.popup_landing_page=function(e){e!==a.index_topic&&$("#popup_landing_page").modal("toogle")},a.chooseTopic=function(e,o){let i=t.unit,r=i.indexOf(e);if(t.auth){let n=t.auth.actived_code;0===n.count_use_code&&0===n.count_user_courses?1===i.length?_.unique(t.unit.push(e)):-1===r&&(_gaq.push(["_trackEvent","SET_","Choose unit",o]),a.openAllUnit()):a.allOpened=!0}else-1===r&&(_gaq.push(["_trackEvent","SET_","Choose unit",o]),a.openOnUnit());a.chooseOneTopic(e,r),a.reloadUnit(),n.$broadcast("reinit",{}),n.$broadcast("change_course",function(){})},e.$on("open_setting",function(){a.toggleSetting()}),a.chooseMultiTopic=function(e,n){let o=t.unitSettingSelected;if(-1!==n){let n=_.indexOf(o,e);-1===n?t.unitSettingSelected.push(e):1!==o.length&&(o.splice(n,1),t.unitSettingSelected=o)}},a.chooseOneTopic=function(e,n){let o=t.unitSettingSelected;if(-1!==n){_.indexOf(o,e);t.unitSettingSelected=[e]}},a.goLandingPage=function(){_gaq.push(["_trackEvent","SET_","Open landing page","Open landing page"])},a.closeMessagePremium=function(){a.messagePremium=!1},a.openRegister=function(e){a.messagePremium=!1,e===r?localStorage.getItem("user")||(n.openLoginFromOutside=!0,$(".login-form").modal("show")):e===i&&chrome.tabs.create({url:"https://elight.edu.vn/khoa-toan-dien-3-trong-1-extension?utm_source=extension&utm_medium=setting&utm_campaign=course"})},a.openUnit=function(e){let n=t.unit,o=n.indexOf(e);if(t.auth){let i=t.auth.actived_code;0===i.count_use_code&&0===i.count_user_courses?1===n.length?(_.unique(t.unit.push(e)),a.unitInfor.unlock=!0):-1===o&&a.openAllUnit():(a.unitInfor.unlock=!0,a.allOpened=!0)}else t.unit.length>1?a.openAllUnit():a.openOnUnit()},a.openAllUnit=function(){a.messagePremium=!0,a.messageHead={first:a.localesMessage[19][n.language],second:a.localesMessage[20][n.language],button:i}},a.openOnUnit=function(){a.messagePremium=!0,a.messageHead={first:a.localesMessage[18][n.language],second:a.localesMessage[21][n.language],button:r}},a.getDetailUnit=function(e,o,i,r){let s,l=units.concat(toeicUnits).concat(grammarUnits).concat(communicationUnit);a.unitDetail=!0,s=t.wordReview;let c=l[e-1].words,u=s?s.slice(0):[],d=_.pluck(c,"word"),g=_.pluck(u,"word"),p=_.difference(d,g);a.unitInfor={total:c.length,image:c[0].image,title:o,newWord:p.length,detail:"vn"===n.language?l[e-1].description:l[e-1].description_por,unlock:i,index:e};let h=a.unitInfor.total-a.unitInfor.newWord,m=a.unitInfor.newWord-3;AmCharts.makeChart("process_unit_setting",{type:"pie",theme:"light",dataProvider:[{title:a.localesMessage[22][n.language],value:h,color:"#c0c0c0",colorTitle:"#ffffff"},{title:a.localesMessage[23][n.language],value:m,color:"#E5E6E5",colorTitle:"#ffffff"}],titleField:"title",valueField:"value",labelRadius:10,radius:"22%",colorField:"color",innerRadius:"80%",labelColorField:"colorTitle",labelText:"[[title]]: [[value]] ",startDuration:0})},a.backToListUnit=function(){a.resetParams(),a.reloadUnit()},a.sendFeedback=function(){a.loading=!0,t.email=a.form_feedback.email;let e={emailAddress:a.form_feedback.email,"entry.1037456847":a.form_feedback.content};$.ajax({method:"POST",url:"https://docs.google.com/forms/d/e/1FAIpQLSd8_NNRWAE5y25WlBr__SHvIZtu43gfuenykhGZcjk8Lj5rPw/formResponse",data:e}),a.loading=!1,a.resetParams(),a.thankYouCard=!0},a.sendSupport=function(){a.loading=!0,t.email=a.form_support.email;let e={"entry.347563705":a.form_support.name,emailAddress:a.form_support.email,"entry.1037456847":a.form_support.phone,"entry.543144169":a.form_support.content};$.ajax({method:"POST",url:"https://docs.google.com/forms/d/e/1FAIpQLSf87cB5XSSJ7h8XipcNwOJZ7yzEVS2ByuQgrfN0MWkKg3Lu2g/formResponse",data:e}),a.loading=!1,a.resetParams(),a.thankYouCard=!0}}]}),angular.module("footer.video").component("videoLibrary",{templateUrl:"app/components/footer/video/video.template.html",controller:["$rootScope","firebaseService","$scope","$localStorage",function(e,t,n,o){function a(e){t.getLibraryVideos("",e,0).then(function(e){if(200==e.status&&e.data){var t=e.data.data.newest_videos,a=0;o.videos&&o.videos.length>0?_.each(t,function(e,n){var i=_.where(o.videos,{id:e.id});!i||i&&0==i.length?(t[n].view=!1,a++):t[n].view=!0}):a=1,o.videos=t,n.videos=o.videos,o.numberOfNewVideos=n.numberOfNewVideos=a,n.videos=o.videos,n.numberOfNewVideos=o.numberOfNewVideos,applyScope(n)}}).catch(function(e){console.log(e)})}!function(){var e=new Date;if(o.lastTimeGetVideos&&e.getDate()===o.lastTimeGetVideos.day)if(e.getHours()<12){if(o.lastTimeGetVideos.am)return;o.lastTimeGetVideos.am=!0,a(8)}else{if(o.lastTimeGetVideos.pm)return;o.lastTimeGetVideos.pm=!0,a(8)}else o.lastTimeGetVideos={am:e.getHours()<12,pm:e.getHours()>=12,day:e.getDate()},a(8)}(),this.clickVideo=function(){_gaq.push(["_trackEvent","VIDEO_","See notification","See notification"]),$("#video_modal").modal("show"),o.numberOfNewVideos=n.numberOfNewVideos=0},this.watchVideos=function(e,t){_gaq.push(["_trackEvent","VIDEO_","View page",e.id+"_"+e.title]);var a=_.findLastIndex(o.videos,{id:e.id});n.videos[a].view=!0,o.videos=n.videos,window.open("https://elight.edu.vn/hoc-tieng-anh-qua-video/"+e.meta_url+"/"+e.id)}}]}),angular.module("header.navigator").component("navigator",{templateUrl:"app/components/header/navigator/navigator.template.html",controller:["$localStorage",function(e){this.logo=e.auth&&(e.auth.actived_code.count_use_code>0||e.auth.actived_code.count_user_courses>0)?config_url.url_logo_paid_user:config_url.url_logo,this.imageUrl_logo=config_image_url.elight_logo,this.tracking=function(){_gaq.push(["_trackEvent","Elight Extension","Link Logo","Logo"])},chrome.topSites.get(function(e){let t=_.filter(e,function(e,t){return t<10}),n=$("#topsites_menu"),o=t.length;for(var a=0;a<o;a++){let e="https://www.google.com/s2/favicons?domain="+t[a].url;n.append('<div><a class="elight_visited_link" href="'+t[a].url+'"> <i style="background-image:url('+e+');background-size:cover;"></i>'+t[a].title+"</a></div>")}}),utils.resetClickHandler($("#lnk_topsites"),function(e){e.stopPropagation(),_gaq.push(["_trackEvent",config_app+" Click","top_sites","top_sites"]),$("#topsites_menu").toggle(200),$("#share_menu").fadeOut(200),$("#support_menu").fadeOut(200),$("#setting_menu").fadeOut(200)}),this.is_update="true"==localStorage._wupdate,this.update=function(){chrome.tabs.create({url:"chrome://extensions/"})},$("nav").off("mouseleave"),$("nav").on("mouseleave",function(){$("#topsites_menu").fadeOut(200),$("#share_menu").fadeOut(200),$("#support_menu").fadeOut(200)})}]}),angular.module("header.searchBox").component("searchBox",{templateUrl:"app/components/header/searchBox/searchBox.template.html",controller:["mainService","$localStorage",function(e,t){let n=this,o=-1,a=0,i=$("input#search-input");n.listSearch=[],i.click(function(){sendGa(t.auth,"Search","Click","Search_use")}),$("#search-input").keyup(function(t){console.log(t);let o=$(this).val();e.search(o,function(e){200===e.status?($("#search-suggestion-pad").attr("style","display: block !important"),n.listSearch=_.filter(e.data[1],function(e,t){return t<5}),_.contains(suggest_search,o.replace(" ",""))&&n.listSearch.unshift("tieng anh elight"),a=n.listSearch.length):(n.listSearch=[],$("#search-suggestion-pad").attr("style","display: none !important"))}),13===t.keyCode&&n.redirect(o)}),$("#search-input").keydown(function(e){let t=e.keyCode;if(38!==t&&40!==t);else{38===t?(-1!==o&&document.getElementById("auto-suggest-row"+o).setAttribute("class",""),--o<0&&(o=a-1)):(-1!==o&&document.getElementById("auto-suggest-row"+o).setAttribute("class",""),++o>=a&&(o=0));let e=document.getElementById("auto-suggest-row"+o);e.setAttribute("class","selected"),i.value=e.textContent}}),n.redirect=function(e){_gaq.push(["_trackEvent","EE Search","Search",e]),window.location.href="https://www.google.com/search?sourceid=chrome&ie=utf-8&oe=utf-8&aq=t&hl=en-US&q="+e},$("body").click(function(){$("#search-suggestion-pad").attr("style","display: none !important")})}]}),angular.module("lesson.challenge_new").component("challengeNew",{templateUrl:"app/components/lesson/challenge-new/challenge.template.html",controller:["$scope","$rootScope","$localStorage","$interval","$timeout","challengeService","challenge.io.service","$sce","challenge.items.service",function(e,t,n,o,a,i,r,s,l){this.challengeItems=l.get(),this.bonusStat=l.getBonusStat(),e.localesMessage=challengeLocales,sendGa(n.auth,"War","Use","War_use"),t.io.on("connect",()=>{e.connectServer=!0,Promise.all([l.fetch(),l.fetchBonusStat()]).then(()=>{this.challengeItems=l.get(),this.bonusStat=l.getBonusStat(),this.init()}).catch(e=>{console.log("error",e)})}),this.init=(()=>{this.bonusStat.gold_chest>=3&&(c.tooltipMessage="Gold chest available",B(),n.showHint||(c.isClose=!0))}),$(".challenge_btn").tooltip({}),n.auth=t.loggedIn?n.auth?n.auth:localStorage.getItem("user"):"";n.auth&&n.auth.user_token;let c=this;c.auth=n.auth,c.localesMessage=settingLocales,c.titleCourse="vn"===t.language?"Từ vựng cơ bản":"Vocabulário básico",c.titleBtn="vn"===t.language?"Thách đấu":"Challenge";var u,d,g,p,h,m,f=!1,v=!1,w=new Audio("assets/audio/ending_sound.wav"),S=new Audio("assets/audio/starting_sound.mp3"),b=new Audio("assets/audio/notice.mp3");let y=!1;var k,C,I,T,x,A,R,E=!1,P=!1,U={time:59,opponent:{freezedChance:30,minAnswer:10,maxAnswer:15,boomChance:40,eatHpChance:10,randomLoseHpChance:40,randomBotScoreChance:5},freezedTime:1e4},q=0,O=[],M=[],N=0,L=0;t.challengeState="preparing",t.userAccept=[];var G={};if(e.userWord=[],n.unitSettingSelected){const e=n.unitSettingSelected.length>=100?90:0;D(n.unitSettingSelected[e])}function D(e){let o,a=units.concat(toeicUnits).concat(grammarUnits).concat(communicationUnit);c.unitDetail=!0,o=n.wordReview;let i=a[e-1].words,r=o?o.slice(0):[],s=_.pluck(i,"word"),l=_.pluck(r,"word"),u=_.difference(s,l);c.unitInfor={total:i.length,image:i[0].image,title:a[e-1].title,newWord:u.length,detail:"vn"===t.language?a[e-1].description:a[e-1].description_por,index:e};let d=c.unitInfor.total-c.unitInfor.newWord,g=c.unitInfor.newWord-3;AmCharts.makeChart("process_unit_course",{type:"pie",theme:"light",dataProvider:[{title:c.localesMessage[22][t.language],value:d,color:"#FFCB08",colorTitle:"#ffffff"},{title:c.localesMessage[23][t.language],value:g,color:"#E5E6E5",colorTitle:"#ffffff"}],percentPrecision:2,precision:1,titleField:"title",valueField:"value",labelRadius:3,radius:"22%",pullOutDuration:0,pullOutRadius:0,colorField:"color",innerRadius:"90%",labelColorField:"colorTitle",labelText:"[[title]]: [[value]] ",startDuration:0})}function B(){1==c.userGroupChestNoti&&a(function(){$("#chest-noti").addClass("chest-noti-message-display")},100)}function W(){var e=Math.floor(3*Math.random()+1),t=(new Date).setHours(0,0,0,0)+24*e*60*60*1e3;n.dayPushChallengeNoti=t}function z(t){c.displayAnswerResult=!1,e.question_answers=t[q].words,e.question=e.question_answers[t[q].correct],e.question.result=!1,e.userWord.push(e.question);var n=new Audio(e.question.audio);e.time>0&&n.play(),q>0&&(C=!1,$("#challenge_question_div").animate({opacity:0},300),$("#challenge_question_div").animate({opacity:1},300)),q++,applyScope(e)}function F(n){t.showNoti=n,applyScope(e),setTimeout(function(){delete t.showNoti,applyScope(e)},4e3)}function j(){_gaq.push(["_trackEvent","WAR_","Click","Play game with bot"]),c.isPlayingWithBot=!0,c.chooseOpponentRandomly=!1,delete t.playRealtimeMode,delete t.stepInvite,r.isConnected()?ne():F("Không thể kết nối tới server.")}function V(){H(),[],t.correctAnswer=0,t.botCorrectAnswer=0,t.challengeState="question",C=!1}function H(){e.player={ability:{freeze:n.ability?n.ability.freeze:1,unfreeze:n.ability?n.ability.unfreeze:1,boom:n.ability?n.ability.boom:1,heart:n.ability?n.ability.heart:1},state:{freezed:!1,bombed:!1,die:!1,health:[1,1,1],win:!1}},e.bot={ability:{freeze:1,unfreeze:1,boom:1,heart:1},state:{freezed:!1,bombed:!1,die:!1,health:[1,1,1],win:!1}}}function Q(e,n){var o=[];return e.map(function(a){o.push(new Promise(function(o,i){var r=new Image;r.src=a.image,r.onload=function(a){n&&n==t.roomName&&Y(++N,L,e.length),o()},r.onerror=function(a){n&&n==t.roomName&&Y(++N,L,e.length),o(),i()}}))}),o}function J(e,n){var o=[];return e.map(function(a){o.push(new Promise(function(o,i){fetch(a.audio).then(function(e){return e.blob()}).then(function(a){n&&n==t.roomName&&Y(N,++L,e.length),o()}).catch(function(a){n&&n==t.roomName&&Y(N,++L,e.length),o()})}))}),o}function Y(n,o,a){var i=c.loadingProgress?Math.floor(c.loadingProgress)-Math.floor(c.loadingProgress)%10:0;c.loadingProgress=50*(n+o)/a;var s=Math.floor(c.loadingProgress)-Math.floor(c.loadingProgress)%10;t.playRealtimeMode&&s-i==10&&r.updateOpponentLoadDataProgress(t.roomName,c.loadingProgress),applyScope(e)}function X(){var n=function(e){return e<2?2:e<4?4:e<6?6:e<8?8:12}(q),o=_.difference(T,O);o.length<=n&&(O=[],o=T),e.question_answers=_.sample(o,n),O=O.concat(e.question_answers);var i=_.difference(e.question_answers,M);i.length<=0&&(i=e.question_answers),e.answer=[_.sample(i)],M=M.concat(e.answer),e.time=void 0===e.time?U.time:e.time;var r=new Audio(e.answer[0].audio);e.time>0&&r.play(),_.each(e.question_answers,function(e,t){e.enermyCheck=!1,e.checked=!1}),applyScope(e),function n(o){a.cancel(I);I=a(function(){C||e.bot.state.freezed?n(o):(le(".challenge_score_bot"),t.botCorrectAnswer++,C=!0,e.question_answers[_.findIndex(e.question_answers,{word:e.answer[0].word})].enermyCheck=!0,d||(d=new Audio("/assets/audio/war/botCorrectSound.wav")),d.pause(),d.currentTime=0,d.play(),a(function(){y||Z(!1,e.answer[0])},1e3))},function(e){if(2==e)return ie(.7,1.5);if(4==e)return ie(1,1.8);if(6==e)return ie(1.3,2.1);if(8==e)return ie(1.6,2.4);if(12==e)return ie(2,3)}(o))}(n)}e.$on("change_course",function(){n.unitSettingSelected&&D(n.unitSettingSelected[0])}),c.toggleSetting=function(){n.isSetUnit||(n.unit=Array.from({length:100},(e,t)=>t+1),n.isSetUnit=!0),t.random=1,t.isLearn_word=!1,t.isQuote=!1,t.elightube=!1,t.topic=!0},c.tooltipMessage="vn"===t.language?"Thách đấu cùng eLight":"Elight's Challenge",n.auth?(c.userGroupChestNoti=1,c.userGroup=n.auth.id%3,c.messageInRankBySchool=!1):n.guest_id&&(c.userGroupChestNoti=1,c.userGroup=n.guest_id%3),c.userBannerType=n.guest_id%2,n.auth&&n.auth.actived_code&&(n.auth.actived_code.new_code>0||n.auth.actived_code.count_use_code>0||n.auth.actived_code.count_user_courses>0)&&(c.isCloseBanner=!0),c.trackingBanner=function(e){var t=e.toString();_gaq.push(["_trackEvent","War BN","Go To LP",t])},t.warWin>=100&&(c.goldBonusProgress=t.warWin,c.tooltipMessage="Gold chest available",B(),n.showHint||(c.isClose=!0)),c.trackingChestNotiPostion=function(){0==c.userGroupChestNoti?_gaq.push(["_trackEvent","CHEST_NOTI","main screen",""]):1==c.userGroupChestNoti&&_gaq.push(["_trackEvent","CHEST_NOTI","bottom right",""])},n.dayPushChallengeNoti||W(),t.checkConditionPushChallengeNoti=function(){if((new Date).setHours(0,0,0,0)!=n.dayPushChallengeNoti||n.isPushChallengeNoti)n.isPushChallengeNoti=!1,delete t.showChallengeNoti;else{var e=["Có người đã thách đấu bạn","Chơi ngay để nhận quà"],o=Math.floor(Math.random(e.length));c.messageNoti=e[o],t.showChallengeNoti=!0,b.play(),c.userGroupChestNoti=1,n.isPushChallengeNoti=!0,c.timeShowNoti=Date.now()+1e4,1==c.userGroupChestNoti&&a(function(){$("#challenge-noti").addClass("chest-noti-message-display")},100),W()}},e.inviteRecent=(t=>{c.recentGuestId=t,e.invite(t)}),e.reInvite=(()=>{c.recentGuestId?e.invite(c.recentGuestId):e.invite()}),e.invite=function(o){let a;(c.isPlayingWithBot=!1,o?a=o:(c.recentGuestId=null,a=t.searchStr),G&&!angular.equals({},G)&&t.showChallengeInvited)?(G.hostGuestId?G.hostGuestId:G.guest_id)==o?c.userAcceptPlay():F("vn"===t.language?"Bạn không thể mời chơi lúc này":"You cannot invite now."):P||(delete c.rematchStatus,delete t.messageError,a&&a==n.guest_id?t.messageError="vn"===t.language?"Bạn không thể thách đấu với chính mình":"You cannot challenge yourself!":(e.inviteUser(a),P=!0,setTimeout(function(){P=!1},500),applyScope(e)))},e.inviteUser=(o=>{r.inviteUserByUserId(n.auth,o).then(n=>{console.log(n),1==n.status?(delete t.userAccept,e.showOpponent=!1,G={},t.challengeState="waitingUser",t.playRealtimeMode=!0,delete e.AI,n.opponentInfo=n.opponentInfo||{},t.stepInvite?t.stepInvite++:t.stepInvite=1,c.hostSocketId=n.hostSocketId,t.roomName=n.roomName,t.userAccept={},t.userAccept.waiting=statusGame.waiting,t.userAccept.ready=!1,$(".spinner").hide(),t.userAccept.avatar=n.opponentInfo.avatar,t.userAccept.school=n.opponentInfo.school,t.userAccept.username=n.opponentInfo.username,t.userAccept.guest_id=n.opponentInfo.guest_id,applyScope(e),x=setTimeout(function(){c.finishCountDown(),applyScope(e)},1e4)):0==n.status&&("IN_GAME"==n.code?(F("vn"===t.language?n.message:"You are in a room at the moment."),e.exitGameScreen()):"NO_ONLINE"==n.code?j():"vn"===t.language?F(n.message):"OPP_IN_GAME"==n.code?F("Your opponent is in a room at the moment."):"OPP_OFFLINE"==n.code?F("Your opponent is currently offline."):"UNKNOWN"!=n.code&&"OPP_UNKNOWN"!=n.code||F("Something went wrong. Please try again!"))}).catch(e=>{console.log(e),t.messageError="vn"===t.language?"Đã có lỗi xảy ra, vui lòng thử lại.":"Something went wrong. Please try again."})}),e.inviteSpecificUser=((o,a)=>{r.inviteUserByUserId(n.auth,a).then(i=>{_gaq.push(["_trackEvent","WAR_","Invite","Specific"]),n.opponentGuestId=a,1==i.status?(o.waiting=statusGame.waiting,o.messageDeny="",o.ready=!1,t.userAccept=o,applyScope(t),$(".spinner").hide(),e.showOpponent=!1,t.challengeState="waitingUser",localStorage.realtimePlayerScore||(n.realtimePlayerScore={},n.realtimePlayerScore[a]=0,n.realtimePlayerScore[n.guest_id]=0),t.playRealtimeMode=!0,delete e.AI,t.stepInvite?t.stepInvite++:t.stepInvite=1,c.hostSocketId=i.hostSocketId,t.roomName=i.roomName,x=setTimeout(function(){c.finishCountDown(),applyScope(e)},1e4)):0==i.status&&(F(i.message),"IN_GAME"==i.code&&e.exitGameScreen())}).catch(e=>{console.log(e),t.messageError="Đã có lỗi xảy ra, vui lòng thử lại."})}),e.inviteRandomUser=(()=>{r.inviteUserByUserId(n.auth,null).then(n=>{_gaq.push(["_trackEvent","WAR_","Invite","Random"]),1==n.status?(delete t.userAccept,e.showOpponent=!1,G={},t.challengeState="waitingUser",t.playRealtimeMode=!0,delete e.AI,n.opponentInfo=n.opponentInfo||{},t.stepInvite?t.stepInvite++:t.stepInvite=1,c.hostSocketId=n.hostSocketId,t.roomName=n.roomName,t.userAccept={},t.userAccept.waiting=statusGame.waiting,t.userAccept.ready=!1,$(".spinner").hide(),t.userAccept.avatar=n.opponentInfo.avatar,t.userAccept.school=n.opponentInfo.school,t.userAccept.username=n.opponentInfo.username,t.userAccept.guest_id=n.opponentInfo.guest_id,applyScope(e),x=setTimeout(function(){c.finishCountDown(),applyScope(e)},1e4)):0==n.status&&("IN_GAME"==n.code?(F(n.message),e.exitGameScreen()):"NO_ONLINE"==n.code?j():F(n.message))}).catch(e=>{console.log(e),t.messageError="Đã có lỗi xảy ra, vui lòng thử lại."})}),r.onInviteUser(function(o){clearTimeout(u),t.messageError="",c.opponentStatus="",t.showChallengeInvited=!1,applyScope(e),t.roomName=o.roomName,G={username:o.username,avatar:o.avatar,school:o.school?o.school.school_name:"",hostGuestId:o.hostGuestId,specialAvatar:void 0!==n.season.schoolWinLastSeason&&o.school==n.season.schoolWinLastSeason},c.messageInvite=o.message,t.showChallengeInvited=!0,c.timeShowNoti=Date.now()+1e4,new Audio("assets/audio/notice.mp3").play(),applyScope(e)}),c.userAcceptPlay=function(){_gaq.push(["_trackEvent","WAR_","Invite","Accept invite"]),c.isUserAccept=!0,c.isPlayingGame=!0,f=!1,t.random=3,t.challengeScreen=1,t.userAccept=G,t.playRealtimeMode=!0,delete e.AI,delete t.showChallengeNoti,delete t.showChallengeInvited,e.showOpponent=!1,t.challengeState="waitingUser";let o=t.userAccept;o.waiting=!1,o.ready=!0,de(),r.acceptInvite(t.roomName,o.hostGuestId,n.guest_id).then(function(e){T=e.questions,c.isUserAccept=!1,localStorage.realtimePlayerScore||(n.realtimePlayerScore={},n.realtimePlayerScore[o.hostGuestId]=0,n.realtimePlayerScore[n.guest_id]=0),c.joinGame(e.questions,t.roomName),n.opponentGuestId=o.hostGuestId}).catch(function(e){console.log(e)})},c.finishCountDown=function(){delete t.showChallengeInvited,t.playRealtimeMode=!1,r.denyInvite(t.roomName,c.hostSocketId).then(function(n){console.log("response"),G.waiting=!1,G.ready=!1,t.userAccept&&(t.userAccept.waiting=!1,t.userAccept.ready=!1),applyScope(e)}).catch(function(e){console.log(e)})},t.$on("deny-invite",function(){c.finishCountDown()}),r.onDenyInvite(function(e){clearTimeout(x),t.playRealtimeMode=!1,t.userAccept&&t.userAccept.waiting&&t.userAccept.waiting&&(t.userAccept.waiting=!1,t.userAccept.ready=!1,t.userAccept.messageDeny=e.message)}),r.onAcceptInvite(function(e){n.opponentGuestId=t.userAccept.guest_id,localStorage.realtimePlayerScore||(n.realtimePlayerScore={},n.realtimePlayerScore[t.userAccept.guest_id]=0,n.realtimePlayerScore[n.guest_id]=0),c.isPlayingWithBot=!1,clearTimeout(x),c.isPlayingGame=!0,c.chooseOpponentRandomly=!1,delete t.stepInvite,c.rematchStatus="READY";let o=t.userAccept;o.waiting=!1,o.ready=!0,T=e.questions,t.roomName=e.roomName,c.joinGame(e.questions,e.roomName)}),r.onReadyBeforeLoadGame(function(e){delete t.showChallengeInvited}),c.joinGame=function(e,n){t.random=3,t.challengeScreen=1,delete t.showChallengeInvited,function(e,n){w&&w.pause();re("assets/audio/click.mp3"),function(e,n){var o=e.map(function(e){return e.words}).reduce(function(e,t){return e.concat(t)},[]);t.challengeState="loading",N=0,L=0,Promise.all(Q(o,n).concat(J(o,n))).then(function(){r.checkCountDownReady(t.roomName).then(function(e){0==e.status&&(c.readyMessage=e.message)}).catch(function(e){})}).catch(function(e){})}(e,n)}(e,n)},r.onReadyToCountDown(function(){oe()}),c.checkAnswerGamePvP=function(n,o,a){if(!(C||e.player.state.freezed||e.question_answers[a].checked)){if(e.question_answers[a].checked=!0,n==o&&(C=!0,e.userWord.length>0)){var i=e.userWord.length-1;e.userWord[i].result=!0}r.answer(n,q-1,t.roomName)}},r.onPlayerAnswer(function(e){C=!0}),r.onPlayerAnswerResult(function(o){let i=o.result.status,r=o.result.score,s=o.result.health,l=n.guest_id;c.displayAnswerResult=!0,1==i?(o.userAnswer!=l?(t.botCorrectAnswer=r[o.userAnswer],n.realtimePlayerScore[o.userAnswer]=r[o.userAnswer],e.question_answers[_.findIndex(e.question_answers,{word:e.question.word})].enermyCheck=!0):(re("assets/audio/right.mp3"),le(".challenge_score_player"),t.correctAnswer=r[l],n.realtimePlayerScore[l]=r[l]),a(function(){y||o.currentQuestionIndex!=q-1||z(T)},1e3)):0==i&&(C=!1,o.userAnswer!=l?(e.bot.state.health=s[o.userAnswer],0==e.bot.state.health.length&&(e.bot.state.die=!0)):(re("assets/audio/wrong.mp3"),e.player.state.health.length>0&&(e.player.state.health.splice(0,1),0==c.challengeItems.heart||e.usedAbilities.heart||$(".challenge_3_ability_heart").addClass("challenge_ability_icon_scaling")),0==e.player.state.health.length&&(e.player.state.die=!0,C=!0)))}),c.initGamePvP=function(){_gaq.push(["_trackEvent","WAR_","Click","Play game PvP"]),v=!1,q=0,N=0,L=0,M=[],O=[],e.userWord=[],e.usedAbilities={freeze:!1,unfreeze:!1,bomb:!1,heart:!1},se(),V(),e.time=U.time,z(T),g=setInterval(function(){e.time>0?(e.time--,10==e.time&&(m=new Audio("assets/audio/ticktock.mp3")).play(),e.$apply()):(clearInterval(g),clearInterval(h),C=!0,t.userAccept&&t.userAccept.hostGuestId&&(f||r.sendFinishStatus(t.roomName,n.guest_id).then(function(e){1==e.code&&(f=!0)}).catch(function(e){console.log(e)})),R||(R=setTimeout(function(){ce()},3e3)))},1e3)},c.showChallenge=function(){_gaq.push(["_trackEvent","WAR_","Click","Open game"]),3!=t.random&&(t.random=3,t.challengeScreen=1,c.closeChestNotiModal(),r.isConnected()?e.connectServer=!0:e.connectServer=!1)},t.io.on("disconnect",function(){e.connectServer=!1}),H(),e.showRejectedText=function(){return t.userAccept&&!t.userAccept.waiting&&!t.userAccept.ready||"Rejected"==c.rematchStatus},e.backScreen=function(){e.exitGameScreen(),r.leaveRoom(t.roomName),_gaq.push(["_trackEvent","WAR_","Click","Back home screen"]),!t.loggedIn&&t.playAtleastOne?($("#war__requestLogin").modal("show"),t.playerStat=n.warGuestState,delete n.warPlayerState):(n.warPlayerState=n.warPlayerState||{},n.warPlayerState.display_name=t.playerStat.display_name,t.playerStat=n.warPlayerState),w&&w.pause()},e.exitGameScreen=(()=>{c.isPlayingGame=!1,ge(),delete t.searchStr,delete t.playRealtimeMode,applyScope(e),t.challengeState="preparing"}),c.readyFromMainScreen=function(){t.challengeScreen=1,c.replay()},e.play_game=function(n){if(_gaq.push(["_trackEvent","WAR_","Click","Play game"]),$(".spinner").show(),!E){if(G&&!angular.equals({},G)&&t.showChallengeInvited&&!c.endingInvite)c.userAcceptPlay();else{c.chooseOpponentRandomly=!0,G={},delete t.userAccept;let n=0;t.stepInvite>n?(_gaq.push(["_trackEvent","WAR_","Click","Play game with bot"]),j()):e.invite()}E=!0,setTimeout(function(){E=!1},500),applyScope(e)}},c.playQuestionAudio=function(t){var n=new Audio(t);e.time>0&&n.play()},c.checkAnswer=function(n,o){C||e.player.state.freezed||e.question_answers[o].checked||(e.question_answers[o].checked=!0,n==e.answer[0].word?(a.cancel(I),re("assets/audio/right.mp3"),C=!0,le(".challenge_score_player"),t.correctAnswer++,k=a(function(){y||Z(!0,e.answer[0])},1e3)):(re("assets/audio/wrong.mp3"),e.player.state.health.length>0&&(e.player.state.health.splice(0,1),0==c.challengeItems.heart||e.usedAbilities.heart||$(".challenge_3_ability_heart").addClass("challenge_ability_icon_scaling")),0==e.player.state.health.length&&(e.player.state.die=!0,C=!0,setTimeout(function(){te(!1,e.answer[0]),applyScope(e)},500))))},c.useAbility=(n=>{"question"==t.challengeState&&("freeze"==n&&l.canUse("freeze")&&!e.usedAbilities.freeze?(_gaq.push(["_trackEvent","WAR_","Using freeze item","Using freeze item"]),l.useFreeze(t.roomName).then(e=>{}).catch(e=>{}),e.usedAbilities.freeze=!0,e.bot.state.freezed=!0,setTimeout(function(){e.bot.state.freezed&&(re("assets/audio/smash.mp3"),e.bot.state.freezed=!1,e.$apply())},U.freezedTime),re("assets/audio/freeze.mp3")):"unfreeze"==n&&l.canUse("unfreeze")&&1==e.player.state.freezed&&!e.usedAbilities.unfreeze?(_gaq.push(["_trackEvent","WAR_","Using unfreeze item","Using freeze item"]),l.useUnfreeze(t.roomName).then(e=>{}).catch(e=>{}),$(".challenge_freezed_div").fadeOut(1e3),$(".challenge_3_ability_unfreeze").removeClass("challenge_ability_icon_scaling"),re("assets/audio/smash.mp3"),e.usedAbilities.unfreeze=!0,setTimeout(function(){e.player.state.freezed=!1,e.$apply()},400)):"bomb"==n&&l.canUse("bomb")&&!e.usedAbilities.bomb?(_gaq.push(["_trackEvent","WAR_","Using boom item","Using freeze item"]),l.useBomb(t.roomName).then(e=>{}).catch(e=>{}),$(".challenge_opponent_bombed").css("background-image",`url('/assets/images/war/smoke2.gif?${e.time}')`),e.usedAbilities.bomb=!0,e.bot.state.bombed=!0,setTimeout(function(){$(".challenge_opponent_bombed").css("background-image",""),e.bot.state.bombed=!1,"$apply"!=e.$root.$$phase&&"$digest"!=e.$root.$$phase&&e.$apply()},700),re("assets/audio/boom.mp3"),e.bot.state.health.splice(0,1),0==e.bot.state.health.length&&(e.bot.state.die=!0,te())):"health"==n&&l.canUse("health")&&!e.usedAbilities.heart&&(_gaq.push(["_trackEvent","WAR_","Using heart item","Using freeze item"]),l.useHealth(t.roomName).then(e=>{}).catch(e=>{}),e.usedAbilities.heart=!0,e.player.state.health.push(1),$(".challenge_3_ability_heart").removeClass("challenge_ability_icon_scaling"),$(".challenge_hp_img").removeClass("challenge_ability_icon_scaling"),re("assets/audio/health.mp3")))}),r.onPlayerUseSkill(function(t){"freeze"==t.item?(re("assets/audio/freeze.mp3"),e.player.state.freezed=!0,e.usedAbilities.unfreeze||$(".challenge_3_ability_unfreeze").addClass("challenge_ability_icon_scaling"),(e.player.state.freezed=!0)&&(e.freezedCountdown=9,h=setInterval(function(){e.freezedCountdown--,e.freezedCountdown<=0&&clearInterval(h)},1e3),setTimeout(function(){$(".challenge_freezed_div").fadeOut(1e3),e.player.state.freezed&&re("assets/audio/smash.mp3"),setTimeout(function(){e.player.state.freezed=!1,$(".challenge_3_ability_unfreeze").removeClass("challenge_ability_icon_scaling"),applyScope(e)},400)},U.freezedTime))):"bomb"==t.item?($(".challenge_boom_div").css("background-image",`url('/assets/images/war/boom.gif?${e.time}')`),re("assets/audio/boom.mp3"),e.player.state.bombed=!0,e.player.state.health.splice(0,1),setTimeout(function(){e.player.state.bombed=!1,$(".challenge_boom_div").css("background-image",""),e.player.state.health<=0&&(e.player.state.die=!0,te()),applyScope(e)},1500)):"health"==t.item?(e.bot.state.health.push(1),e.bot.ability.heart--):"unfreeze"==t.item&&(re("assets/audio/smash.mp3"),e.bot.state.freezed=!1,applyScope(e))}),c.openChest=(()=>{e.reward||l.openWinChest().then(t=>{_gaq.push(["_trackEvent","WAR_","Click","Open win chest"]),e.reward=!0,function(t,n,o){let a=1==t?"Gold Chest":2==t?"Silver Chest":"Win Chest";_gaq.push(["_trackEvent","WAR_","Open "+a,"Open item(s)"]);let i={1:{left:{1:"130px",2:"20px",3:"130px",4:"20px"},top:{1:"235px",2:"235px",3:"300px",4:"300px"}},2:{left:{1:"130px",2:"20px",3:"130px",4:"20px"},top:{1:"130px",2:"130px",3:"210px",4:"210px"}},3:{left:{1:"585px",2:"585px",3:"585px",4:"585px"},top:{1:"-110px",2:"-190px",3:"-32px",4:"51px"}}},r=i[t].left,s=i[t].top,c={unfreeze:{left:r[1],top:s[1],class_name:""},freeze:{left:r[2],top:s[2],class_name:"freeze_item"},bomb:{left:r[3],top:s[3],class_name:"boom_item"},health:{left:r[4],top:s[4],class_name:"heart_item"}}[n];re("assets/audio/treasure.mp3");let u=$(".chest_bonus .item_bonus");u.css({opacity:1}).addClass(c.class_name),setTimeout(function(){u.animate({left:c.left,top:c.top,opacity:"0"},1e3),u.animate({left:"50%",top:"50%"})},500),setTimeout(function(){l.onOpenBonus(n,o),applyScope(e),u.removeClass(c.class_name)},1500)}(3,t.item,t.quantity),setTimeout(function(){$("#victoryModal").modal("hide"),re("assets/audio/war/winningEndingSound.mp3"),setTimeout(function(){e.reward=!1,applyScope(e)},1e3),applyScope(e)},2400)}).catch(e=>{})}),c.replay=function(t){e.level=function(){var e=function(){if(n.warPlayerState&&n.warPlayerState.win_number){var e=n.warPlayerState.win_number;Math.floor(10*Math.random());if(e>=0&&e<10)var t=ae("C","D","E");else if(e>=10&&e<20)var t=ae("E","C","D");else if(e>=20&&e<30)var t=ae("B","C","D");else if(e>=30&&e<40)var t=ae("D","B","C");else if(e>=40&&e<50)var t=ae("A","B","C");else if(e>=50&&e<60)var t=ae("C","A","B");else if(e>=60)var t=ae("C","B","A")}else var t="E";return t}();if("A"==e)var t=-400;else if("B"==e)var t=-200;else if("D"==e)var t=1e3;else if("E"==e)var t=2e3;else var t=0;return t}(),K=[],_gaq.push(["_trackEvent","WAR_","Click","Replay"]),q=0,N=0,L=0,M=[],O=[],e.usedAbilities={freeze:!1,unfreeze:!1,bomb:!1,heart:!1},se(),"button"==t&&re("assets/audio/click.mp3"),V(),X(),e.time=U.time,g=setInterval(function(){e.time>0?(e.time--,10==e.time&&(m=new Audio("assets/audio/ticktock.mp3")).play(),e.time>1&&function(){if(e.bot.ability&&1==e.bot.ability.freeze){var t=Math.floor(Math.random()*U.opponent.freezedChance);0!=t||e.player.state.freezed||(re("assets/audio/freeze.mp3"),e.player.state.freezed=!0,e.usedAbilities.unfreeze||$(".challenge_3_ability_unfreeze").addClass("challenge_ability_icon_scaling"),(e.player.state.freezed=!0)&&(e.freezedCountdown=9,h=setInterval(function(){e.freezedCountdown--,e.freezedCountdown<=0&&clearInterval(h)},1e3),setTimeout(function(){$(".challenge_freezed_div").fadeOut(1e3),e.player.state.freezed&&re("assets/audio/smash.mp3"),setTimeout(function(){e.player.state.freezed=!1,$(".challenge_3_ability_unfreeze").removeClass("challenge_ability_icon_scaling"),e.$apply()},400)},U.freezedTime)),e.bot.ability.freeze--)}0==Math.floor(Math.random()*U.opponent.eatHpChance)&&e.bot.state.health<3&&e.bot.ability&&e.bot.ability.heart&&(e.bot.state.health.push(1),e.bot.ability.heart--);if(e.bot.ability&&e.bot.ability.boom>=1){if(e.player&&1==e.player.state.health.length)var n=U.opponent.boomChance-15;else var n=U.opponent.boomChance;var o=Math.floor(Math.random()*n);0==o&&($(".challenge_boom_div").css("background-image",`url('/assets/images/war/boom.gif?${e.time}')`),re("assets/audio/boom.mp3"),e.player.state.bombed=!0,e.player.state.health.splice(0,1),e.bot.ability.boom--,setTimeout(function(){e.player.state.bombed=!1,$(".challenge_boom_div").css("background-image",""),e.player.state.health<=0&&(e.player.state.die=!0,te()),e.$apply()},1500))}if(e.bot.state.health.length>1){var a=Math.floor(Math.random()*U.opponent.randomLoseHpChance);0==a&&e.bot.state.health.splice(0,1)}}()):(clearInterval(g),clearInterval(h),C=!0,setTimeout(function(){te()},500)),applyScope(e)},1e3)},r.onOpponetLoadData(function(e){c.opponentLoadingProgress=e.opponentProgress});var K=[];function Z(t,n){n&&(n.result=t,K.push(n)),q++,$("#challenge_question_div").animate({opacity:0},300),$("#challenge_question_div").animate({opacity:1},300),setTimeout(function(){X(),C=!1,e.$apply()},300)}function ee(o,a,i,s,l,u,d){_gaq.push(["_trackEvent","WAR_","Score",s]);var g=!1;let p=!1;return d||void 0!==d&&null===d?g=d==n.guest_id||null==d:a?g=!1:o?g=!0:i<s?g=!0:i>s?g=!1:(g="draw",p=!0),l?g=!1:u&&(g=!0),function(o,a){if(n.auth&&n.auth.id)var i=n.auth.id;else var i=0;let s,l;if(o||a){_gaq.push(["_trackEvent","WAR_","Win",i]),e.player.state.win=!0,$("#victoryModal").modal("show"),re("assets/audio/war/rewardSound.wav"),t.$broadcast("updateGoldBonusProgress",{}),function(e){0==c.bonusStat.gold_chest&&(c.tooltipMessage="vn"===t.language?"Thách đấu cùng eLight":"Elight's Challenge");c.bonusStat.gold_chest>=3&&(B(),c.tooltipMessage="Gold chest available");n.showHint||(c.isClose=!0)}();var u="win";s=n.guest_id,l=e.AI?e.AI.guest_id:n.opponentGuestId,applyScope(e)}else{_gaq.push(["_trackEvent","WAR_","Lose",i]),e.player.state.win=!1,re("assets/audio/war/losingEndingSound.mp3");var u="lose";s=e.AI?e.AI.guest_id:n.opponentGuestId,l=n.guest_id,applyScope(e)}if(e.AI){let e={draw:a,winner:s,loser:l};r.sendFinishStatus(t.roomName,s,e)}return u}(g,p)}function te(o,r,s,l,u){if(c.isPlayingGame=!1,sendGa(n.auth,"War","Completed","War_completed game"),!y){if(t.playAtleastOne=!0,clearInterval(p),clearInterval(g),clearInterval(h),a.cancel(I),a.cancel(k),r&&(r.result=o,K.push(r)),t.playRealtimeMode||(e.userWord=K),y=!0,$(".challenge_hp_img").removeClass("challenge_ability_icon_scaling"),_gaq.push(["_trackEvent","WAR_","Finish","War New - Finish"]),m&&m.pause(),e.player.state){e.player.state.freezed=!1,e.player.state.bombed=!1;var d=ee(e.bot.state.die,e.player.state.die,t.botCorrectAnswer,t.correctAnswer,s,l,u),f=(new Date).getTime();n.season&&f>=n.season.startTime&&f<=n.season.endingTime?t.loggedIn?i.updatePlayerStat(d,t.correctAnswer):(n.warGuestState=function(e,t){let o=n.warGuestState;return null==o||void 0==o?o={total_score:t,win_number:"win"==e?1:0,lose_number:"win"==e?0:1,win_rate:"win"==e?100:0}:("win"==e?o.win_number++:o.lose_number++,o.total_score+=t,o.win_rate=100*o.win_number/(o.win_number+o.lose_number)?o.win_number:0,o)}(d,t.correctAnswer),n.playedWithoutLogin?n.playedWithoutLogin++:n.playedWithoutLogin=1):t.loggedIn&&(n.warPlayerState.win_number=0,n.warPlayerState.lose_number=0)}e.showOpponent=!1,e.userResult=d,t.challengeState="result",applyScope(e)}}function ne(n){r.getBotInfo(n).then(function(n){1==n.status?(t.correctAnswer=0,t.challengeState="searching",e.AI={AI_name:n.user.username,imageUrl:n.user.avatar,guest_id:n.user.guest_id,school:n.user.school},t.roomName=n.room.id,function(){t.challengeState="loading",$(".finding").hide(),e.showOpponent=!0,T=function(e){let t=[];return _.each(units,function(e){t=t.concat(e.words)}),angular.copy(_.sample(t,e))}(60);Promise.all(Q(T).concat(J(T))).then(function(){t.challengeState="new_found",$(".finding").hide(),e.showOpponent=!0,S.play(),oe(),e.$apply()}).catch(function(e){return"preload error"})}()):F(n.message)}).catch(function(t){console.log(t);let n=Opponent_identity[Math.floor(Math.random()*Opponent_identity.length)];n&&(e.AI=n)})}function oe(){A=setTimeout(function(){t.challengeState="countdown",e.countdownTime=5,re("assets/audio/countdown.mp3"),c.loadingProgress=0,c.opponentLoadingProgress=0,p=setInterval(function(){e.countdownTime>1?e.countdownTime--:e.countdownTime<=1&&(clearInterval(p),t.playRealtimeMode?c.initGamePvP():c.replay()),e.$apply()},1e3),e.$apply()},1e3)}function ae(e,t,n){var o=Math.floor(10*Math.random())+1;if(o>=1&&o<=2)var a=e;else if(o>=3&&o<=5)a=t;else a=n;return a}function ie(t,n){return Math.max(1e3*t,Math.min(1e3*n,Math.floor(Math.random()*n*1e3)))+e.level}function re(e){(e=new Audio(e)).play()}function se(){y=!1,$("#treasure_chest").removeClass("challenge_victory_chest_gif"),$("#treasure_chest .challenge_reward_icon").hide().animate({left:"30%",top:"30%",opacity:"1"}),$(".end_card").removeClass("flipCus")}function le(e){$(e).addClass("rotateCus"),setTimeout(function(){$(e).removeClass("rotateCus")},100)}function ce(n,o,a){_gaq.push(["_trackEvent","WAR_","Finish","PVP"]),clearTimeout(R),R=null,t.challengeState="result",te("","",n,o,a),applyScope(e)}function ue(){t.showChallengeInvited=!0,c.opponentStatus="vn"===t.language?"Đối thủ đã rời phòng chơi.":"Your opponent has left.",applyScope(e),u=setTimeout(function(){c.opponentStatus="",t.showChallengeInvited=!1,applyScope(e)},5e3)}function de(){t.playerStat={user_id:n.auth?n.auth.id:"",display_name:n.auth?n.auth.display_name:"",avatar:n.auth?n.auth.avatar:"",school:n.auth&&n.auth.school?n.auth.school.school_name:""},t.loggedIn?i.getPlayerStat().then(function(e){if(e&&(t.playerStat.win_number=parseInt(e.win_number),t.playerStat.lose_number=parseInt(e.lose_number),t.playerStat.display_name=e.display_name?e.display_name:t.playerStat.display_name,t.playerStat.avatar=e.avatar?e.avatar:t.playerStat.avatar,t.playerStat.school=e.school?e.school:t.playerStat.school),n.warGuestState){var o={totalScore:n.warGuestState.total_score,winNumber:n.warGuestState.win_number,loseNumber:n.warGuestState.lose_number};n.warPlayerState.total_score+=o.totalScore,n.warPlayerState.win_number+=o.winNumber,n.warPlayerState.lose_number+=o.loseNumber,n.warPlayerState.win_rate=100*(o.winNumber/(o.winNumber+o.loseNumber)).toFixed(2),t.playerStat.total_score=n.warPlayerState.total_score,t.playerStat.win_number=n.warPlayerState.win_number,t.playerStat.lose_number=n.warPlayerState.lose_number,t.playerStat.win_rate=n.warPlayerState.win_rate,i.updateUserScoreAfterLogin(t.playerStat.win_number,t.playerStat.lose_number,t.playerStat.total_score,n.auth.user_token)}}):n.warGuestState&&(t.playerStat.win_number=n.warGuestState.win_number,t.playerStat.lose_number=n.warGuestState.lose_number,t.playerStat.win_rate=n.warGuestState.win_rate),applyScope(e)}function ge(){delete c.rematchStatus,delete t.roomName,delete t.userAccept,G={},y=!1,t.correctAnswer=0,t.botCorrectAnswer=0,f=!1,v=!1,t.challengeState="preparing"}c.flip=function(e,t,n){$(".end_card[data-item="+e+"]").hasClass("flipCus")?$(".end_card[data-item="+e+"]").removeClass("flipCus"):(re(t),$(".end_card[data-item="+e+"]").addClass("flipCus"),_gaq.push(["_trackEvent","WAR_","View word",n]))},e.learnWord=function(){"preparing"===t.challengeState&&(ge(),t.random=1,t.isLearn_word=!0,t.elightube=!1,t.topic=!1,t.isQuote=!1,c.leaderboardLazyload=!1,c.leaderboardRankBySchool=!1,c.messageInRankBySchool=!1,delete e.userBySchool,t.$broadcast("reInit",{}),r.leaveRoom(t.roomName),applyScope(e))},c.review_word=function(){_gaq.push(["_trackEvent","WAR_","Review all words","Review all words"])},c.openLoginForm=function(){t.openLoginFromOutside=!0},c.endTutorial=function(){t.challengeState="preparing",t.endTutorial=!1,_gaq.push(["_trackEvent","WAR_","Click","Finish-Tutorial"]),applyScope(e)},c.closeChestNotiModal=function(){c.isClose=!0},t.$on("hide-tutorial",function(){c.endTutorial()}),t.$on("loggedin",function(){c.isCloseBanner=!0,de()}),e.sendRequestRematch=function(){if(f=!1,t.userAccept){var n=t.userAccept.hostGuestId?t.userAccept.hostGuestId:t.userAccept.guest_id;v?(ue(),e.backScreen()):e.invite(n)}else ne(e.AI.guest_id)},r.onFinish(function(o){if("result"!=t.challengeState){let a;o&&o.score&&(o.winner||null==o.winner)?(a=o.winner,Object.keys(o.score).forEach(function(a){a==n.guest_id?(t.correctAnswer=o.score[a],e.player.state.health=o.health[a]):(t.botCorrectAnswer=o.score[a],e.bot.state.health=o.health[a])})):n.realtimePlayerScore&&Object.keys.forEach(n.realtimePlayerScore)(function(e){e==n.guest_id?t.correctAnswer=n.realtimePlayerScore[e]:t.botCorrectAnswer=n.realtimePlayerScore[e]}),ce(!1,!1,a)}}),r.onDisconnect(e=>{t.userAccept&&t.userAccept.waiting&&t.userAccept.guest_id==e.guest_id&&0==e.status&&(clearTimeout(x),G={},t.showChallengeInvited=!1,t.challengeState="preparing",F("vn"===t.language?"Lời thách đấu đã bị hủy.":"The invitation has been canceled"))}),r.onOpponentDisconnect(function(n){G&&!angular.equals({},G)&&t.showChallengeInvited?(G={},t.showChallengeInvited=!1,F("vn"===t.language?"Lời thách đấu đã bị hủy.":"The invitation has been canceled")):(v=!0,ue(),"question"===t.challengeState?ce(!1,!0):(ge(),clearInterval(p),clearTimeout(A),clearTimeout(R),e.backScreen()))}),c.trustAsHtml=function(e){return s.trustAsHtml(e)}}]}),angular.module("lesson.elightube").component("elightube",{templateUrl:"app/components/lesson/elightube/elightube.template.html",controller:["$localStorage","$timeout",function(e,t){let n=this;n.videos=e.videos,n.first_video=_.first(e.videos),n.rest_video=_.rest(e.videos),n.url_poster=function(e){return"https://api.elight.edu.vn/public/images/video/"+e+"?v="+ee_update_version},sendGa(e.auth,"Video library","Display","Video library_display");let o={dots:!1,lazyLoad:"ondemand",slidesToShow:4,slidesToScroll:4,infinite:!1,prevArrow:'<i class="fa fa-chevron-left slick-prev-customer hidden"></i>',nextArrow:'<i class="fa fa-chevron-right slick-next-customer"></i>'};n.showItem=4,t(function(){n.showItem=50;let e=$(".video_card_small");e.not(".slick-initialized").slick(o),e.on("afterChange",function(e,t,n){_gaq.push(["_trackEvent","VIDEO_","Next and Prev Button Video From Extension","Next and Prev Button"]);$(this).data().type;let o=t.slideCount;$(this).data().id,$(this);n>=o-3?$(this).find(".slick-next-customer").addClass("hidden"):$(this).find(".slick-next-customer").removeClass("hidden"),0===n?$(this).find(".slick-prev-customer").addClass("hidden"):$(this).find(".slick-prev-customer").removeClass("hidden")})}),n.redirectLinkVideo=function(t){sendGa(e.auth,"Video library","Click","Video library_use"),_gaq.push(["_trackEvent","VIDEO_","redirectLinkVideo From Extension","From Extension"]),window.open("https://elightube.com/"+t.meta_url+"/"+t.id)}}]}),angular.module("lesson.quote").component("quote",{templateUrl:"app/components/lesson/quotes/quote.template.html",bindings:{sampleQuote:"="},controller:["dailyTaskService","levelExpService","mainService","$rootScope","$scope","$timeout","$localStorage","$sce",function(e,t,n,o,a,i,r,s){var l=this;let c=new Audio("assets/audio/fork_media_cartoon_bubbles_bubbling.mp3");var u=0,d=!1;r.auth&&(r.auth.actived_code.new_code>0||r.auth.actived_code.count_use_code>0||r.auth.actived_code.count_user_courses>0)&&(d=!0),sendGa(r.auth,"Quotation","Display","Quotation_display"),this.$onInit=function(){let t=JSON.parse(localStorage.getItem("likedQuote"));var g;function p(e){if(((new Date).setHours(0,0,0,0)-(null!==r.lastTimeUpdateQuotation?r.lastTimeUpdateQuotation:(new Date).setHours(0,0,0,0)))/864e5>=1||!r.quotes||0===r.quotes.length)r.quotes=[],n.getQuotes(function(t){r.quotes=t.data;let n=_.filter(r.quotes,function(e){return"newsline-v1"!==e.category});r.lastTimeUpdateQuotation=(new Date).setHours(0,0,0,0);let o=h(n,JSON.parse(localStorage.getItem("_qd")),e);l.quoteGroup=o,l.quote=m(o.quotes,o.category),l.heart_quote=v(l.quote.id)});else{let t=h(_.filter(r.quotes,function(e){return"newsline-v1"!==e.category}),JSON.parse(localStorage.getItem("_qd")),e);l.quoteGroup=t,l.quote=m(t.quotes,t.category),l.heart_quote=v(l.quote.id)}}function h(e,t,n){return n?_.findWhere(e,{category:n}):_.sample(e)}function m(e,t){var n;let o=JSON.parse(localStorage.getItem("_qd"));if(o)if(void 0!=o[t]){var a=o[t].length;if(a>=e.length)if(o[t]=[],"newsline-v1"==t)n=e[a=0],o[t].push(n.id),localStorage.setItem("_qd",JSON.stringify(o)),l.heart_quote=v(n.id);else{localStorage.setItem("_qd",JSON.stringify(o));let e=_.filter(r.quotes,function(e){return"newsline-v1"!==e.category});var i=_.sample(e);l.quoteGroup=i,n=m(i.quotes,i.category)}else n=e[a],o[t].push(n.id),localStorage.setItem("_qd",JSON.stringify(o)),l.heart_quote=v(n.id)}else n=f(e,t),l.heart_quote=v(n.id);else n=f(e,t),l.heart_quote=v(n.id);return n}function f(e,t){var n=e[0],o={};let a=JSON.parse(localStorage.getItem("_qd"));return a&&(o=a),o[t]=[],o[t].push(n.id),localStorage.setItem("_qd",JSON.stringify(o)),n}function v(e){return null===t||void 0===t?(t=[],!1):-1!==t.indexOf(e)}r.showHint||(r.timeNotShowNewsline=1,(g=new EnjoyHint({onEnd:function(){$("body").css({overflow:"hidden"})},onSkip:function(){$("body").css({overflow:"hidden    "})}})).set([{"next .btn_translate":"Nhấn và giữ để dịch cả câu",showSkip:!1},{"next .eng_word":"Click vào từ để dịch từ",showSkip:!1},{"next .btn_like":"Thả tim cho quote",showSkip:!1},{"next .btn_learn":"Xem thêm câu mới",showSkip:!1}]),g.run(),r.showHint=!0),p(),o.$on("reinit-quote",function(){p(o.quoteCategory)}),l.translateWord=function(e,t){l.wordBeingTranslated="",$(".ui_input").attr("checked",!1),a.survey=!0,a.disabledSendBtn=!0,l.showWordTranslated=!0,l.searching=!0,l.wordLeftPos=e.pageX,l.wordTopPos=e.pageY-220,t=(t=(t=t.normalize("NFD").replace(/[\u0300-\u036f]/g,"")).replace(/đ/g,"d")).replace(/[^a-zA-Z ]/g,""),l.wordBeingTranslated=t,sendGa(r.auth,"Quotation","Use","Quotation_use"),n.videoLibraryDictionary(t.toLowerCase(),function(e){l.searching=!1,1==e.data.code?(l.wordData=e.data.data,l.wordData.example=l.wordData.example.split("<br>"),l.wordData.full_text_translated=l.wordData.full_text_translated?"<div>"+l.wordData.full_text_translated+"</div>":"",l.found=!0):(l.wordData="",l.found=!1),_gaq.push(["_trackEvent","quote","translateWord",""]),o.showChallengeNoti||i(o.checkConditionPushChallengeNoti,500)})},$("html").click(function(e){"eng_word"===e.target.className&&(l.showWordTranslated=!0),$(e.target).closest(".quote").length||($(".vi_word_modal").hide(),l.showWordTranslated=!1)}),l.trustAsHtml=function(e){return s.trustAsHtml(e)},l.translate=function(){l.showQuoteVi=!0,_gaq.push(["_trackEvent","quote","translateSentence",""]),o.showChallengeNoti||i(o.checkConditionPushChallengeNoti,500)},l.cancelTranslate=function(){l.showQuoteVi=!1},$(".btn_translate").mouseout(function(){l.showQuoteVi=!1}),l.pronounce=function(e){new Audio(e).play()},l.learnWord=function(){o.random=1,o.isLearn_word=!1,o.isQuote=!0,o.elightube=!1,o.topic=!1,o.isSearch=!1,o.isIdioms=!1,o.isCollocation=!1,o.isGrammar=!1,u++,applyScope(a),d?l.quote=m(l.quoteGroup.quotes,l.quoteGroup.category):3!=u?l.quote=m(l.quoteGroup.quotes,l.quoteGroup.category):"newsline-v1"==l.quoteGroup.category?l.quote={content:"Ngày 05/12 Elight chào mừng học viên thứ 40.000. Trở thành học viên VIP để trải nghiệm ứng dụng học tiếng Anh siêu hấp dẫn tại đây: <a href='https://elight.edu.vn/khoa-toan-dien-3-trong-1-trial-extension/?utm_source=Extension&utm_medium=newsline' target='_blank'>'http://bit.ly/HocvienVIP'</a>",content_vi:"Ngày 05/12 Elight chào mừng học viên thứ 40.000. Trở thành học viên VIP để trải nghiệm ứng dụng học tiếng Anh siêu hấp dẫn tại đây: <a href='https://elight.edu.vn/khoa-toan-dien-3-trong-1-trial-extension/?utm_source=Extension&utm_medium=newsline' target='_blank'>http://bit.ly/HocvienVIP</a>",id:"0",tag:"newsline",type:"marketing"}:l.quote={content:"Ngày 05/12 Elight chào mừng học viên thứ 40.000. Trở thành học viên VIP để trải nghiệm ứng dụng học tiếng Anh siêu hấp dẫn tại đây: <a href='https://elight.edu.vn/khoa-toan-dien-3-trong-1-trial-extension/?utm_source=Extension&utm_medium=quotes' target='_blank'>'http://bit.ly/HocvienVIP'</a>",content_vi:"Ngày 05/12 Elight chào mừng học viên thứ 40.000. Trở thành học viên VIP để trải nghiệm ứng dụng học tiếng Anh siêu hấp dẫn tại đây: <a href='https://elight.edu.vn/khoa-toan-dien-3-trong-1-trial-extension/?utm_source=Extension&utm_medium=quotes' target='_blank'>http://bit.ly/HocvienVIP</a>",id:"0",tag:"quotation",type:"marketing"},o.showChallengeNoti||i(o.checkConditionPushChallengeNoti,500)},l.heart=function(){l.heart_quote=!0,t.push(l.quote.id),localStorage.setItem("likedQuote",JSON.stringify(t)),e.updateTask("like_quote"),setTimeout(function(){c.play(),setTimeout(function(){c.pause()},1300)},600);let n=0,a=setInterval(function(){let e=Math.floor(40*Math.random())+1,t=Math.floor(65*Math.random())+10,o=Math.floor(100*Math.random())+1,i=Math.floor(25*Math.random())+100,r=Math.floor(5*Math.random())+5;$(".bg_heart").append("<div class='heart' style='width:"+t+"px;height:"+t+"px;left:"+o+"%;background:rgba(255,"+(i-25)+","+i+",1);-webkit-animation:love "+r+"s ease;-moz-animation:love "+r+"s ease;-ms-animation:love "+r+"s ease;animation:love "+r+"s ease'></div>"),$(".bg_heart").append("<div class='heart' style='width:"+(t-10)+"px;height:"+(t-10)+"px;left:"+(o+e)+"%;background:rgba(255,"+(i-25)+","+(i+25)+",1);-webkit-animation:love "+(r+5)+"s ease;-moz-animation:love "+(r+5)+"s ease;-ms-animation:love "+(r+5)+"s ease;animation:love "+(r+5)+"s ease'></div>"),$(".heart").each(function(){let e=$(this).css("top").replace(/[^-\d\.]/g,""),t=$(this).css("width").replace(/[^-\d\.]/g,"");(e<=-100||t>=150)&&$(this).detach()}),++n>=3&&clearInterval(a)},500);var s=l.quoteGroup.category;"newsline-v1"!=s?_gaq.push(["_trackEvent","quote","like",s]):_gaq.push(["_trackEvent","newsline","like",s]),sendGa(r.auth,"Quotation","Use","Quotation_use"),o.showChallengeNoti||i(o.checkConditionPushChallengeNoti,1e3)},l.contribute=function(){n.contribute()},a.survey=!0,a.disabledSendBtn=!0,a.checkDisable=function(){setTimeout(function(){$("#survey_dict_form input:checkbox:checked").length>0?a.disabledSendBtn=!1:a.disabledSendBtn=!0,applyScope(a)},300)},a.showFeedbackDiv=function(){$(".quote_arrow_box").toggle(300)},a.sendReport=function(){let e=l.wordData?l.wordData.word:l.wordBeingTranslated,t={"entry.1559549395":e,"entry.135539557":$("#content_quote_error").prop("checked")?"Yes":"No","entry.348269786":$("#translate_quote").prop("checked")?"Yes":"No"};e&&$.ajax({method:"POST",url:"https://docs.google.com/forms/d/11NVklaG6ySKyj62qiOgU8ooA4Pvf4aIV6ezmufHKoAI/formResponse",data:t}),$(".survey_div").fadeOut(500,function(){a.survey=!1,applyScope(a),$(".elight_thank_you").fadeIn(500)})}}}]}),angular.module("lesson.word").component("streak",{templateUrl:"app/components/lesson/streak/streak.template.html",controller:streakController}),streakController.$inject=["$rootScope","$scope","$localStorage","streakService","$timeout"],angular.module("lesson.topic").component("topic",{templateUrl:"app/components/lesson/topic/topic.template.html",controller:["$scope","$localStorage","$rootScope","$sce","$timeout",function(e,t,n,o,a){let i=this;i.localesMessage=settingLocales,i.showing=i.localesMessage[0][n.language];let r=i.localesMessage[17][n.language],s=i.localesMessage[18][n.language];i.allOpened=!1,i.loginViewList=!0,e.openSettingModal=!0,i.isToeic=!1,i.loginView=!1,i.isBasic=!0,i.unitType=1,i.isCommunication=!1,i.thankYouCard=!1,i.user=t.auth,i.resetParams=function(){i.unitDetail=!1,i.messagePremium=!1,i.form_support={name:"",email:t.email,phone:"",content:""},i.form_feedback={email:t.email,content:""}},n.$on("loggedin",function(){i.reloadUnit()}),i.openProfileModal=function(){e.user=t.auth,e.user?(userService.fetch(),e.login=!0,e.openModal=!0,openModalDetail()):(e.loginFromProfile=!0,$(".login-form").modal("show"),e.login=!1),delete n.avatar},i.returnLearnWord=function(){n.topic=!1,n.isLearn_word=!0},i.resetParams(),i.updateHistory=ee_update_history,i.selectedUnits=t.unitSettingSelected.length>1?[91]:t.unitSettingSelected,i.reloadUnit=function(){t.unitSettingSelected||(t.unitSettingSelected=angular.copy(t.unit));let e=t.unit,n=t.auth;if(n&&(n.actived_code.count_use_code>0||n.actived_code.count_user_courses>0)){units.concat(toeicUnits).concat(grammarUnits).concat(communicationUnit);e=t.unit}let o=units.concat(toeicUnits).concat(grammarUnits).concat(communicationUnit);_.map(o,function(n){if(e){let o,a=_.contains(e,n.id);o=t.wordReview;let i=n.words,r=o?o.slice(0):[],s=_.pluck(i,"word"),l=_.pluck(r,"word"),c=_.difference(s,l);if(n.total=i.length,n.learned=i.length-c.length,a){let e=_.contains(t.unitSettingSelected,n.id);n.actived=!!e,n.lock=!1}}}),i.units=o},i.reloadUnit(),i.trustAsHtml=function(e){return o.trustAsHtml(e)},i.toCategory=function(t){i.showing=t,applyScope(e),i.resetParams(),i.thankYouCard=!1},i.changeStatus=function(e,t,n,o,a){i.isBasic=e,i.isToeic=t,i.isGrammar=n,i.isCommunication=o,i.unitType=a},i.index_topic=n.selectedUnit,i.popup_landing_page=function(e){e!==i.index_topic&&$("#popup_landing_page").modal("toogle")},i.chooseTopic=function(e,o){let a=t.unit,r=a.indexOf(e);if(t.auth){let n=t.auth.actived_code;0===n.count_use_code&&0===n.count_user_courses?1===a.length?_.unique(t.unit.push(e)):-1===r&&(_gaq.push(["_trackEvent","SET_","Choose unit",o]),i.openAllUnit()):i.allOpened=!0}else-1===r&&(_gaq.push(["_trackEvent","SET_","Choose unit",o]),i.openOnUnit());i.chooseOneTopic(e,r),i.reloadUnit(),n.$broadcast("reinit",{}),i.returnLearnWord(),n.$broadcast("change_course",function(){})},e.$on("open_setting",function(){i.toggleSetting()}),i.chooseMultiTopic=function(e,n){let o=t.unitSettingSelected;if(-1!==n){let n=_.indexOf(o,e);-1===n?t.unitSettingSelected.push(e):1!==o.length&&(o.splice(n,1),t.unitSettingSelected=o)}},i.chooseOneTopic=function(e,n){let o=t.unitSettingSelected;if(-1!==n){_.indexOf(o,e);t.unitSettingSelected=[e]}},i.goLandingPage=function(){_gaq.push(["_trackEvent","SET_","Open landing page","Open landing page"])},i.closeMessagePremium=function(){i.messagePremium=!1},i.openRegister=function(e){i.messagePremium=!1,e===s?localStorage.getItem("user")||(i.loginViewList=!1,a(function(){i.loginView=!0},500),n.openLoginFromOutside=!0):e===r&&chrome.tabs.create({url:"https://elight.edu.vn/khoa-toan-dien-3-trong-1/?utm_source=extension&utm_medium=setting&utm_campaign=course"})},i.openUnit=function(e){let n=t.unit,o=n.indexOf(e);if(t.auth){let a=t.auth.actived_code;0===a.count_use_code&&0===a.count_user_courses?1===n.length?(_.unique(t.unit.push(e)),i.unitInfor.unlock=!0):-1===o&&i.openAllUnit():(i.unitInfor.unlock=!0,i.allOpened=!0)}else t.unit.length>1?i.openAllUnit():i.openOnUnit()},i.openAllUnit=function(){i.messagePremium=!0,i.messageHead={first:"Trở thành học viên VIP để mở toàn bộ chủ đề từ vựng",second:i.localesMessage[20][n.language],button:r}},i.openOnUnit=function(){i.messagePremium=!0,i.messageHead={first:i.localesMessage[19][n.language],second:i.localesMessage[21][n.language],button:s}},i.getDetailUnit=function(e,o,a,r){let s,l=units.concat(toeicUnits).concat(grammarUnits).concat(communicationUnit);i.unitDetail=!0,s=t.wordReview;let c=l[e-1].words,u=s?s.slice(0):[],d=_.pluck(c,"word"),g=_.pluck(u,"word"),p=_.difference(d,g);i.unitInfor={total:c.length,image:c[0].image,title:o,newWord:p.length,detail:"vn"===n.language?l[e-1].description:l[e-1].description_por,unlock:a,index:e};let h=i.unitInfor.total-i.unitInfor.newWord,m=i.unitInfor.newWord-3;AmCharts.makeChart("process_unit_setting",{type:"pie",theme:"light",dataProvider:[{title:i.localesMessage[22][n.language],value:h,color:"#c0c0c0",colorTitle:"#000000"},{title:i.localesMessage[23][n.language],value:m,color:"#E5E6E5",colorTitle:"#000000"}],titleField:"title",valueField:"value",labelRadius:10,radius:"22%",colorField:"color",innerRadius:"80%",labelColorField:"colorTitle",labelText:"[[title]]: [[value]] ",startDuration:0})},i.backToListUnit=function(){i.resetParams(),i.reloadUnit()}}]}),angular.module("lesson.word").component("word",{templateUrl:"app/components/lesson/words/word_new.template.html",bindings:{sampleNumber:"="},controller:wordController}),wordController.$inject=["$rootScope","$scope","$localStorage","wordMemo","$timeout","streakService","preloadService"],angular.module("mainScreen.end-game").component("endGame",{templateUrl:"app/components/mainScreen/end-game/end-game.template.html",controller:endGameController,bindings:{link:"@",number:"@",className:"@",words:"="}}),endGameController.$inject=["$timeout","ngAudio","ngAudioGlobals","$scope","$rootScope","$localStorage","streakService","progressLineService"],angular.module("lesson.challenge_new").component("challengeEnding",{templateUrl:"app/components/lesson/challenge-new/ending/ending.template.html",controller:["$scope","$rootScope","$localStorage","$interval","$timeout","challengeService","challenge.io.service","challenge.items.service",function(e,t,n,o,a,i,r,s){this.challengeItems=s.get();e.userWord=e.$parent.userWord,e.player=e.$parent.player,e.showOpponent=e.$parent.showOpponent,e.userResult=e.$parent.userResult,e.bot=e.$parent.bot,e.backScreen=e.$parent.backScreen,e.AI=e.$parent.AI,e.sendRequestRematch=e.$parent.sendRequestRematch}]}),angular.module("lesson.challenge_new").component("challengeMenu",{templateUrl:"app/components/lesson/challenge-new/menu/menu.template.html",controller:["$scope","$rootScope","$localStorage","$interval","$timeout","challengeService","challenge.io.service","challenge.items.service","$sce",function(e,t,n,o,a,i,r,s,l){e.localesMessage=challengeLocales;let c=this;c.challengeItems=s.get(),c.bonusStat=s.getBonusStat();n.auth&&n.auth.user_token;function u(){var o;if(function(){t.playerStat={user_id:n.auth?n.auth.id:"",display_name:n.auth?n.auth.display_name:"",avatar:n.auth?n.auth.avatar:"",school:n.auth&&n.auth.school?n.auth.school.school_name:""},n.warPlayerState&&(n.warPlayerState.school=n.auth&&n.auth.school?n.auth.school.school_name:"");t.loggedIn?i.getPlayerStat().then(function(e){if(e&&(t.playerStat.win_number=parseInt(e.win_number),t.playerStat.lose_number=parseInt(e.lose_number)),n.warGuestState){var o={totalScore:n.warGuestState.total_score,winNumber:n.warGuestState.win_number,loseNumber:n.warGuestState.lose_number};n.warPlayerState.total_score+=o.totalScore,n.warPlayerState.win_number+=o.winNumber,n.warPlayerState.lose_number+=o.loseNumber,n.warPlayerState.win_rate=100*(o.winNumber/(o.winNumber+o.loseNumber)).toFixed(2),t.playerStat.total_score=n.warPlayerState.total_score,t.playerStat.win_number=n.warPlayerState.win_number,t.playerStat.lose_number=n.warPlayerState.lose_number,t.playerStat.win_rate=n.warPlayerState.win_rate,i.updateUserScoreAfterLogin(t.playerStat.win_number,t.playerStat.lose_number,t.playerStat.total_score,n.auth.user_token)}}):n.warGuestState&&(t.playerStat.win_number=n.warGuestState.win_number,t.playerStat.lose_number=n.warGuestState.lose_number,t.playerStat.win_rate=n.warGuestState.win_rate);applyScope(e)}(),o=n.guest_id,r.getUserList(o).then(function(e){t.userOnline?e.forEach(function(e){t.userOnline=t.userOnline.filter(function(t){return t.user_id!=e.user_id}),t.userOnline.push(e)}):t.userOnline=e}).catch(function(e){console.log(e)}),n.auth){var a=n.auth;a.school?(e.userBySchool=!0,h(50,a.school.id),m(n.guest_id,a.school.id)):a.school||(delete e.userBySchool,h(50),m(n.guest_id))}else h(50),m(n.guest_id)}function d(){if(null===c.bonusStat.silver_chest)return;let e=(c.bonusStat.silver_chest+432e5-Date.now())/1e3;if(e>0){let t=Math.floor(e/3600),n=Math.floor((e-3600*t)/60),o=Math.floor(e-3600*t-60*n);c.remainingTime=`${t}:${n<10?"0"+n:n}:${o<10?"0"+o:o}`}else c.remainingTime="0:00:00",n.showHint||(c.isClose=!0),c.bonusStat.gold_chest<3&&(c.tooltipMessage="Silver chest available",v())}function g(t,n,o){let a=1==t?"Gold Chest":2==t?"Silver Chest":"Win Chest";_gaq.push(["_trackEvent","WAR_","Open "+a,"Open item(s)"]);let i={1:{left:{1:"130px",2:"20px",3:"130px",4:"20px"},top:{1:"235px",2:"235px",3:"300px",4:"300px"}},2:{left:{1:"130px",2:"20px",3:"130px",4:"20px"},top:{1:"130px",2:"130px",3:"210px",4:"210px"}},3:{left:{1:"585px",2:"585px",3:"585px",4:"585px"},top:{1:"-110px",2:"-190px",3:"-32px",4:"51px"}}},r=i[t].left,l=i[t].top,c={unfreeze:{left:r[1],top:l[1],class_name:""},freeze:{left:r[2],top:l[2],class_name:"freeze_item"},bomb:{left:r[3],top:l[3],class_name:"boom_item"},health:{left:r[4],top:l[4],class_name:"heart_item"}}[n];var u;u="assets/audio/treasure.mp3",(u=new Audio(u)).play();let d=$(".chest_bonus .item_bonus");d.css({opacity:1}).addClass(c.class_name),setTimeout(function(){d.animate({left:c.left,top:c.top,opacity:"0"},1e3),d.animate({left:"50%",top:"50%"})},500),setTimeout(function(){s.onOpenBonus(n,o),applyScope(e),d.removeClass(c.class_name)},1500)}function p(e,t,n){var o,a=!1,i=e.findIndex(function(e){return e.guest_id===t.guest_id&&void 0!=t.guest_id||e.id===t.id&&void 0!=t.id});if(i>=0)e[i].score=n,a=!0,(o=e).sort(function(e,t){return t.score-e.score});else for(var r=0;r<e.length;r++)if((e[r].guest_id!==t.guest_id&&void 0!=t.guest_id||e[r].id!==t.id&&void 0!=t.id)&&e[r].score<n&&!a){var s=e.length-r;o=e.splice(r,s,t).concat(e.splice(0,r+1)),a=!0;break}return a||(o=e),o}function h(e,t){c.loading_rank=!0;var o=(new Date).getTime();if(n.timeCallRank=n.timeCallRank?n.timeCallRank:{},void 0==t)if(!n.timeCallRank||!n.timeCallRank.all||_(n.timeCallRank.all,o)>2||!n.allRank||0===n.allRank.length)n.timeCallRank.all=(new Date).getTime(),i.getTopUsers(e,function(e,t){c.loading_rank=!1,e&&(c.leaderboardValues=e.data,n.allRank=e.data,c.loading_rank=!1)});else if(c.loading_rank=!1,n.warPlayerState){var a=n.allRank,r={guest_id:n.guest_id,avatar:n.auth.avatar,username:n.auth.display_name,school:n.auth.school,score:n.warPlayerState.win_number},s=n.warPlayerState.win_number;c.leaderboardValues=p(a,r,s),n.allRank=c.leaderboardValues}else c.leaderboardValues=n.allRank;else if(!n.timeCallRank||!n.timeCallRank.schoolmate||_(n.timeCallRank.schoolmate,o)>2||!n.schoolmateRank||0===n.schoolmateRank.length)n.timeCallRank.schoolmate=(new Date).getTime(),i.getTopUserBySchool(e,t,function(e,t){c.loading_rank=!1,e&&(c.leaderboardValues=e.data,n.schoolmateRank=e.data,c.loading_rank=!1)});else if(c.loading_rank=!1,n.warPlayerState&&n.auth){a=n.schoolmateRank,r={guest_id:n.guest_id,avatar:n.auth.avatar,username:n.auth.display_name,school:n.auth.school,score:n.warPlayerState.win_number},s=n.warPlayerState.win_number;c.leaderboardValues=p(a,r,s)}else c.leaderboardValues=n.schoolmateRank;console.log("leaderboard",c.leaderboardValues)}function m(e,t){n.rank=n.rank?n.rank:{};var o=(new Date).getTime();if(t&&n.auth&&n.auth.school){if(!n.timeCallRank||!n.timeCallRank.schoolmate||_(n.timeCallRank.schoolmate,o)>2||!n.rank.schoolmate)n.timeCallRank.schoolmate=(new Date).getTime(),i.getUserRank(n.guest_id,t,function(e){e&&(c.ownerRank=e.data,n.rank.schoolmate=e.data)});else if(c.ownerRank=n.rank.schoolmate,c.ownerRank.score=n.warPlayerState?n.warPlayerState.win_number:c.ownerRank.score,n.schoolmateRank){a=n.schoolmateRank.findIndex(function(e){return e.guest_id===n.guest_id});c.ownerRank.userRank=a>=0?a+1:c.ownerRank.userRank}}else if(!n.timeCallRank||!n.timeCallRank.all||_(n.timeCallRank.all,o)>2||!n.rank.all)n.timeCallRank.all=(new Date).getTime(),i.getUserRank(n.guest_id,null,function(e){e&&(c.ownerRank=e.data,n.rank.all=e.data)});else if(c.ownerRank=n.rank.all,c.ownerRank.score=n.warPlayerState?n.warPlayerState.win_number:c.ownerRank.score,n.allRank){var a=n.allRank.findIndex(function(e){return e.guest_id===n.guest_id});c.ownerRank.userRank=a>=0?a+1:c.ownerRank.userRank}}function f(t){c.loading_rank=!0,n.timeCallRank=n.timeCallRank?n.timeCallRank:{},n.rank=n.rank?n.rank:{};var o=(new Date).getTime();if(e.showSchoolScore)if(!n.timeCallRank||!n.timeCallRank.school||_(n.timeCallRank.school,o)>2||!n.schoolRank||0===n.schoolRank.length)n.timeCallRank.school=(new Date).getTime(),i.getTopSchools(t,function(e,t){c.loading_rank=!1,e&&(c.leaderboardSchoolRank=e.data,n.schoolRank=e.data)});else if(c.loading_rank=!1,n.auth&&n.auth.school){var a=n.schoolRank,r=n.auth.school,s=n.auth.school.score;c.leaderboardSchoolRank=p(a,r,s)}else c.leaderboardSchoolRank=n.schoolRank;else if(e.showSchoolTotalStudent)if(!n.timeCallRank||!n.timeCallRank.totalStudent||_(n.timeCallRank.totalStudent,o)>2||!n.schoolRankByTotalStudent||0===n.schoolRankByTotalStudent.length)n.timeCallRank.totalStudent=(new Date).getTime(),i.getTopSchoolByTotalStudent(function(e,t){if(c.loading_rank=!1,e){c.leaderboardSchoolRank=e.data.length>50?e.data.slice(0,49):e.data,n.schoolRankByTotalStudent=e.data;var o=e.data.filter(function(e){return e.school==n.auth.school.id});c.ownerRank=o[0]?o[0]:{},c.ownerRank.schoolRank=e.data.indexOf(o[0])+1}});else if(c.loading_rank=!1,c.leaderboardSchoolRank=n.schoolRankByTotalStudent.length>50?n.schoolRankByTotalStudent.slice(0,49):n.schoolRankByTotalStudent,n.auth&&n.auth.school){var l=n.schoolRankByTotalStudent.filter(function(e){return e.school==n.auth.school.id});c.ownerRank=l[0]?l[0]:{},c.ownerRank.schoolRank=n.schoolRankByTotalStudent.indexOf(l[0])+1}}function _(e,t){return(t-e)/36e5}function v(){1==c.userGroupChestNoti&&a(function(){$("#chest-noti").addClass("chest-noti-message-display")},100)}t.stepInvite=0,c.guest_id=n.guest_id,c.trustAsHtml=function(e){return l.trustAsHtml(e)},t.updateGoldBonusProgressListener&&(t.updateGoldBonusProgressListener(),delete t.updateGoldBonusProgressListener),t.updateGoldBonusProgressListener=t.$on("updateGoldBonusProgress",()=>{c.bonusStat.gold_chest++}),r.onSubcribeUser(function(e){t.userOnline?(t.userOnline=t.userOnline.filter(function(t){return t.user_id!=e.user_id}),n.guest_id!=e.guestId&&t.userOnline.push(e)):t.userOnline=[e]}),r.onDisconnect(function(e){t.userOnline&&t.userOnline.length>0&&t.userOnline.splice(t.userOnline.indexOf(e),1)}),e.play_game=e.$parent.play_game,e.inviteRecent=e.$parent.inviteRecent,e.invite=e.$parent.invite,e.inviteByGuestId=function(){t.searchStr?(t.messageError="",e.invite()):t.messageError="vn"===t.language?"Bạn cần nhập Guest ID của đối thủ!":"Enter opponent's Guest ID only!"},o(function(){d()},1e3),c.win_rate=function(e,t){return e?100*(e/(e+t)).toFixed(2):0},this.openWinningBonus=(()=>{this.bonusStat.gold_chest>=3&&s.openGoldChest().then(e=>{e&&(this.winningBonusOpenned=!0,g(1,e.item,e.quantity),a(()=>{this.winningBonusOpenned=!1,function(e){c.tooltipMessage="Thách đấu cùng eLight",0==c.bonusStat.gold_chest&&(c.tooltipMessage="Thách đấu cùng eLight");c.bonusStat.gold_chest>=3&&(v(),c.tooltipMessage="Gold chest available");n.showHint||(c.isClose=!0)}()},1500))}).catch(e=>{})}),c.openDailyBonus=(()=>{let e=Date.now();null!==c.bonusStat.silver_chest&&e>=c.bonusStat.silver_chest+432e5&&s.openSilverChest().then(e=>{e&&(c.dailyBonusOpenned=!0,c.tooltipMessage="Thách đấu cùng eLight",g(2,e.item,e.quantity),a(()=>{c.dailyBonusOpenned=!1,d()},2e3))}).catch(e=>{})}),c.leaderboardLazyload=function(){!c.sendingRequest&&c.leaderboardValues&&c.leaderboardValues.length<50&&!e.userBySchool&&(c.sendingRequest=!0,h(50).then(function(){c.sendingRequest=!1})),!c.sendingRequest&&c.leaderboardRankBySchool&&c.leaderboardRankBySchool.length<50&&c.leaderboardRankBySchool.length>=0&&e.userBySchool&&(c.sendingRequest=!0,h(50).then(function(){c.sendingRequest=!1}))},c.leaderboardLazyload(),c.openProfile=function(){t.loggedIn?c.openProfileBox=!0:(t.random=1,t.isLearn_word=!0,t.isQuote=!1,t.elightube=!1,t.topic=!1,t.$broadcast("reInit",{}),applyScope(e),$("#profile_modal").modal("show"))},c.startTutorial=function(){t.challengeState="tutorial",_gaq.push(["_trackEvent","WAR_","Click","Start-Tutorial"])},c.closeProfile=function(){u(),c.openProfileBox=!1},c.toggleInvitePopup=function(){$(".js-challenge-popup").toggle(200),t.searchStr="",t.messageError="",c.refreshRecentOpponents()},c.refreshRecentOpponents=function(){$(".js-challenge-popup__refresh-button-div__glyphicon-refresh").hide(),$(".js-challenge-popup__refresh-button-div__loading-image").show(),r.getRecentOpponents(n.guest_id).then(t=>{setTimeout(function(){$(".js-challenge-popup__refresh-button-div__loading-image").hide(),$(".js-challenge-popup__refresh-button-div__glyphicon-refresh").show()},300),1==t.code?e.recentOpponents=t.data:e.recentOpponents=[]}).catch(e=>{console.log(e),$(".js-challenge-popup__refresh-button-div__loading-image").hide(),$(".js-challenge-popup__refresh-button-div__glyphicon-refresh").show()})},c.openTapRankAllUser=function(){delete e.userBySchool,delete c.ownerRank,h(50),m(n.guest_id)},c.openTapRankBySchool=function(){e.userBySchool=!0,t.playerStat.school?(h(50,n.auth.school.id),m(n.guest_id,n.auth.school.id)):(c.messageInRankBySchool="vn"===t.language?"Bạn chưa cập nhật thông tin trường học":"Not available in your country",delete c.leaderboardValues)},c.openUserTap=function(){delete e.schoolTabOpenning,delete c.leaderboardSchoolRank,delete c.leaderboardValues,delete e.showSchoolScore,delete e.showSchoolTotalStudent,n.auth.school?c.openTapRankBySchool():c.openTapRankAllUser()},c.openSchoolTap=function(){e.showSchoolScore||(e.schoolTabOpenning=!0,e.showSchoolScore=!0,delete c.ownerRank,delete e.showSchoolTotalStudent,f(50),n.auth&&(n.auth.school||t.playerStat.school.id)&&function(e){c.loading_rank=!0,n.rank=n.rank?n.rank:{};var t=(new Date).getTime();if(!n.timeCallRank||!n.timeCallRank.school||_(n.timeCallRank.school,t)>2||!n.rank.school)n.timeCallRank.school=(new Date).getTime(),i.getSchoolRank(e,function(e,t){c.loading_rank=!1,e&&(c.ownerRank=e.data,n.rank.school=e.data)});else if(c.loading_rank=!1,c.ownerRank=n.rank.school,n.auth&&n.auth.school&&n.schoolRank&&n.schoolRank.length>0&&(c.ownerRank.score=n.auth.school.score,n.schoolRank)){var o=n.schoolRank.findIndex(function(e){return e.id===n.auth.school.id});c.ownerRank.schoolRank=o>=0?o+1:c.ownerRank.schoolRank}}(n.auth.school.id))},c.openSchoolTotalStudentTap=function(){e.showSchoolTotalStudent||(e.showSchoolTotalStudent=!0,delete e.showSchoolScore,delete c.ownerRank,f())};let w=0;!function e(){const t=document.getElementsByClassName("slider");for(let e=0;e<t.length;e++)t[e].style.display="none";++w>t.length&&(w=1),t[w-1].style.display="block",setTimeout(e,1e4)}(),u(),e.player={state:{freezed:!1,bombed:!1,die:!1,health:[1,1,1],win:!1}}}]}),angular.module("lesson.challenge_new").component("challengeReview",{templateUrl:"app/components/lesson/challenge-new/review-modal/reviewModal.template.html",controller:["$scope","$rootScope","$localStorage","$interval","$timeout","challengeService","challenge.io.service",function(e,t,n,o,a,i,r){let s=this;e.userWord=e.$parent.userWord,e.player=e.$parent.player,e.showOpponent=e.$parent.showOpponent,e.userResult=e.$parent.userResult,e.bot=e.$parent.bot,e.localesMessage=challengeLocales,s.flip=function(e,t,n){$(".end_card[data-item="+e+"]").hasClass("flipCus")?$(".end_card[data-item="+e+"]").removeClass("flipCus"):(!function(e){(e=new Audio(e)).play()}(t),$(".end_card[data-item="+e+"]").addClass("flipCus"),_gaq.push(["_trackEvent","WAR_","View word",n]))},s.survey=!0,s.disabledSendBtn=!0,s.showArrowBox=[],s.showFeedbackDiv=function(e){s.disabledSendBtn=!0,s.showArrowBox.forEach(function(t,n){n!=e&&(s.showArrowBox[n]=!1)}),s.showArrowBox[e]=!s.showArrowBox[e]},s.checkDisable=function(){setTimeout(function(){$("#challenge_survey_form .challenge_checkbox:checked").length>0?s.disabledSendBtn=!1:s.disabledSendBtn=!0,applyScope(e)},300)},s.sendReport=function(t){let n=$("#content_error").prop("checked")?"Yes":"No",o=$("#image").prop("checked")?"Yes":"No",a={"entry.23121512":t||0,"entry.1328524160":n,"entry.1765249265":o};$.ajax({method:"POST",url:"https://docs.google.com/forms/d/1kMxdmoIBoXhONiaSafDHGGNB-k8I5owZ63lpOaTfhYU/formResponse",data:a}),$(".survey_div").fadeOut(500,function(){e.survey=!1,applyScope(e),$(".elight_thank_you").fadeIn(500)})}}]}),angular.module("lesson.challenge_new").component("season",{templateUrl:"app/components/lesson/challenge-new/season/season.template.html",controller:["$scope","$rootScope","$localStorage","$interval","$timeout","challengeService",function(e,t,n,o,a,i){let r=this;const s=86400;function l(){void 0!==r.countdownInterval&&(o.cancel(r.countdownInterval),r.countdownInterval=void 0)}n.season||(n.season={}),function(){(new Date).getTime();i.findCurrentSeason(function(e,a){if(a)console.log("findCurrentSeason",a);else if(1==e.code){(new Date).getTime();let a=new Date(e.data.time_start_season).getTime(),i=new Date(e.data.time_end_season).getTime();n.season={count:e.data.count,startTime:a,endingTime:i,topUserLastSeason:e.data.top_users_last_season,schoolWinLastSeason:e.data.school_win_last_season},function(){let e=Date.now(),a=n.season.count,i=n.season.startTime,c=n.season.endingTime;i>e?(r.started=!1,r.remainingTime=Math.floor((i-e)/1e3),r.seasonTimeLeftText=`Season ${a} bắt đầu trong`):(r.started=!0,r.remainingTime=Math.floor((c-e)/1e3),r.seasonTimeLeftText=`Season ${a} kết thúc trong`);void 0!==n.season.schoolWinLastSeason&&t.playerStat.school==n.season.schoolWinLastSeason&&(t.playerStat.specialAvatar=!0);l(),r.countdownInterval=o(()=>{!function(){if(r.remainingTime<=0){let e=n.season.count;if(r.started)return l(),r.seasonTimeLeft=`Season ${e} đã kết thúc.`,void(r.ended=!0);{let t=(new Date).getTime();r.started=!0,r.remainingTime=Math.floor((n.season.endingTime-t)/1e3),r.seasonTimeLeftText=`Season ${e} kết thúc trong`}}if(r.remainingTime-=1,r.remainingTime<s){let e=Math.floor(r.remainingTime/3600),t=Math.floor((r.remainingTime-60*e*60)/60),n=Math.floor(r.remainingTime-60*e*60-60*t);e<10&&(e=`0${e}`),t<10&&(t=`0${t}`),n<10&&(n=`0${n}`),r.seasonTimeLeft=`${e}:${t}:${n}`}else{let e=Math.floor(r.remainingTime/s),t=Math.floor((r.remainingTime-e*s)/3600);r.seasonTimeLeft=`${e} ngày ${t<10?"0"+t:t} giờ`}}()},1e3)}()}})}(),r.showSeasonModal=function(){r.seasonModal=!0,r.remainingTime<=0||!r.started?i.findCurrentSeason(function(e,t){if(e){if((new Date(e.data.time_end_season).getTime()<=(new Date).getTime()||!r.started)&&1!=n.season.count)n.warPlayerState&&(n.warPlayerState.win_number=0,n.warPlayerState.lose_number=0),r.schoolWinSeason=e.data.school_win_last_season?e.data.school_win_last_season.school_name:"",r.userMVP=e.data.user_mvp?e.data.user_mvp:"",r.topUsersOfSeason=e.data.top_users_last_season,r.showSeasonResultModal=!0,r.topUsersOfSeason.forEach(function(e){n.guest_id===e.guest_id&&(r.showBtnReceiveGift=!0)});else{r.showSeasonAnnouncementModal=!0;let t=new Date(e.data.time_end_season).getTime();n.season={count:e.data.count,endingTime:t,topUserLastSeason:[],schoolWinLastSeason:{}},r.seasonTimeLeft=(t-Date.now())/1e3}}else console.log(t)}):(r.showSeasonAnnouncementModal=!0,n.season&&(n.season.topUserLastSeason=[],n.season.schoolWinLastSeason={}))},r.closeSeasonModal=function(){r.seasonModal=!1},r.openReceiveGiftForm=function(){r.receiveGift_name=null,r.receiveGift_phoneNum=null,r.receiveGift_email=null,r.receiveGift_address=null,r.receiveGiftForm=!0},r.closeReceiveGiftForm=function(){r.receiveGiftForm=!1},r.closeSuccessModal=function(){delete r.successMsg},r.sendInfoToReceiveGift=function(){var e=new RegExp("^[0-9]+$"),t=new RegExp(/^(([^<>()\[\]\\.,;:\s@"]+(\.[^<>()\[\]\\.,;:\s@"]+)*)|(".+"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/);r.receiveGift_name&&r.receiveGift_phoneNum&&r.receiveGift_email&&r.receiveGift_address?!e.test(r.receiveGift_phoneNum)||r.receiveGift_phoneNum.length<10?r.errorMsg="Vui lòng nhập số điện thoại hợp lệ!":t.test(r.receiveGift_email)?(r.isReceivedInfoFromUser=!0,i.sendInfoToReceiveGift(n.guest_id,r.receiveGift_name,r.receiveGift_phoneNum,r.receiveGift_email,r.receiveGift_address,function(e,t){r.isReceivedInfoFromUser=!1,e&&1===e.code?(delete r.receiveGiftForm,r.successMsg="Elight đã nhận được thông tin của bạn!"):e&&0===e.code?r.errorMsg=e.message:console.log(t)})):r.errorMsg="Vui lòng nhập email hợp lệ!":r.errorMsg="Vui lòng nhập đầy đủ thông tin!"}}]}),angular.module("lesson.challenge_new").component("challengeTutorial",{templateUrl:"app/components/lesson/challenge-new/tutorial/tutorial.template.html",controller:["$scope","$rootScope","$localStorage","$interval","$timeout","challengeService",function(e,t,n,o,a,i){var r,s,l=!1;function c(e){(e=new Audio(e)).play()}function u(){t.endTutorial=!0,applyScope(e)}t.tutorialCorrect=0,e.question_answers=tutorialData,_.each(e.question_answers,function(t,n){e.question_answers[n].checked=!1}),e.answer=tutorialData[2],t.endTutorial=!1,r=new EnjoyHint({onEnd:function(){u(),$("body").css({overflow:hidden})},onSkip:function(){u()}}),s=[{"click #tutorial_answer_2":challengeLocales[30][t.language],showSkip:!1},{"next .challenge_score_player_div":challengeLocales[31][t.language],showSkip:!0},{"next .challenge_3_heart_left":challengeLocales[32][t.language]+' <i class="fa fa-heart heart_red" aria-hidden="true"></i>',showSkip:!0},{"next .challenge_clock":challengeLocales[33][t.language]+' <i class="fa fa-heart heart_red" aria-hidden="true"></i>',showSkip:!0},{"next .challenge_your_info":challengeLocales[34][t.language],showSkip:!0},{"next .challenge_3_weapon":challengeLocales[35][t.language],showSkip:!0},{"next .challenge_3_ability_freeze":challengeLocales[8][t.language],showSkip:!0},{"next .challenge_3_ability_unfreeze":challengeLocales[9][t.language],showSkip:!0},{"next .challenge_3_ability_boom":challengeLocales[10][t.language],showSkip:!0},{"next .challenge_3_ability_heart":challengeLocales[36][t.language]+'<i class="fa fa-heart heart_red" aria-hidden="true"></i>',showSkip:!0}],r.set(s),r.run(),this.checkAnswer=function(n,o){var a;l||(e.question_answers[o].checked=!0,n==e.answer.word?(c("assets/audio/right.mp3"),l=!0,a=".challenge_score_player",$(a).addClass("rotateCus"),setTimeout(function(){$(a).removeClass("rotateCus")},500),t.tutorialCorrect++):c("assets/audio/wrong.mp3"))}}]}),angular.module("basic-guideline").component("guideline",{templateUrl:"app/components/basic-guideline/basic-guideline.template.html",controller:["$scope","$localStorage","$rootScope",function(e,t,n,o){n.random=1,n.isLearn_word=!0,n.isQuote=!1,n.guideStep=1,$(".topic_box").addClass("guideline_focus"),e.nextStep=function(){n.guideStep++,3==n.guideStep?(n.quoteCategory="work",n.isLearn_word=!1,n.isQuote=!0,n.elightube=!1,n.topic=!1,$(".quote_box").addClass("guideline_focus")):4==n.guideStep?(n.quoteCategory="newsline-v1",n.$broadcast("reinit-quote",{})):5==n.guideStep?(n.isLearn_word=!0,n.elightube=!1,n.topic=!1,n.isQuote=!1,$(".topic_box").removeClass("guideline_focus guideline-basic-box"),$(".notebook_btn").addClass("guideline_focus")):6==n.guideStep?($(".notebook_btn").removeClass("guideline_focus"),$(".challenge_btn").addClass("guideline_focus")):7==n.guideStep?($(".challenge_btn").removeClass("guideline_focus"),$(".video_btn").addClass("guideline_focus")):8==n.guideStep?($(".video_btn").removeClass("guideline_focus"),$(".profile").addClass("guideline_focus")):9==n.guideStep?($(".profile").removeClass("guideline_focus"),$(".new_setting").addClass("guideline_focus")):10==n.guideStep?$(".new_setting").removeClass("guideline_focus"):11==n.guideStep&&e.finish()},e.finish=function(){n.guideStep=1,t.basicGuideline||(t.basicGuideline=!0),$(".topic_box").removeClass("guideline_focus"),$(".quote_box").removeClass("guideline_focus"),$(".video_btn").removeClass("guideline_focus"),$(".notebook_btn").removeClass("guideline_focus"),$(".challenge_btn").removeClass("guideline_focus"),$(".profile").removeClass("guideline_focus"),$(".new_setting").removeClass("guideline_focus"),n.basicGuideline=!1,n.$broadcast("guideline",{}),applyScope(e)}}]}),angular.module("inviteFriend").component("inviteFriend",{templateUrl:"app/components/inviteFriend/inviteFriend.template.html",controller:["$scope","$rootScope","$localStorage","inviteFriendService","$timeout","challenge.io.service",function(e,t,n,o,a,i){let r=this;function s(){var e=r.giftType;r.showGift=!0,1==e?i.openInviteChest(n.guest_id).then(function(e){1==e.code&&(n.ability?n.ability={freeze:n.ability.freeze+3,unfreeze:n.ability.unfreeze+3,boom:n.ability.boom+3,heart:n.ability.heart+3}:n.ability={freeze:3,unfreeze:3,boom:3,heart:3}),p(1)}).catch(function(e){console.log(e)}):3==e||6==e&&r.openListTopic()}function l(){a(1e3).then(function(e){return r.inviteProgres.percentage=0,a(1e3)}).then(function(e){return r.inviteProgres=u(r.new_inivte_num),a(500)}),$("#gift-type").addClass("shake").delay(500).queue(function(){r.giftMessage="Bạn đã nhận được quà",$(this).removeClass("close_gift").addClass("open_gift")}),a(function(){s()},1300)}function c(){let e=localStorage.getItem("next-gift");null!=e&&void 0!=e||(e=Date.now()+2592e6,localStorage.setItem("next-gift",e));let t=(e-Date.now())/1e3;if(t>0){let e=Math.floor(t/86400),n=Math.floor((t-86400*e)/3600),o=Math.floor((t-86400*e-3600*n)/60);r.remainingTime=`${e} ngày ${n<10?"0"+n:n} giờ ${o<10?"0"+o:o} phút`}else r.remainingTime="0 ngày 00 giờ 00 phút",localStorage.removeItem("next-gift"),delete n.giftReceived,delete n.giftOpenned,r.gift_1_open=!1,r.gift_3_open=!1,r.gift_6_open=!1,r.gift_10_open=!1,r.gift_1_received=!1,r.gift_3_received=!1,r.gift_6_received=!1,r.gift_10_received=!1,c()}function u(e){var t={percentage:0,stateProgress:1,inviteClass:"invite_blue_box",addNum:1,invite_num:(e%=10)||0};return e<1?(t.stateProgress=1,t.inviteClass="invite_blue_box"):e>=1&&e<3?(t.stateProgress=3,t.inviteClass="invite_pink_box"):e>=3&&e<6?(t.stateProgress=6,t.inviteClass="invite_green_box"):e>=6&&e<10&&(t.stateProgress=10,t.inviteClass="invite_orange_box"),t.addNum=t.stateProgress-e,t.percentage=(e/t.stateProgress*100).toFixed(2),t}function d(){var e={guest_id:n.guest_id};n.call_invite_date=getDate(),r.inviteProgres=u(0),o.getInviteByUserId(e).then(function(e){if(e&&1==e.code){if(e.data.length>0){Math.floor(e.data.length/10)>n.inviteStage&&e.data.length%10!=0&&(n.giftOpenned=[],r.gift_1_open=!1,r.gift_3_open=!1,r.gift_6_open=!1,r.gift_10_open=!1,n.inviteStage=Math.floor(e.data.length/10));var t=e.data.length%10;0===t&&(t=10),r.userInvited=t,t>=10||0==t?(n.giftReceived=[],n.giftReceived.push(10,6,3,1),r.gift_10_received=!0,r.gift_6_received=!0,r.gift_3_received=!0,r.gift_1_received=!0,g()):t>=6?(n.giftReceived=[],n.giftReceived.push(6,3,1),r.gift_6_received=!0,r.gift_3_received=!0,r.gift_1_received=!0,g()):t>=3?(n.giftReceived=[],n.giftReceived.push(3,1),r.gift_3_received=!0,r.gift_1_received=!0,g()):t>=1&&(n.giftReceived=[],n.giftReceived.push(1),r.gift_1_received=!0,g())}else r.userInvited=0;!function(){var e=n.giftReceived;if(e.length>0){r.notiReceiveGift=!0;let e=n.giftReceived.filter(e=>-1==n.giftOpenned.indexOf(e));e.length>0?r.notiReceiveGift=!0:r.notiReceiveGift=!1}-1!=e.indexOf(1)&&(r.gift_1_received=!0);-1!=e.indexOf(3)&&(r.gift_3_received=!0);-1!=e.indexOf(6)&&(r.gift_6_received=!0);-1!=e.indexOf(10)&&(r.gift_10_received=!0)}(),function(){var e=n.giftOpenned;-1!=e.indexOf(1)&&(r.gift_1_open=!0);-1!=e.indexOf(3)&&(r.gift_3_open=!0);-1!=e.indexOf(6)&&(r.gift_6_open=!0);-1!=e.indexOf(10)&&(r.gift_10_open=!0)}()}else console.log("error"),r.inviteProgres=u(0)})}function g(){n.giftReceived=_.difference(n.giftReceived,n.giftOpenned);var e=Math.max.apply(null,n.giftReceived);n.giftReceived.length>0&&(r.notiReceiveGift=!0),e>0&&r.openGift(e)}function p(e){if(n.giftReceived.splice(n.giftReceived.indexOf(e),1),n.giftOpenned.push(e),1==e){r.gift_1_open=!0,r.gift_1_received=!1;var t="1_"+n.guest_id;_gaq.push(["_trackEvent","INVITE","Receive gift",t])}else if(3==e){r.gift_3_open=!0,r.gift_3_received=!1;t="3_"+n.guest_id;_gaq.push(["_trackEvent","INVITE","Receive gift",t])}else if(6==e){r.gift_6_open=!0,r.gift_6_received=!1;t="6_"+n.guest_id;_gaq.push(["_trackEvent","INVITE","Receive gift",t])}else if(10==e){r.gift_10_open=!0,r.gift_10_received=!1;t="10_"+n.guest_id;_gaq.push(["_trackEvent","INVITE","Receive gift",t])}-1!=n.giftOpenned.indexOf(10)&&-1!=n.giftOpenned.indexOf(6)&&-1!=n.giftOpenned.indexOf(3)&&-1!=n.giftOpenned.indexOf(1)&&(r.notiReceiveGift=!1),0==n.giftReceived.length&&(r.notiReceiveGift=!1)}r.openInviteFriend=function(){r.notiReceiveGift?_gaq.push(["_trackEvent","INVITE","Open invitation","yes"]):_gaq.push(["_trackEvent","INVITE","Open invitation","no"]),r.userInvited||(r.userInvited=0),function(e){if(r.openedGift=!1,r.new_inivte_num=e,r.new_inivte_num>n.old_invite_gift_num||!n.old_invite_gift_num)if(1==e||3==e||6==e||10==e){var t=e-1;r.inviteProgres=u(t),a(1e3).then(function(e){return r.inviteProgres.percentage=100,a(1e3)}).then(function(t){return r.openGift(e),a(500)}),n.old_invite_gift_num=r.new_inivte_num}else r.inviteProgres=u(e),n.old_invite_gift_num=r.new_inivte_num;else r.inviteProgres=u(e),n.old_invite_gift_num=r.new_inivte_num}(r.userInvited),t.random=4,t.invite=!0,n.firstTimeDisplayInvite||(n.firstTimeDisplayInvite=!0,r.notiReceiveGift=!1)},r.bookUrl="https://api.elight.edu.vn/public/uploads/files/speak%20out-elementary-student%20book.pdf",r.closeGift=function(){r.inviteProgres=u(r.new_inivte_num),r.openedGift=!1},r.openGift=function(e){r.giftMessage="Click để nhận quà",1==e?r.classGiftBox="blue_gift_box":3==e?r.classGiftBox="pink_gift_box":6==e?r.classGiftBox="green_gift_box":10==e&&(r.classGiftBox="orange_gift_box"),r.openedGift=!0,r.showGift=!1,r.giftType=e;var t=e+"_"+n.guest_id;_gaq.push(["_trackEvent","INVITE","Open gift",t])},r.closeInvite=function(){t.random=1,t.invite=!1,t.isQuote=!1,t.isLearn_word=!0,t.elightube=!1,t.topic=!1},r.downloadBook=function(){p(3)},r.giftMessage="Click để nhận quà",r.unboxGift=function(){l();var e=r.giftType+"_"+n.guest_id;_gaq.push(["_trackEvent","INVITE","Unbox gift",e])},r.guest_id=n.guest_id,r.copyLink=function(){a(function(){document.querySelector(".js-copytextarea").select();try{var e=document.execCommand("copy")?"Copying text was successful":" Copying text was unsuccessful";r.copyMsg=e,a(function(){r.copyMsg=""},1500)}catch(e){console.log("Oops, unable to copy")}},200);var e=n.guest_id;_gaq.push(["_trackEvent","INVITE","copy link",e])},r.likeGift=function(e){n.giftLiked.push(e);var t=e.toString();_gaq.push(["_trackEvent","INVITE","like gift",t]),1==e?r.likeGift_1=!0:3==e?r.likeGift_3=!0:6==e?r.likeGift_6=!0:10==e&&(r.likeGift_10=!0)},function(){if(n.call_invite_date){var e=n.call_invite_date,t=getDate(),o=minusDayDate(e,t);o<=0||d()}else d();n.giftReceived||(n.giftReceived=[]);n.giftOpenned||(n.giftOpenned=[]);n.giftLiked||(n.giftLiked=[]);n.inviteStage||(n.inviteStage=0);n.firstTimeDisplayInvite||(r.notiReceiveGift=!0);!function(){var e=n.giftLiked;-1!=e.indexOf(1)&&(r.likeGift_1=!0);-1!=e.indexOf(3)&&(r.likeGift_3=!0);-1!=e.indexOf(6)&&(r.likeGift_6=!0);-1!=e.indexOf(10)&&(r.likeGift_10=!0)}()}(),setInterval(function(){c()},1e3),r.openListTopic=function(e){if(n.unit&&n.unit.length>=10)p(6),r.messageFullUnit="Bạn đã mở tất cả Unit";else{r.giftType=6;var t=n.unit;e&&(t=_.initial(n.unit),n.unit=t,$("body").removeClass("modal-open").css("padding-right","")),_.map(units,function(e){t&&(_.contains(t,e.id)&&(e.lock=!1))}),r.units=units}},r.chooseTopic=function(e,o){r.unitName=o,r.unitId=e;let a=_.contains(n.unit,r.unitId);t.selectedUnit=n.unit,a||($("#confirm-topic-box").modal("show"),$(".modal-backdrop").appendTo("#list_topic"),$(".modal_topic").removeClass("modal-open").css("padding-right",""))},r.closeConfirmTopicModal=function(){$("#confirm-topic-box").modal("hide"),$(".modal_topic").removeClass("modal-backdrop")},r.confirmTopic=function(){_.unique(n.unit.push(r.unitId)),p(6)},r.msg_discount_code="",r.addUserInfo=function(){var e={name:r.inviteUser.name,phone:r.inviteUser.phone,guest_id:n.guest_id,email:n.auth&&n.auth.email?n.auth.email:""};r.inviteUser={},o.updateUserInvitation(e).then(function(e){1==e.code&&(r.msg_discount_code="Thêm thông tin thành công",p(10))}).catch(function(){console.log("Error")})},r.openFB=function(){var e=n.guest_id;_gaq.push(["_trackEvent","INVITE","open fb",e])},r.openEmail=function(){var e=n.guest_id;_gaq.push(["_trackEvent","INVITE","open email",e])}}]}),angular.module("login").component("login",{templateUrl:"app/components/login/login.template.html",bindings:{showSection:"@"},controller:["loginService","$scope","$rootScope","$localStorage","mainService","wordMemo","challenge.io.service",function(e,t,n,o,a,i,r){var s=this;s.loading=!1,s.formState="login",s.showSection="recommend",s.localesMessage=loginLocales,s.$onInit=function(){s.openRegisterForm=function(){_gaq.push(["_trackEvent","INTRO","Register",""]),s.showSection="register-form",delete s.error},s.openLoginForm=function(){_gaq.push(["_trackEvent","INTRO","Login",""]),s.showSection="login-form",delete s.error},s.removeshowSection=function(){$(".welcome_box").hide(),n.showWelcome=null,$("#profile_modal").modal("hide")},s.login=function(l,c){o.guest_id||a.getGuestId(function(e){o.guest_id=e.data}),angular.isUndefined(l,c)||(s.loading=!0,e.login(l,c).then(function(e){if(1===e.code)return n.$broadcast("loggedin",{}),s.messsync=s.localesMessage[27][n.language],i.getWordByUser(e.user.user_token);throw s.messsync="",s.loading=!1,!e.error||""!==e.error.data&&null!==e.error.data?s.localesMessage[29][n.language]:s.localesMessage[28][n.language]}).then(function(e){s.messsync="";let i=e.data,l=[],c=units.concat(toeicUnits).concat(grammarUnits).concat(communicationUnit);_.map(c,function(e){_.map(e.words,function(t){t.unitId=e.id,l.push(t)})});let u=[];_.map(i,function(e){let t=_.find(l,function(t){return e.detail.word.toLowerCase()===t.word.toLowerCase()});t?u.push({word:e.detail.word,reviewDate:new Date(e.review_date).getTime(),EF:e.current_EF,Q:e.proficiency,I:e.current_I,meaning:t.translate,image:t.image,audio:t.audio,phonetic:t.phonetic,updated_at:Date.now(),unitId:t.unitId}):console.log(e.detail.word)}),o.wordReview=u;var d=JSON.parse(localStorage.getItem("user")).user_token;a.syncGuestAndUserId(Number(o.guest_id),d,function(e){200==e.status&&1==e.data.code&&(n.$broadcast("deny-invite"),r.disconnect(o.guest_id).then(()=>{o.guest_id=e.data.real_guest_id.toString();var t={email:o.auth.email,username:o.auth.display_name,userId:o.auth.id,avatar:o.auth.avatar,guestId:o.guest_id,school:o.auth.school};r.subcribeUser(t.email,t.username,t.userId,t.guestId,t.avatar,t.school).then(e=>{1==e.status&&(delete o.rank,delete o.schoolmateRank,e.new_token&&(o.token_guest_id=e.new_token),o.auth.school=e.school,localStorage.setItem("user",JSON.stringify(o.auth)))}).catch(e=>{console.log("login",e)})}))}),_gaq.push(["_trackEvent","Extension Account","Log in",""]);let g=o.auth;if(o.unit=Array.from({length:100},(e,t)=>t+1),g.actived_code.count_use_code>0||g.actived_code.count_user_courses>0){units.concat(toeicUnits).concat(grammarUnits).concat(communicationUnit);n.avatar=JSON.parse(localStorage.getItem("user")).avatar,t.$parent.loginFromProfile&&(s.loginFromProfile=!0,n.welcome=!0,o.welcome=!0,$(".welcome_box").hide(),n.showWelcome=null),s.showSection="login-success",n.freeUser="studentAccount"}else{let e=_.uniq(_.pluck(u,"unitId"));e.length<2&&_.unique(o.unit.concat(e)),s.showSection="login-success",n.freeUser="studentAccount",o.unit.length<2&&(n.freeUser="freeUser1",t.$parent.loginFromProfile&&(n.showWelcome="topic2")),t.$parent.loginFromProfile&&(s.loginFromProfile=!0),n.avatar=JSON.parse(localStorage.getItem("user")).avatar}s.loginFromProfile=!0,n.welcome=!0,o.welcome=!0,n.showWelcome=!1,o.lastTimeGetVideos=!1,$(".welcome_box").hide(),$(".login-form").modal("hide"),$(".modal-backdrop").remove(),s.loading=!1}).catch(function(e){s.loading=!1,s.messsync="",e=e.data?s.localesMessage[30][n.language]:e,s.error=e}))},s.signup=function(t,o,a,i){var r={username:t,email:o,password:a,re_password:i};angular.isUndefined(r)||(s.loading=!0,e.signUp(r).then(function(e){1===e.code?(_gaq.push(["_trackEvent","Extension Account","Register",""]),s.login(r.email,r.password)):s.error=e,s.loading=!1}).catch(function(e){s.loading=!1,s.error=s.localesMessage[30][n.language]}))}}}]}),angular.module("mainScreen").component("mainScreen",{templateUrl:"app/components/mainScreen/mainScreen.template.html",controller:["$scope","$rootScope","mainService","$timeout",function(e,t,n,o){var a=this;a.openPractice=function(){o(function(){$("#practice_btn").click()}),_gaq.push(["_trackEvent","EE Features","From Main Screen","Practice"])},a.findOppClick=function(e){$(".main_screen_chal").prop("disabled",!0),t.$broadcast("triggerChallengeScreen1",{opponent:e}),_gaq.push(["_trackEvent","EE Features","From Main Screen","War - Normal"])},4==t.random&&(n.getVideoList().then(t=>{a.videoList=t,console.log(t),e.$apply()}),a.goToVideoPage=function(e){_gaq.push(["_trackEvent","EE Features","VideoLibrary","open video link"]),window.open(e)})}]}),angular.module("notebook").component("notebook",{templateUrl:"app/components/notebook/notebook.template.html",controller:["mainService","ngAudio","$rootScope","$scope","$timeout","wordMemo","dailyTaskService","levelExpService","$sce","$localStorage",function(e,t,n,o,a,i,r,s,l,c){let u,d=this;d.reminderLoading=!1,d.noWord="",d.notFound="";let g=[],p=0,h=[],m=new Audio("assets/audio/ending_sound.wav");function f(){$(".ui_input").attr("checked",!1),o.survey=!0,o.disabledSendBtn=!0,d.notFound="",_gaq.push(["_trackEvent","EE Features","Word Notebook","Search"]),sendGa(c.auth,"Dictionary","Use","Dictionary_use"),(u=(u=(u=(u=$("#notebook_modal input").val()).normalize("NFD").replace(/[\u0300-\u036f]/g,"")).replace(/đ/g,"d")).replace(/[^a-zA-Z- ]/g,""))&&(d.loading=!0,$("#notebook_modal input").val(u),d.searched||(d.searched=!0),o.$apply(),e.videoLibraryDictionary(u.toLowerCase(),function(e){d.loading=!1,1==e.data.code?(d.found=!0,d.wordData=e.data.data,d.wordData.full_text_translated&&(o.full_text_translated="<div>"+d.wordData.full_text_translated+"</div>"),console.log(o.full_text_translated),d.wordData.example=d.wordData.example.split("<br>")):(d.found=!1,d.notFound="Xin lỗi, chúng tôi không tìm thấy từ bạn tìm kiếm.")}))}function v(){p>=g.length?($(".flip_container .flipper").hasClass("flipped")&&$(".flip_container .flipper").removeClass("flipped"),d.flashCardState="end",m.play(),0===h.length?(d.unrememberedWord=[],d.ending_message="Wow, bạn thật là xuất sắc"):(d.unrememberedWord=h,d.ending_message="Đây là những từ bạn chưa nhớ, hãy cố gắng lên nhé")):(d.flashCardWord=angular.copy(g[p]),null===d.flashCardWord.phonetic||void 0===d.flashCardWord.phonetic?d.flashCardWord.phonetic="":d.flashCardWord.phonetic="/"+d.flashCardWord.phonetic+"/",d.flashCardWord.audio=new Audio(g[p].audio),d.flashCardWord.audio.play(),$(".flip_container .flipper").hasClass("flipped")&&$(".flip_container .flipper").removeClass("flipped"),p++)}d.user=c.auth,$(".notebook_btn").click(function(){_gaq.push(["_trackEvent","EE Features","Word Notebook","Open Notebook"]),$("#notebook_modal").modal("show"),$("#notebook_carousel").carousel(0),$(".notebook_btn").css("z-index",1050),d.loading=!1}),$(".yourWord_btn").click(function(){_gaq.push(["_trackEvent","EE Features","Word Notebook","Open savedWords"]),$("#yourWord_modal").modal("show"),$(".yourWord_btn").css("z-index",1050),$(".word_star").tooltip({show:{effect:"blind",duration:800}}),d.total=i.getLength(),d.easy=i.getDifficultLength("easy"),d.medium=i.getDifficultLength("medium"),d.hard=i.getDifficultLength("hard"),o.$apply()}),$("#notebook_modal").on("hidden.bs.modal",function(){$(".notebook_btn").css("z-index",0)}),$("#yourWord_modal").on("hidden.bs.modal",function(){$(".yourWord_btn").css("z-index",0)}),$(".notebook_btn").tooltip({show:{effect:"blind",duration:800}}),$(".yourWord_btn").tooltip({show:{effect:"blind",duration:800}}),$(".icon_star").popover(),$(".icon_star").on("shown.bs.popover",function(){setTimeout(function(){$(".icon_star").popover("hide")},1e3)}),$("#notebook_modal .search_icon").click(function(){f(),d.searchWord=!0}),$("#notebook_modal .search_input").bind("keyup",function(e){13===e.keyCode&&(f(),d.searchWord=!0)}),$("#notebook_modal").on("hidden.bs.modal",function(){d.searchWord&&!n.showChallengeNoti&&a(n.checkConditionPushChallengeNoti,500)}),d.saveWord=function(){_gaq.push(["_trackEvent","EE Features","Word Notebook","Save Word"]),i.save(u.toLowerCase(),d.wordData.translated),d.saved=!0},d.pronounce=function(e){new Audio(e).play()},o.trustAsHtml=function(e){return l.trustAsHtml(e)},n.$on("openFlashCard",function(e,t){!function(e){if(g=[],p=0,h=[],e){for(var t=0;t<e.length;t++){let n={word:word_day[e[t]].content,translated:word_day[e[t]].content_vi,audio:word_day[e[t]].audio,phonetic:word_day[e[t]].phonetic};g.push(n)}d.flashCardState="test",v(),$("#flashCard_modal").modal("show")}else{let e=JSON.parse(localStorage.getItem("wordReview"));null===e||void 0===e||e.length<10?(d.flashCardState="end",d.unrememberedWord=[],d.ending_message="Bạn hãy lưu ít nhất 10 từ để ôn bằng Flashcard nhé",$(".flip_container .flipper").hasClass("flipped")&&$(".flip_container .flipper").removeClass("flipped"),$("#flashCard_modal").modal("show")):(d.flashCardState="start",$(".flip_container .flipper").hasClass("flipped")&&$(".flip_container .flipper").removeClass("flipped"),$("#flashCard_modal").modal("show"))}}(t)}),d.flip=function(e){_gaq.push(["_trackEvent","EE Features","Flashcard","flip"]),$(".flip_container .flipper").hasClass("flipped")?($(".flip_container .flipper").removeClass("flipped"),d.flashCardWord.audio.play()):$(".flip_container .flipper").addClass("flipped")},d.flashCardButton=function(e){"remembered"===e?(_gaq.push(["_trackEvent","EE Features","Flashcard","remembered"]),right.pause(),right.currentTime=0,right.play()):"notRemembered"===e&&(_gaq.push(["_trackEvent","EE Features","Flashcard","unremembered"]),wrong.pause(),wrong.currentTime=0,wrong.play(),h.push(g[p-1])),v()},d.startFlashcard=function(t){d.flashCardState="test",d.reminderLoading=!0;let n=i.getDesiredDifficult(t),a=[];for(let t=0;t<n.length;t++){let o=new Promise(function(o,a){if(n[t].meaning)e.queryFirebase(n[t].word.toLowerCase(),function(e){o(e.data)});else{let e=angular.copy(_.findWhere(word_day,{content:n[t]}));e.word=e.content,e.translated=e.content_vi,delete e.content,delete e.content_vi,o(e)}});a.push(o)}Promise.all(a).then(e=>{g=_.shuffle(e),d.reminderLoading=!1,v(),o.$apply()})},d.openPractice=function(){a(function(){$(".practice_btn").trigger("click"),$("#yourWord_modal").modal("hide")})};let w=JSON.parse(localStorage.getItem("wordReview"));d.wordLength=w?w.length:0,d.toNewWord=function(){$("#flashCard_modal").modal("hide"),n.random=1,n.isLearn_word=!0,n.isQuote=!1,n.elightube=!1,n.topic=!1},o.survey=!0,o.disabledSendBtn=!0,o.checkDisable=function(){setTimeout(function(){$("#survey_dict_form input:checkbox:checked").length>0?o.disabledSendBtn=!1:o.disabledSendBtn=!0,applyScope(o)},300)},o.showFeedbackDiv=function(){$(".dictionary_arrow_box").toggle(300)},o.sendReport=function(){let e=$("#notebook_modal input").val(),t={"entry.23121512":e,"entry.1826879993":$("#phonetic").prop("checked")?"Yes":"No","entry.1328524160":$("#translate").prop("checked")?"Yes":"No","entry.1765249265":$("#translate_yet").prop("checked")?"Yes":"No"};e&&$.ajax({method:"POST",url:"https://docs.google.com/forms/d/e/1FAIpQLSc75THqvPqI9JC0UPtRqE3ymyTg1sPkRhahuNXR5MLFWc1-RQ/formResponse",data:t}),$(".survey_div").fadeOut(500,function(){o.survey=!1,applyScope(o),$(".elight_thank_you").fadeIn(500)})},$(document).mouseup(function(e){let t=$(".dictionary_arrow_box");t.is(e.target)||0!==t.has(e.target).length||$(".dictionary_feedback_icon").is(e.target)||t.hide()})}]}),angular.module("offline").component("offline",{templateUrl:"app/components/offline/offline.template.html",controller:["$scope","$rootScope","$localStorage","$interval",function(e,t,n,o){let a=function(){e.clock=Date.now()};a(),o(a,1e3)}]}),angular.module("profile").component("profile",{templateUrl:"app/components/profile/profile.template.html",controller:["$scope","$rootScope","$localStorage","ProfileService","user.service",function(e,t,n,o,a){var i=this,r=$("#profile_menu");r.on("hide.bs.modal",function(){e.closeModal=!0}),r.on("show.bs.modal",function(){e.closeModal=!1}),t.$on("loggedin",function(){e.user=n.auth,t.auth=n.auth}),t.auth=n.auth,i.init=function(){e.user=n.auth,e.user?e.login=!0:e.login=!1},i.openProfileModal=function(){e.user=n.auth,e.user?(a.fetch(),e.login=!0,e.openModal=!0,i.showProfileMenu=!i.showProfileMenu,i.showProfileDetail=!1):(e.loginFromProfile=!0,$(".login-form").modal("show"),e.login=!1),delete t.avatar},i.closeProfileModal=function(){delete e.openModal},i.openProfileDetail=function(){i.showProfileDetail=!0}}]}),angular.module("welcome").component("welcome",{templateUrl:"app/components/welcome/welcome.template.html",controller:["$scope","$rootScope","$sce","$localStorage","loginService",function(e,t,n,o,a){var i=this;i.loading=!1,i.localesMessage=welcomeLocales,o.unit||(o.unit=[]),o.welcome?t.welcome=!0:(o.welcome=!1,t.welcome=o.welcome,_gaq.push(["_trackEvent","INTRO","Welcome screen",""]),i.showSection="intro"),i.trustAsHtml=function(e){return n.trustAsHtml(e)},i.init=function(){null==o.timeUnactive?o.timeUnactive=1:(!o.unit||0==o.unit.length)&&o.timeUnactive>=3?(i.announcementActive=!0,i.version=featureOfNewVersion.version,i.features=featureOfNewVersion.features):(i.announcementActive=!1,o.timeUnactive++)},i.init(),i.trustAsHtml=function(e){return n.trustAsHtml(e)},i.openProfileModal=function(){e.user=o.auth,e.user?(userService.fetch(),e.login=!0,e.openModal=!0,openModalDetail()):(e.loginFromProfile=!0,$(".login-form").modal("show"),e.login=!1),delete t.avatar},i.openListTopic=function(e){i.showSection="topic";var t=o.unit;_gaq.push(["_trackEvent","INTRO","List topic screen",""]),e&&(t=_.initial(o.unit),o.unit=t,$("body").removeClass("modal-open").css("padding-right","")),_.map(units,function(e){t&&(_.contains(t,e.id)&&(e.lock=!1))}),i.units=units},i.chooseTopic=function(e,n){_gaq.push(["_trackEvent","INTRO","Choose topic",""]),i.unitName=n,i.unitId=e;let a=_.contains(o.unit,i.unitId);t.selectedUnit=o.unit,a||($("#confirm-topic-box").modal("show"),$(".modal-backdrop").appendTo("#list_topic_1"),$("body").removeClass("modal-open").css("padding-right",""))},i.closeConfirmTopicModal=function(){$("#confirm-topic-box").modal("hide"),$(".list_topic").removeClass("modal-backdrop")},i.confirmTopic=function(){_gaq.push(["_trackEvent","INTRO","Comfirm topic",""]),_.unique(o.unit.push(i.unitId)),t.welcome=!0,o.welcome=!0,t.random=1,t.isLearn_word=!0,t.isQuote=!1,t.elightube=!1,t.topic=!1,applyScope(e),i.removeshowSection()},i.openRegisterForm=function(){_gaq.push(["_trackEvent","INTRO","Register",""]),t.showWelcome="register-form",i.showSection="register-form"},i.removeshowSection=function(){t.showWelcome=null},i.openListTopic2=function(){_gaq.push(["_trackEvent","INTRO","List topic screen 2",""]),t.showWelcome="topic2",i.showSection="topic2";var e=o.unit;e=_.initial(o.unit),$("body").removeClass("modal-open").css("padding-right",""),_.map(units,function(t){if(e){_.contains(e,t.id)&&(t.lock=!1)}}),i.units=units},i.chooseTopic2=function(e,n){_gaq.push(["_trackEvent","INTRO","Choose topic 2",""]),i.unitName=n,i.unitId=e,t.selectedUnit=o.unit,_.contains(o.unit,i.unitId)||($("#confirm-topic-box2").modal("show"),$(".modal-backdrop").appendTo("#list_topic_2"),$("body").removeClass("modal-open").css("padding-right",""))},i.closeConfirmTopicModal2=function(){$("#confirm-topic-box2").modal("hide"),$(".list_topic").removeClass("modal-backdrop")},i.confirmTopic2=function(){_gaq.push(["_trackEvent","INTRO","Comfirm topic 2",""]),_.unique(o.unit.push(i.unitId)),console.log(o.unit);var e=units[i.unitId-1].topics;console.log(e),t.welcome=!0,o.welcome=!0,i.removeshowSection()},"topic2"===t.showWelcome&&i.openListTopic2()}]}),angular.module("lesson.word").directive("gameDirective",gameDirective),angular.module("login").directive("loginSuccess",loginSuccess),angular.module("aki.mission").controller("MissionController",MissionController).controller("MissionControllerDetail",MissionControllerDetail).directive("akiMission",akiMission).directive("akiMissionDetail",akiMissionDetail).directive("akiMissionItem",akiMissionItem),MissionController.$inject=["$scope","MissionService","$rootScope","$localStorage"],MissionControllerDetail.$inject=["$scope"],akiMission.$inject=[],akiMissionDetail.$inject=[],akiMissionItem.$inject=["$rootScope","$localStorage","MissionService"],angular.module("profile").directive("profileDetail",function(){return{scope:{login:"=",openFrom:"="},restrict:"E",templateUrl:"app/components/profile/profile-detail.template.html",controller:["$scope","$rootScope","$localStorage","$timeout","Upload","ProfileService","mainService","challenge.io.service","user.service","challenge.items.service",function(e,t,n,o,a,i,r,s,l,c){var u;e.localesMessage=profileLocales,e.init=function(){e.user=l.fetch(),e.enableUpdateProfile=!1,e.user.username=e.user.username.substring(0,7),e.userSchoolArea=e.user.schoolArea,u=e.user.school||"",e.schoolAreas=[],schoolList.forEach(function(t,n){e.schoolAreas.push(t.area)}),e.userSchoolArea&&e.chooseArea(e.userSchoolArea)},e.chooseArea=function(t){var n=e.schoolAreas.indexOf(t);e.userSchoolArea=t,e.shoolInArea=schoolList[n].schools},e.getValueOfSchool=function(t){e.enableUpdateProfile=!0;let o=n.season.startTime-Date.now(),a=n.season.endingTime-Date.now();u&&u.id!==t.id&&o<=0&&a>0?(u="object"!=typeof t?JSON.parse(t):t,e.showPopupChangeSchool=!0):e.user.school="object"!=typeof t?JSON.parse(t):t},e.cancelUpdate=function(){delete e.showPopupChangeSchool,e.enableUpdateProfile=!1},e.logout=function(){$(".modal-backdrop.in").hide(),t.$broadcast("deny-invite"),s.disconnect(n.guest_id).then(a=>{delete e.openConfirmLogout,delete e.$parent.loginFromProfile,delete e.user,delete e.login,delete t.loggedIn,delete t.showWelcome,delete n.warPlayerState,delete n.auth,delete n.rank,delete n.schoolRank,delete n.token_guest_id,delete n.guest_id,delete n.isSetUnit,delete n.lastTimeGetVideos,delete n.count,localStorage.removeItem("war-win"),localStorage.removeItem("user"),r.getGuestId(function(a){a.data&&(n.guest_id=a.data),o(function(){$("#profile_menu").modal("hide"),e.$parent.logout()},1e3),n.welcome=!1,t.showWelcome="intro",location.reload()})})},e.checkNameLength=function(n){n&&n.length>=8?(e.messageErr=e.localesMessage[12][t.language],e.enableUpdateProfile=!1):(e.messageErr="",e.enableUpdateProfile=!0)},e.updateProfile=function(){if(e.user.username)if(e.user.username.length>8)e.messageErr=e.localesMessage[12][t.language],e.enableUpdateProfile=!1;else if(e.user.school||"vn"!==t.language){if(e.enableUpdateProfile){var a;i.updateUserInfo(n.guest_id,e.user.username,e.user.avatar,e.user.school.id,e.user.school.school_name).then(function(t){if(t&&1===t.code)return t.data.rewardAfterUpdate&&(a=!0),i.updateProfile(e.user.username,e.user.school?e.user.school.school_name:"",n.auth.user_token)}).then(function(i){e.enableUpdateProfile=!1,1==i.data.code?(e.messageSuccess=e.localesMessage[14][t.language],a&&"vn"===t.language&&(c.onOpenBonus("freeze",1),c.onOpenBonus("unfreeze",1),c.onOpenBonus("bomb",1),c.onOpenBonus("health",1),o(function(){e.messageSuccess="Bạn đã nhận được bộ 4 item sau khi thêm trường học!"},1e3)),e.user.schoolArea=e.userSchoolArea?e.userSchoolArea:"",u=e.user.school,delete n.schoolRank,delete n.schoolmateRank,delete e.showPopupChangeSchool,delete n.warPlayerState,delete n.schoolRankByTotalStudent,delete n.allRank,delete n.rank,n.auth.display_name=e.user.username,n.auth.avatar=e.user.avatar,n.auth.school=e.user.school,localStorage.setItem("user",JSON.stringify(n.auth)),n.warPlayerState&&(n.warPlayerState.school&&(n.warPlayerState.school=e.user.school),n.warPlayerState.username&&(n.warPlayerState.username=e.user.username))):e.messageErr=i.data.mgs}).catch(function(n){console.log(n),e.messageErr=e.localesMessage[15][t.language]})}}else e.messageErr="Trường không được để trống",e.enableUpdateProfile=!1;else e.messageErr=e.localesMessage[13][t.language],e.enableUpdateProfile=!1},e.showModalEditAvatar=function(){e.showModalCropImg=!0},e.closeModalEditAvatar=function(){e.showModalCropImg=!1},e.check_upload_avatar_fist=0,e.upload=function(o,a){if(1==e.check_upload_avatar_fist)return!1;e.check_upload_avatar_fist=1,e.loading_avatar=!0,e.disable=!0,t.loading_avatar=!0,i.updateAvatar(o,e.user.user_token).then(function(a){if(e.showModalCropImg=!1,1===a.data.code){$("#user_avatar").attr("src",o),e.user.avatar=o;var i=e.user;i.avatar=a.data.data,localStorage.setItem("user",JSON.stringify(i)),n.auth.avatar=i.avatar,delete t.loading_avatar,e.messageSuccess=e.localesMessage[16][t.language]}else delete t.loading_avatar,e.messageErr=a.data.mgs}).catch(function(n){delete t.loading_avatar,e.showModalCropImg=!1,e.messageErr=e.localesMessage[17][t.language]})},e.confirmLogout=function(){e.openConfirmLogout=!0},e.closeConfirmLogout=function(){e.openConfirmLogout=!1}}]}}),angular.module("aki.progressbar").controller("progressLineController",progressLineController).directive("progressLine",progressLine),progressLineController.$inject=["$scope","$localStorage","progressLineService","$rootScope"],progressLine.$inject=["$rootScope"];const loginLocales=[{vn:"Tạo tài khoản để lưu tiến trình học và nhận thêm từ vựng miễn phí",por:"Crie uma conta para salvar o seu progresso e obter mais vocabulário gratuito"},{vn:"Tạo tài khoản",por:"Criar a conta"},{vn:"Đăng nhập ngay nếu bạn là học viên của Elight",por:"Você é estudante de Elight! Acesse agora!"},{vn:"Tạo tài khoản sau",por:"Criar a conta mais tarde"},{vn:"Đăng ký ngay nếu bạn chưa là học viên của Elight",por:"Inscreva-se agora se você não é estudante de Elight!"},{vn:"Tên hiển thị từ 3 đến 15 ký tự",por:"Nome de exibição é de 3 a 15 caracteres"},{vn:"Tên hiển thị không được để trống",por:"Nome de exibição não pode ser deixado em branco"},{vn:"Email không đúng định dạng",por:"O endereço eletrônico não está no formato correto"},{vn:"Email không được để trống",por:"O endereço eletrônico não pode ser deixado em branco"},{vn:"Mật khẩu",por:"Senha"},{vn:"Mật khẩu không được để trống",por:"Senha não pode ser deixada em branco"},{vn:"Mật khẩu phải ít nhất 6 ký tự",por:"Senha com mais do que 6 caracteres"},{vn:"Nhập lại mật khẩu",por:"Digite a senha novamente!"},{vn:"Đăng ký",por:"Inscrever-se"},{vn:"Bạn đã có tài khoản?",por:"Você teve a sua conta?"},{vn:"Đăng nhập ngay",por:"Acesse agora"},{vn:"Tạo tài khoản sau",por:"Criar a conta mais tarde"},{vn:"Đăng nhập",por:"Acessar sua conta"},{vn:"Bạn có thể sử dụng tài khoản học viên của Elight để đăng nhập",por:"Você pode utilizar a sua conta de Elight para acessar"},{vn:"Bạn chưa có tài khoản?",por:"Você ainda não teve a conta?"},{vn:"Đăng ký ngay",por:"Inscrever-se mais tarde"},{vn:"Đăng nhập sau",por:"Acessar mais tarde"},{vn:"Đăng nhập thành công! Hãy chọn thêm 1 chủ đề từ vựng",por:"Acessado com sucesso! Escolha mais um tópico de estudo !"},{vn:"Đăng nhập thành công!",por:"Acessado com sucesso!"},{vn:"Bạn là học viên của Elight! Tất cả chủ đề từ vựng đã được mở",por:"Você é estudante de Elight! Todos os tópicos foram abertos"},{vn:"Chọn chủ đề",por:"Escolha um tópico de estudo"},{vn:"Học ngay",por:"Estude o quanto antes"},{vn:"Đang cập nhật dữ liệu...",por:"Atualizando os dados…"},{vn:"Server đang bận. Vui lòng thử lại sau...",por:"Atualmente, o servidor está ocupado. Por favor, tente mais tarde…"},{vn:"Tên đăng nhập hoặc mật khẩu không đúng",por:"O nome de usuário ou a senha está incorreto"},{vn:"Đã có lỗi, vui lòng thử lại sau",por:"Ocorreu um erro, tente mais tarde, por favor."}];var profileLocales=[{vn:"Đăng xuất",por:"Sair"},{vn:"Ảnh nặng",por:"Imagem sobrecarregada"},{vn:"Cho phép ảnh nặng nhất 1MB.",por:"Somente são permitidas imagens de, até, 1MB"},{vn:"Đóng",por:"Fechar"},{vn:"Chọn lại",por:"Escolher de novo"},{vn:"Cập nhật",por:"Atualizar"},{vn:"Thông tin tài khoản",por:"Informações de conta"},{vn:"Tên",por:"Nome"},{vn:"Đăng xuất thành công!",por:"Sair bem-sucedido!"},{vn:"Bạn có muốn đăng xuất?",por:"Você quer sair?"},{vn:"Không",por:"Não"},{vn:"Có",por:"Sim"},{vn:"Tên không dài quá 8 ký tự",por:"Nome não com mais do que 8 caracteres"},{vn:"Tên không được để trống",por:"Nome não pode ser deixado em branco"},{vn:"Cập nhật thành công!",por:"Atualizado com sucesso !"},{vn:"Đã xảy ra lỗi khi cập nhật!",por:"Ocorreu um erro ao atualizar!"},{vn:"Cập nhật ảnh đại diện thành công!",por:"Título da foto de perfil atualizada com sucesso !"},{vn:"Đã xảy ra lỗi khi cập nhật ảnh đại diện!",por:"Ocorreu um erro ao atualizar a foto de perfil !"}];const welcomeLocales=[{vn:"Cách học từ vựng tiếng Anh dễ dàng nhất",por:"A maneira mais fácil de aprender Inglês"},{vn:"Học qua Game",por:"O jogo interativo"},{vn:"'thách đấu' khả năng nhớ từ mới với người học khác ",por:"ajuda a aprender Inglês de um jeito mais descontraido "},{vn:"1.000 từ vựng",por:"Com 1000 vocábulos"},{vn:"với phiên âm, âm thanh, và hình ảnh sinh động",por:"Com áudios e imagens dinâmicas "},{vn:"Thuật toán SuperMemo",por:"Ajudam a aumentar 200 %"},{vn:"Công nghệ giúp gia tăng khả năng ghi nhớ từ mới",por:"da memorização das palavras novas"},{vn:"BẮT ĐẦU NGAY",por:"COMECE AGORA MESMO"},{vn:"Elight Memo vừa cập nhật lên phiên bản",por:"Elight Extenção ELUMINADA acabou de atualizar, para sua versão definitiva "},{vn:"KÍCH HOẠT NGAY!",por:"ACTIVE O QUANTO ANTES!"},{vn:"Hãy chọn chủ đề học bạn yêu thích!",por:"Escolha o seu tema preferido!"},{vn:"Bạn đã chọn chủ đề",por:"Escolha à sua maneira, como estudar e aprenda, no seu próprio ritmo"},{vn:"Chủ đề học không được thay đổi trong toàn bộ quá trình học",por:"Você tendo escolhido a matéria que deseja estudar"},{vn:"Chọn lại",por:"Escolher de novo"},{vn:"Xác nhận",por:"Confirmar"},{vn:"Đăng ký thành công. Hãy chọn thêm 1 chủ đề từ vựng!",por:"Registrado com sucesso. Escolha mais um tópico de estudo"}],settingLocales=[{vn:"Chủ đề",por:"Tópico"},{vn:"Góp ý",por:"Comentário"},{vn:"Hỗ trợ",por:"Ajuda"},{vn:"Thông tin",por:"Informações"},{vn:"Nâng cấp <br>lên VIP",por:"Atualizar <br> para VIP"},{vn:"Học viên VIP của Elight - Tất cả chủ đề đã mở",por:"Estudante Exclusivo de Elight – Todos os tópicos abertos"},{vn:"Từ vựng cơ bản",por:"Vocabulário básico"},{vn:"MỞ CHỦ ĐỀ",por:"ABRIR O TEMA"},{vn:"Những điều Elight có thể cải thiện hơn nữa.",por:"As coisas que Elight pode melhorar mais"},{vn:"Email không đúng định dạng",por:"O email não está no formato correto"},{vn:"Viết góp ý của bạn tại đây",por:"Comentar aqui"},{vn:"Gửi",por:"Enviar"},{vn:"Điền thông tin để được hỗ trợ",por:"Preencha informações para obter a ajuda"},{vn:"Nhập họ và tên",por:"Digite o seu nome completo"},{vn:"Số điện thoại",por:"O número de telefone"},{vn:"Vấn đề của bạn là gì?",por:"O que aconteceu? "},{vn:"Cảm ơn bạn đã góp ý cho",por:"Obrigado pelo seu comentário"},{vn:"MỞ TOÀN BỘ CHỦ ĐỀ",por:"Abrir o curso"},{vn:"ĐĂNG NHẬP",por:"Criar a conta"},{vn:"Đăng nhập để mở thêm chủ đề từ vựng",por:"Tornar-se um estudante VIP de Elight"},{vn:"Mở tất cả chủ đề học",por:"Abrir todos os temas de aprendizagem"},{vn:"Mở thêm 1 chủ đề học",por:"Abrir mais um tema"},{vn:"Đã học",por:"Já estudou"},{vn:"Chưa học",por:"Ainda não estudou"}],challengeLocales=[{vn:"Chơi",por:"Jogar"},{vn:"Hãy bắt đầu chơi ngay thôi!",por:"Comece a jogar agora!"},{vn:"Chơi ngay!",por:"Jogue agora!"},{vn:"Đang kết nối với đối thủ",por:"Está conectando com um adversário"},{vn:"Đối thủ",por:"Adversário"},{vn:"không chấp nhận lời mời của bạn.",por:"Não aceita o seu convite"},{vn:"Mời đối thủ khác.",por:"Convidá-lo novamente"},{vn:"mời đối thủ khác",por:"Convide a outro adversário"},{vn:"Đóng băng đối thủ",por:"Congele o oponente"},{vn:"Phá băng cho bạn",por:"Descongelar – se"},{vn:"Thả bom khiến đối thủ mất 1 máu",por:"Bombardear para diminuir 1 unidade de sangue do oponente"},{vn:"Hồi 1 máu",por:'Recuperar 1 ponto de sangue, da sua barra de pontos críticos "H.P. "'},{vn:"Hiện tại server đang bảo trì, vui lòng quay lại sau",por:"Atualmente o servidor está na manutenção"},{vn:"Bạn đã nhận được 1 phần thưởng, click để mở.",por:"Você recebeu um prêmio, clique para abrí-lo "},{vn:"Xin chúc mừng, bạn được thưởng 1 skill",por:"Parabéns, você é recompensado com uma habilidade"},{vn:"Đăng nhập để lưu điểm",por:"Acessar sua conta, para salvar seu progresso, até aqui"},{vn:"Đăng nhập Extension",por:"Acessar sua conta"},{vn:"Chơi thắng 3 ván <br>để nhận được quà",por:"Vencer 3 partidas <br> para receber os presentes"},{vn:"Mở hộp để nhận được quà",por:"Abra a caixa, para receber o seu presente"},{vn:"Bạn còn",por:"Você continua"},{vn:"để nhận được quà",por:"para receber o presente"},{vn:"Chơi ngẫu nhiên",por:"Vai jogando aleatoriamente"},{vn:"Mời đối thủ",por:"Convide o oponente"},{vn:"Nhập guest ID của đối thủ",por:"Digite os números das credenciais para identificação do seu oponente"},{vn:"5 đối thủ gần đây",por:"Cinco oponentes recentes"},{vn:"Tổng hợp từ vựng đã chơi",por:"Síntese do vocabulário jogado"},{vn:"ĐÃ CÓ VẤN ĐỀ GÌ VẬY?",por:"O que aconteceu?"},{vn:"Nội dung chưa chính xác",por:"Conteúdo incorreto"},{vn:"Hình ảnh không phù hợp",por:"Imagem inadequada"},{vn:"Xin chân thành cảm ơn bạn.",por:"Muito obrigado"},{vn:"Chọn hình ảnh phù hợp với từ đã cho",por:"Escolha a imagem correspondente à palavra dada"},{vn:"Mỗi câu trả lời đúng bạn sẽ nhận 1 điểm",por:"Receberá um ponto com cada resposta correta"},{vn:"Trả lời sai bạn sẽ mất 1",por:"Perderá um ponto com cada resposta incorreta"},{vn:"Trò chơi sẽ kết thúc khi hết thời gian <br> Hoặc khi một trong hai người chơi hết",por:"O jogo acabará ao tempo terminado <br> ou ao um dos dois jogadores terminar"},{vn:"Người chiến thắng là người sống sót và giành được nhiều điểm hơn",por:"O vencedor é o sobrevivente e ganha mais pontos"},{vn:"Đừng quên sử dụng những item hỗ trợ để dành chiến thắng",por:"Não se esqueça de utilizar os itens apoiados para ganhar o jogo"},{vn:"Hồi 1",por:"Heal 1"}];var wordLocales=[{vn:"Tắt nhạc nền",por:"Desliga a música de fundo"},{vn:"Mở nhạc nền",por:"Liga a música de fundo"},{vn:"ĐÃ CÓ VẤN ĐỀ GÌ VẬY?",por:"O que aconteceu?"},{vn:"Nội dung chưa chính xác",por:"Conteúdo incorreto"},{vn:"Hình ảnh không phù hợp",por:"Imagem inadequada"},{vn:"Gửi",por:"Envia"},{vn:"Xin chân thành cảm ơn bạn.",por:"Muito obrigado!"},{vn:"Ấn [dấu cách] để lật card",por:"Clique para virar o cartão"},{vn:"TIẾP TỤC",por:"CONTINUE"},{vn:"Chọn hình phù hợp với từ",por:"Escolha a imagem correspondente à palavra"},{vn:"Chọn từ phù hợp",por:"Escolha a palavra adequada"}];function flashcardController(e,t,n){e.flag=!1,e.activeContinue=!0,e.localesMessage=wordLocales;var o=new Image;function a(){t.backgroundMusic&&""!=t.backgroundMusic||(t.backgroundMusic="assets/audio/learn_word/background.mp3")}$(o).load(function(){$(".flashcard_image_cover").hide(50)}),o.src=e.data[0]?e.data[0].image:"",e.classAudio="fa-play",e.playAudio=function(){e.classAudio="fa-pause";var t=new Audio(e.data[0].audio);t.onended=function(){e.classAudio="fa-play",applyScope(e)},t.play()},e.$on("flipCard",function(){e.flip()}),e.flip=function(t){if(a(),sendGa(n.auth,"Learn word","Use","Learn_use"),"button"===t){var o=new Audio("assets/audio/learn_word/btn_push.mp3");o.volume=.2,o.play()}var i=new Audio("assets/audio/learn_word/flip.mp3");if(i.volume=.2,i.play(),"app/components/lesson/words/game/views/flashcard.html"!==e.template||e.flag)e.activeContinue=!1;else{e.flag=!0,setTimeout(function(){e.flag=!1,applyScope(e)},500),_gaq.push(["_trackEvent","EE Features","Topics","flipFlashcard"]),$(".show_back").show(),$(".not_show_back").hide();var r=$(".guide-text-flip"),s=$(".topic_flashcard_container");if(s.hasClass("flipped"))r.html("Ấn [dấu cách] để lật card"),e.flipped=!1,e.activeContinue=!1,s.removeClass("flipped guide_flip ");else{e.flipped=!0,r.html("Ấn [ENTER] để tiếp tục");var l=new Audio(e.data[0].audio);l.onended=function(){e.activeContinue=!1,applyScope(e)},l.play(),s.addClass("flipped"),s.removeClass("guide_flip")}}},e.$on("checkEnter",function(){e.activeContinue||(e.activeContinue=!0,e.nextStep())}),e.nextStep=function(){t.correctAnswer++,t.$broadcast("timesCount"),e.activeContinue=!0,a(),$(".guide-text-flip").html("Ấn [dấu cách] để lật card"),new Audio("assets/audio/true.mp3").play(),e.flag=!1,e.flipped=!1,$(".show_back").hide(),$(".not_show_back").show(),$(".topic_flashcard_container").hasClass("flipped")&&$(".topic_flashcard_container").removeClass("flipped"),e.$parent.nextStep(),applyScope(e)}}function multipleChooseController(e,t,n){var o=!1;let a=0;var i=new Audio(e.answer.audio);e.disableButton=!1,e.localesMessage=wordLocales,"app/components/lesson/words/game/views/choose_picture_3.html"===e.template&&s(i);var r=!0;function s(t){try{e.playing=!0,t.play()}catch(e){console.log("Error playing file!")}}e.shuffledData=_.shuffle(e.data),e.$on("chooseAnswer",function(e,t){$(".trigger-click-"+t.key).trigger("click")}),e.checkResult=function(n,i){(a++,o)||(e.shuffledData[i].checked=!0,n.word==e.answer.word?(o=!0,r&&t.correctAnswer++,e.disableButton=!0,new Audio("assets/audio/true.mp3").play(),setTimeout(function(){o=!1,e.disableButton=!1,e.$parent.nextStep(),applyScope(e)},1e3),1===a&&t.$broadcast("timesCount")):(new Audio("assets/audio/fail.mp3").play(),r=!1))},e.playSound=function(){s(i)},i.onended=function(){e.playing=!1}}angular.module("lesson.word").controller("flashcardController",flashcardController),flashcardController.$inject=["$scope","$rootScope","$localStorage"],angular.module("lesson.word").controller("multipleChooseController",multipleChooseController),multipleChooseController.$inject=["$scope","$rootScope","$localStorage"];